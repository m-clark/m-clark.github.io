<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

  <!--radix_placeholder_meta_tags-->
<title>Michael Clark: Mediation Models</title>

<meta property="description" itemprop="description" content="Various package options for conducting mediation analysis"/>

<link rel="canonical" href="https://m-clark.github.io/posts/2019-03-12-mediation-models/"/>
<link rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/"/>
<link rel="icon" type="image/vnd.microsoft.icon" href="../../img/favicon.ico"/>

<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2019-03-12"/>
<meta property="article:created" itemprop="dateCreated" content="2019-03-12"/>
<meta name="article:author" content="Michael Clark"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content="Michael Clark: Mediation Models"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content="Various package options for conducting mediation analysis"/>
<meta property="og:url" content="https://m-clark.github.io/posts/2019-03-12-mediation-models/"/>
<meta property="og:image" content="https://m-clark.github.io/posts/2019-03-12-mediation-models/../../img/mediation_blog_img.png"/>
<meta property="og:image:width" content="2908"/>
<meta property="og:image:height" content="1354"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content="Michael Clark"/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary_large_image"/>
<meta property="twitter:title" content="Michael Clark: Mediation Models"/>
<meta property="twitter:description" content="Various package options for conducting mediation analysis"/>
<meta property="twitter:url" content="https://m-clark.github.io/posts/2019-03-12-mediation-models/"/>
<meta property="twitter:image" content="https://m-clark.github.io/posts/2019-03-12-mediation-models/../../img/mediation_blog_img.png"/>
<meta property="twitter:image:width" content="2908"/>
<meta property="twitter:image:height" content="1354"/>

<!--  https://scholar.google.com/intl/en/scholar/inclusion.html#indexing -->
<meta name="citation_title" content="Michael Clark: Mediation Models"/>
<meta name="citation_fulltext_html_url" content="https://m-clark.github.io/posts/2019-03-12-mediation-models/"/>
<meta name="citation_fulltext_world_readable" content=""/>
<meta name="citation_online_date" content="2019/03/12"/>
<meta name="citation_publication_date" content="2019/03/12"/>
<meta name="citation_author" content="Michael Clark"/>
<!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["creative_commons","title","description","author","date","preview","output","draft","tags","categories","citation_url","canonical_url"]}},"value":[{"type":"character","attributes":{},"value":["CC BY-SA"]},{"type":"character","attributes":{},"value":["Mediation Models"]},{"type":"character","attributes":{},"value":["Various package options for conducting mediation analysis"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","url"]}},"value":[{"type":"character","attributes":{},"value":["Michael Clark"]},{"type":"character","attributes":{},"value":["https://m-clark.github.io"]}]}]},{"type":"character","attributes":{},"value":["2019-03-12"]},{"type":"character","attributes":{},"value":["../../img/mediation_blog_img.png"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","toc","css"]}},"value":[{"type":"logical","attributes":{},"value":[false]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["../../test.css"]}]}]},{"type":"logical","attributes":{},"value":[false]},{"type":"character","attributes":{},"value":["R","mediation","DAG","SEM","intervening variable"]},{"type":"character","attributes":{},"value":["SEM","mediation"]},{"type":"character","attributes":{},"value":["https://m-clark.github.io/posts/2019-03-12-mediation-models/"]},{"type":"character","attributes":{},"value":["https://m-clark.github.io/posts/2019-03-12-mediation-models/"]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["mediation-models_files/bowser-1.9.3/bowser.min.js","mediation-models_files/DiagrammeR-styles-0.2/styles.css","mediation-models_files/distill-2.2.21/template.v2.js","mediation-models_files/figure-html/bnlearn-1.svg","mediation-models_files/figure-html/mediation_pack-1.svg","mediation-models_files/figure-html5/bnlearn_reproduction-1.svg","mediation-models_files/figure-html5/bnlearn-1.svg","mediation-models_files/figure-html5/bnlearn-model-1.svg","mediation-models_files/figure-html5/mediation_bayes_ppcheck-1.svg","mediation-models_files/figure-html5/mediation_bayes_ppcheck-2.svg","mediation-models_files/figure-html5/mediation_pack-1.png","mediation-models_files/figure-html5/mediation_pack-1.svg","mediation-models_files/figure-html5/mediation_result_pretty-1.svg","mediation-models_files/figure-html5/psych_mediate-1.svg","mediation-models_files/figure-html5/unnamed-chunk-2-1.png","mediation-models_files/figure-html5/unnamed-chunk-2-1.svg","mediation-models_files/figure-html5/unnamed-chunk-3-1.svg","mediation-models_files/grViz-binding-1.0.0/grViz.js","mediation-models_files/grViz-binding-1.0.1/grViz.js","mediation-models_files/grViz-binding-1.0.6.1/grViz.js","mediation-models_files/header-attrs-2.3/header-attrs.js","mediation-models_files/htmlwidgets-1.3/htmlwidgets.js","mediation-models_files/htmlwidgets-1.5.1/htmlwidgets.js","mediation-models_files/jquery-1.11.3/jquery.min.js","mediation-models_files/kePrint-0.0.1/kePrint.js","mediation-models_files/viz-0.3/viz.js","mediation-models_files/viz-1.8.2/viz.js","mediation-models_files/webcomponents-2.0.0/webcomponents.js"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
<meta name="distill:offset" content="../.."/>

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      tolerance: 5,
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #0F2E3D;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
  min-width: 150px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative; min-height: 500px; }
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

/* adjust viewport for navbar height */
/* helps vertically center bootstrap (non-distill) content */
.min-vh-100 {
  min-height: calc(100vh - 100px) !important;
}

</style>

<script src="../../site_libs/jquery-1.11.3/jquery.min.js"></script>
<link href="../../site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
<link href="../../site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
<script src="../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<script src="../../site_libs/autocomplete-0.37.1/autocomplete.min.js"></script>
<script src="../../site_libs/fuse-6.4.1/fuse.min.js"></script>

<script type="application/javascript">

function getMeta(metaName) {
  var metas = document.getElementsByTagName('meta');
  for (let i = 0; i < metas.length; i++) {
    if (metas[i].getAttribute('name') === metaName) {
      return metas[i].getAttribute('content');
    }
  }
  return '';
}

function offsetURL(url) {
  var offset = getMeta('distill:offset');
  return offset ? offset + '/' + url : url;
}

function createFuseIndex() {

  // create fuse index
  var options = {
    keys: [
      { name: 'title', weight: 20 },
      { name: 'categories', weight: 15 },
      { name: 'description', weight: 10 },
      { name: 'contents', weight: 5 },
    ],
    ignoreLocation: true,
    threshold: 0
  };
  var fuse = new window.Fuse([], options);

  // fetch the main search.json
  return fetch(offsetURL('search.json'))
    .then(function(response) {
      if (response.status == 200) {
        return response.json().then(function(json) {
          // index main articles
          json.articles.forEach(function(article) {
            fuse.add(article);
          });
          // download collections and index their articles
          return Promise.all(json.collections.map(function(collection) {
            return fetch(offsetURL(collection)).then(function(response) {
              if (response.status === 200) {
                return response.json().then(function(articles) {
                  articles.forEach(function(article) {
                    fuse.add(article);
                  });
                })
              } else {
                return Promise.reject(
                  new Error('Unexpected status from search index request: ' +
                            response.status)
                );
              }
            });
          })).then(function() {
            return fuse;
          });
        });

      } else {
        return Promise.reject(
          new Error('Unexpected status from search index request: ' +
                      response.status)
        );
      }
    });
}

window.document.addEventListener("DOMContentLoaded", function (event) {

  // get search element (bail if we don't have one)
  var searchEl = window.document.getElementById('distill-search');
  if (!searchEl)
    return;

  createFuseIndex()
    .then(function(fuse) {

      // make search box visible
      searchEl.classList.remove('hidden');

      // initialize autocomplete
      var options = {
        autoselect: true,
        hint: false,
        minLength: 2,
      };
      window.autocomplete(searchEl, options, [{
        source: function(query, callback) {
          const searchOptions = {
            isCaseSensitive: false,
            shouldSort: true,
            minMatchCharLength: 2,
            limit: 10,
          };
          var results = fuse.search(query, searchOptions);
          callback(results
            .map(function(result) { return result.item; })
          );
        },
        templates: {
          suggestion: function(suggestion) {
            var img = suggestion.preview && Object.keys(suggestion.preview).length > 0
              ? `<img src="${offsetURL(suggestion.preview)}"</img>`
              : '';
            var html = `
              <div class="search-item">
                <h3>${suggestion.title}</h3>
                <div class="search-item-description">
                  ${suggestion.description || ''}
                </div>
                <div class="search-item-preview">
                  ${img}
                </div>
              </div>
            `;
            return html;
          }
        }
      }]).on('autocomplete:selected', function(event, suggestion) {
        window.location.href = offsetURL(suggestion.path);
      });
      // remove inline display style on autocompleter (we want to
      // manage responsive display via css)
      $('.algolia-autocomplete').css("display", "");
    })
    .catch(function(error) {
      console.log(error);
    });

});

</script>

<style type="text/css">

.nav-search {
  font-size: x-small;
}

/* Algolioa Autocomplete */

.algolia-autocomplete {
  display: inline-block;
  margin-left: 10px;
  vertical-align: sub;
  background-color: white;
  color: black;
  padding: 6px;
  padding-top: 8px;
  padding-bottom: 0;
  border-radius: 6px;
  border: 1px #0F2E3D solid;
  width: 180px;
}


@media screen and (max-width: 768px) {
  .distill-site-nav .algolia-autocomplete {
    display: none;
    visibility: hidden;
  }
  .distill-site-nav.responsive .algolia-autocomplete {
    display: inline-block;
    visibility: visible;
  }
  .distill-site-nav.responsive .algolia-autocomplete .aa-dropdown-menu {
    margin-left: 0;
    width: 400px;
    max-height: 400px;
  }
}

.algolia-autocomplete .aa-input, .algolia-autocomplete .aa-hint {
  width: 90%;
  outline: none;
  border: none;
}

.algolia-autocomplete .aa-hint {
  color: #999;
}
.algolia-autocomplete .aa-dropdown-menu {
  width: 550px;
  max-height: 70vh;
  overflow-x: visible;
  overflow-y: scroll;
  padding: 5px;
  margin-top: 3px;
  margin-left: -150px;
  background-color: #fff;
  border-radius: 5px;
  border: 1px solid #999;
  border-top: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion {
  cursor: pointer;
  padding: 5px 4px;
  border-bottom: 1px solid #eee;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion:last-of-type {
  border-bottom: none;
  margin-bottom: 2px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item {
  overflow: hidden;
  font-size: 0.8em;
  line-height: 1.4em;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item h3 {
  font-size: 1rem;
  margin-block-start: 0;
  margin-block-end: 5px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-description {
  display: inline-block;
  overflow: hidden;
  height: 2.8em;
  width: 80%;
  margin-right: 4%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview {
  display: inline-block;
  width: 15%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img {
  height: 3em;
  width: auto;
  display: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img[src] {
  display: initial;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion.aa-cursor {
  background-color: #eee;
}
.algolia-autocomplete .aa-dropdown-menu .aa-suggestion em {
  font-weight: bold;
  font-style: normal;
}

</style>


<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

d-byline .byline {
  grid-template-columns: 2fr 2fr;
}

d-byline .byline h3 {
  margin-block-start: 1.5em;
}

d-byline .byline .authors-affiliations h3 {
  margin-block-start: 0.5em;
}

.authors-affiliations .orcid-id {
  width: 16px;
  height:16px;
  margin-left: 4px;
  margin-right: 4px;
  vertical-align: middle;
  padding-bottom: 2px;
}

d-title .dt-tags {
  margin-top: 1em;
  grid-column: text;
}

.dt-tags .dt-tag {
  text-decoration: none;
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0em 0.4em;
  margin-right: 0.5em;
  margin-bottom: 0.4em;
  font-size: 70%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

d-article table.gt_table td,
d-article table.gt_table th {
  border-bottom: none;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

d-article {
  padding-top: 2.5rem;
  padding-bottom: 30px;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article h2 {
  margin: 1rem 0 1.5rem 0;
}

d-article h3 {
  margin-top: 1.5rem;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

/* Tweak code blocks */

d-article div.sourceCode code,
d-article pre code {
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: auto;
}

d-article div.sourceCode {
  background-color: white;
}

d-article div.sourceCode pre {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

d-article pre {
  font-size: 12px;
  color: black;
  background: none;
  margin-top: 0;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

d-article pre a {
  border-bottom: none;
}

d-article pre a:hover {
  border-bottom: none;
  text-decoration: underline;
}

d-article details {
  grid-column: text;
  margin-bottom: 0.8em;
}

@media(min-width: 768px) {

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: visible !important;
}

d-article div.sourceCode pre {
  padding-left: 18px;
  font-size: 14px;
}

d-article pre {
  font-size: 14px;
}

}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for d-contents */

.d-contents {
  grid-column: text;
  color: rgba(0,0,0,0.8);
  font-size: 0.9em;
  padding-bottom: 1em;
  margin-bottom: 1em;
  padding-bottom: 0.5em;
  margin-bottom: 1em;
  padding-left: 0.25em;
  justify-self: start;
}

@media(min-width: 1000px) {
  .d-contents.d-contents-float {
    height: 0;
    grid-column-start: 1;
    grid-column-end: 4;
    justify-self: center;
    padding-right: 3em;
    padding-left: 2em;
  }
}

.d-contents nav h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 1em;
}

.d-contents li {
  list-style-type: none
}

.d-contents nav > ul {
  padding-left: 0;
}

.d-contents ul {
  padding-left: 1em
}

.d-contents nav ul li {
  margin-top: 0.6em;
  margin-bottom: 0.2em;
}

.d-contents nav a {
  font-size: 13px;
  border-bottom: none;
  text-decoration: none
  color: rgba(0, 0, 0, 0.8);
}

.d-contents nav a:hover {
  text-decoration: underline solid rgba(0, 0, 0, 0.6)
}

.d-contents nav > ul > li > a {
  font-weight: 600;
}

.d-contents nav > ul > li > ul {
  font-weight: inherit;
}

.d-contents nav > ul > li > ul > li {
  margin-top: 0.2em;
}


.d-contents nav ul {
  margin-top: 0;
  margin-bottom: 0.25em;
}

.d-article-with-toc h2:nth-child(2) {
  margin-top: 0;
}


/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure img {
  width: 100%;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}

/* Citations */

d-article .citation {
  color: inherit;
  cursor: inherit;
}

div.hanging-indent{
  margin-left: 1em; text-indent: -1em;
}

/* Citation hover box */

.tippy-box[data-theme~=light-border] {
  background-color: rgba(250, 250, 250, 0.95);
}

.tippy-content > p {
  margin-bottom: 0;
  padding: 2px;
}


/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Include appendix styles here so they can be overridden */

d-appendix {
  contain: layout style;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-top: 60px;
  margin-bottom: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  color: rgba(0,0,0,0.5);
  padding-top: 60px;
  padding-bottom: 48px;
}

d-appendix h3 {
  grid-column: page-start / text-start;
  font-size: 15px;
  font-weight: 500;
  margin-top: 1em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.65);
}

d-appendix h3 + * {
  margin-top: 1em;
}

d-appendix ol {
  padding: 0 0 0 15px;
}

@media (min-width: 768px) {
  d-appendix ol {
    padding: 0 0 0 30px;
    margin-left: -30px;
  }
}

d-appendix li {
  margin-bottom: 1em;
}

d-appendix a {
  color: rgba(0, 0, 0, 0.6);
}

d-appendix > * {
  grid-column: text;
}

d-appendix > d-footnote-list,
d-appendix > d-citation-list,
d-appendix > distill-appendix {
  grid-column: screen;
}

/* Include footnote styles here so they can be overridden */

d-footnote-list {
  contain: layout style;
}

d-footnote-list > * {
  grid-column: text;
}

d-footnote-list a.footnote-backlink {
  color: rgba(0,0,0,0.3);
  padding-left: 0.5em;
}



/* Anchor.js */

.anchorjs-link {
  /*transition: all .25s linear; */
  text-decoration: none;
  border-bottom: none;
}
*:hover > .anchorjs-link {
  margin-left: -1.125em !important;
  text-decoration: none;
  border-bottom: none;
}

/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


.sidebar-section.custom {
  font-size: 12px;
  line-height: 1.6em;
}

.custom p {
  margin-bottom: 0.5em;
}

/* Styles for listing layout (hide title) */
.layout-listing d-title, .layout-listing .d-title {
  display: none;
}

/* Styles for posts lists (not auto-injected) */


.posts-with-sidebar {
  padding-left: 45px;
  padding-right: 45px;
}

.posts-list .description h2,
.posts-list .description p {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

.posts-list .description h2 {
  font-weight: 700;
  border-bottom: none;
  padding-bottom: 0;
}

.posts-list h2.post-tag {
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
  padding-bottom: 12px;
}
.posts-list {
  margin-top: 60px;
  margin-bottom: 24px;
}

.posts-list .post-preview {
  text-decoration: none;
  overflow: hidden;
  display: block;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  padding: 24px 0;
}

.post-preview-last {
  border-bottom: none !important;
}

.posts-list .posts-list-caption {
  grid-column: screen;
  font-weight: 400;
}

.posts-list .post-preview h2 {
  margin: 0 0 6px 0;
  line-height: 1.2em;
  font-style: normal;
  font-size: 24px;
}

.posts-list .post-preview p {
  margin: 0 0 12px 0;
  line-height: 1.4em;
  font-size: 16px;
}

.posts-list .post-preview .thumbnail {
  box-sizing: border-box;
  margin-bottom: 24px;
  position: relative;
  max-width: 500px;
}
.posts-list .post-preview img {
  width: 100%;
  display: block;
}

.posts-list .metadata {
  font-size: 12px;
  line-height: 1.4em;
  margin-bottom: 18px;
}

.posts-list .metadata > * {
  display: inline-block;
}

.posts-list .metadata .publishedDate {
  margin-right: 2em;
}

.posts-list .metadata .dt-authors {
  display: block;
  margin-top: 0.3em;
  margin-right: 2em;
}

.posts-list .dt-tags {
  display: block;
  line-height: 1em;
}

.posts-list .dt-tags .dt-tag {
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0.3em 0.4em;
  margin-right: 0.2em;
  margin-bottom: 0.4em;
  font-size: 60%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

.posts-list img {
  opacity: 1;
}

.posts-list img[data-src] {
  opacity: 0;
}

.posts-more {
  clear: both;
}


.posts-sidebar {
  font-size: 16px;
}

.posts-sidebar h3 {
  font-size: 16px;
  margin-top: 0;
  margin-bottom: 0.5em;
  font-weight: 400;
  text-transform: uppercase;
}

.sidebar-section {
  margin-bottom: 30px;
}

.categories ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

.categories li {
  color: rgba(0, 0, 0, 0.8);
  margin-bottom: 0;
}

.categories li>a {
  border-bottom: none;
}

.categories li>a:hover {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
}

.categories .active {
  font-weight: 600;
}

.categories .category-count {
  color: rgba(0, 0, 0, 0.4);
}


@media(min-width: 768px) {
  .posts-list .post-preview h2 {
    font-size: 26px;
  }
  .posts-list .post-preview .thumbnail {
    float: right;
    width: 30%;
    margin-bottom: 0;
  }
  .posts-list .post-preview .description {
    float: left;
    width: 45%;
  }
  .posts-list .post-preview .metadata {
    float: left;
    width: 20%;
    margin-top: 8px;
  }
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.5em;
    font-size: 16px;
  }
  .posts-with-sidebar .posts-list {
    float: left;
    width: 75%;
  }
  .posts-with-sidebar .posts-sidebar {
    float: right;
    width: 20%;
    margin-top: 60px;
    padding-top: 24px;
    padding-bottom: 24px;
  }
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

.downlevel .posts-list .post-preview {
  color: inherit;
}



</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // add anchors
  if (window.anchors) {
    window.anchors.options.placement = 'left';
    window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
  }


  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  // move refs into #references-listing
  $('#references-listing').replaceWith($('#refs'));

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-contents a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('details, div.sourceCode, pre, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // remove code block used to force  highlighting css
  $('.distill-force-highlighting-css').parent().remove();

  // remove empty line numbers inserted by pandoc when using a
  // custom syntax highlighting theme
  $('code.sourceCode a:empty').remove();

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // article with toc class
    $('.d-contents').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // add orcid ids
    $('.authors-affiliations').find('.author').each(function(i, el) {
      var orcid_id = front_matter.authors[i].orcidID;
      if (orcid_id) {
        var a = $('<a></a>');
        a.attr('href', 'https://orcid.org/' + orcid_id);
        var img = $('<img></img>');
        img.addClass('orcid-id');
        img.attr('alt', 'ORCID ID');
        img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
        a.append(img);
        $(this).append(a);
      }
    });

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // remove d-appendix and d-footnote-list local styles
    $('d-appendix > style:first-child').remove();
    $('d-footnote-list > style:first-child').remove();

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // hoverable references
    $('span.citation[data-cites]').each(function() {
      var refHtml = $('#ref-' + $(this).attr('data-cites')).html();
      window.tippy(this, {
        allowHTML: true,
        content: refHtml,
        maxWidth: 500,
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start'
      });
    });

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-contents').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<!--/radix_placeholder_distill-->
  <script src="../../site_libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
  <script src="../../site_libs/viz-1.8.2/viz.js"></script>
  <link href="../../site_libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
  <script src="../../site_libs/grViz-binding-1.0.6.1/grViz.js"></script>
  <script src="../../site_libs/kePrint-0.0.1/kePrint.js"></script>
  <script src="../../site_libs/jquery-1.11.3/jquery.min.js"></script>
  <script src="../../site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="../../site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<script type="text/javascript" cookie-consent="tracking" async src="https://www.googletagmanager.com/gtag/js?id=UA-79528685-1"></script>
<script type="text/javascript" cookie-consent="tracking">
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-79528685-1');
</script>
<style type="text/css">
@import url("pygment_highlights.css");
@import url(https://fonts.googleapis.com/css?family=Roboto:400,400italic,500,500italic,700,700italic,900,900italic,300italic,300,100italic,100);
@import url("https://fonts.googleapis.com/css?family=Roboto|Roboto+Mono|Roboto+Condensed|Open+Sans|Open+Sans+Condensed:300|Open+Sans+Condensed:light|Lato|Lora|Fira+Sans|Fira+Mono");


body {
  font-family: Roboto, 'Libre Baskerville', sans-serif; /*, et-book, "Palatino Linotype", "Palatino LT STD", 'Lora', serif*/
  font-size: 15px;
  font-weight: 300;
  color: #404040;        /* #404040*/
  position: relative;
  background: #FFFFF8;      /* {{ site.page-col }}; */
}

/* distill specific */

d-title h1 {
  font-family: 'Open Sans Condensed', Roboto, Helvetica, Arial, sans;
  font-weight: 200;
  font-size: 50px;
  color: #ff5500;
  margin-top: 4rem;
  margin-bottom: 1.5rem;
  line-height: 1;
}

.index-title h1 {
  font-family: 'Open Sans Condensed', Roboto, Helvetica, Arial, sans;
  font-weight: 200;
  font-size: 75px;
  font-variant: small-caps;
  text-align: center;
  color: #ff5500;
  margin-top: 4rem;
  margin-bottom: 1.5rem;
  line-height: 1;
  border-bottom: 0; /*same as default h2*/
  padding-bottom: 1rem; 
}

d-article h1 {
  font-family: 'Open Sans Condensed', Roboto, Helvetica, Arial, sans;
  font-style: normal;
  font-variant: small-caps;
  font-weight: 400;
  font-size: 175%;
  color: #ff5500;
  margin-top: 2.1rem;
  margin-bottom: 1.2rem;
  line-height: 1;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1); /*same as default h2*/
  padding-bottom: 1rem;
}

d-article h2 {
  font-family: 'Open Sans Condensed', Roboto, Helvetica, Arial, sans;
  font-style: normal;
  font-weight: 400;
  font-size: 150%;
  color: #ff5500;
  margin-top: 2.1rem;
  margin-bottom: 1.2rem;
  line-height: 1;
  /* to remove will require something to keep the inline from inserting */
  border-bottom: 0px solid rgba(0, 0, 0, 0.1); 
  padding-bottom: 1rem; 
  
}


d-article h3 {
  font-family: 'Open Sans Condensed', Roboto, Helvetica, Arial, sans;
  font-style: normal;
  font-weight: 400;
  font-size: 125%;
  color: #ff5500;
  opacity: .9;
  margin-top: 2rem;
  margin-bottom: 1.2rem;
  line-height: 1;
}

d-article  h4 {
  font-family: 'Open Sans Condensed', Roboto, Helvetica, Arial, sans;
  font-style: normal;
  text-transform: none;  /*default is uppercase*/
  font-weight: 400;
  font-size: 110%;
  color: #ff5500;
  opacity: .9;
  margin-top: 1.9rem;
  margin-bottom: 1.2rem;
  line-height: 1;
}

d-article  h5 {
  font-family: 'Open Sans Condensed', Roboto, Helvetica, Arial, sans;
  font-style: normal;
  text-transform: none;  /*default is uppercase*/
  font-weight: 400;
  font-size: 100%;
  color: #ff5500;
  opacity: .9;
  margin-top: 1.9rem;
  margin-bottom: 1.2rem;
  line-height: 1;
}



/* Nav bar */

.distill-site-nav {
  color: #404040;
  background-color: #d9edf7;
  font-size: 20px;
  font-weight: 300;
}


.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: #0085a1;
}

/* sidebar on front page with category listing */

.posts-with-sidebar .posts-sidebar {
  float: right;
  width: 10%;    /* default 20, made narrow */
  margin-top: 60px;
  padding-top: 24px;
  padding-bottom: 24px;
}

/* attempt to make result not so wide/spacious */ 

.posts-with-sidebar .posts-list {
  width: 66%;
  margin-left: 11%;
}

.posts-sidebar {
  font-size: 75%;
  margin-right: 10%;
}


/* code */

/* will now work as of latest distill version*/

d-article div.sourceCode code, d-article pre code {
  font-family: 'Roboto Mono', Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  color: #404040FF;
  font-size: 90%;
}


d-article pre {
  background-color: #FFFFF8;
}

/* Otherwise will leave a white background visible at bottom of code chunks*/
d-article div.sourceCode {
  background-color: #FFFFF8;
}

/* code results/output */
pre.text-output {
  font-family: 'Roboto Mono', Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  color: #000000CC;
}



/* latex */
.math {
  color: #404040;  
  font-weight: normal;
  font-size: 90%;
}


/* link effects; appendix apply to footnote return links */

/*remove old line*/
d-article a:hover {
  text-decoration: none;
  border-bottom: none;
  background-size: 100% 100%;
  cursor: pointer;
}


/* add new effects */
p a, aside a, li a, d-appendix a, a.footnote-backlink {
    color: #03b3ff;
    display: inline-block;
    text-decoration: none;
    transition: background-size .4s ease;
    border-bottom: 0px solid;
}

p a {
  /* text-decoration: underline */
  color: #03b3ff;
}

p a:after, aside a:after, li a:after, d-appendix a:after {
    content: '';
    display: block;
    width: 0;
    height: 1.25px;
    background: #FF4F03;
    transition: width .3s;
}

p a:hover::after, aside a:hover::after, li a:hover::after, d-appendix a:hover::after {
  width: 100%;
  //transition: width .3s;
 }

/* for twitter etc icon links */
.social-icon {
  color: #03b3ff;
  background-image: none;  /* remove hover line*/
  background-size: 0 100%;
  background-repeat: no-repeat;
  text-decoration: none;
  transition: background-size .4s ease;
  border-bottom: 0px solid;
}

d-footnote-list a.footnote-backlink {
    color:  #03b3ff !important; /* otherwise some inline injection will occur*/
    padding-left: 0.5em;
}

.categories li > a:hover {
  border-bottom: none !important;
}

/* remove underline for TOC */
.d-contents nav a:hover {
    text-decoration: none;
}



/* text highlights */
.emph, em {
  color: #E32D00;  /*#ff5500 #D14300*/
  font-style: normal;
  font-weight: 450;
}

/* don't do color for references */
.references em {
  color: rgba(0,0,0,0.5);
  font-style: normal;
  font-weight: 450;
}

strong {
  color: #404040;  
}

/* pack func and objclass colors initially come from hcl(seq(90,360, length.out=4), c=80, l=80); redone for contrast*/
.pack {
  color: #1f65b7; /* #990071 #AC9CFF #e41a1c*/
  font-weight: 400;
}

.func {
  color: #007020;   /*#007199 #00CBB6; #984ea3; can just use `` instead*/
  font-weight: 400;
}

.objclass {
  color:  #947100;  /*#AAB400 #4daf4a; #FFC5D0*/
  font-weight: 400;
}

/* object/class via inline code */
p code {
  color: #947100;
}


/* figures and tables */

d-article table {
    border-collapse: collapse;
    margin-top: 20px;
    margin-bottom: 20px;
    border-bottom: 1px solid rgba(0, 0, 0, 0.2);
}

/* add spacing for figs and tables, so text and other figs/tables don't 
start right up at their border */
.l-body {
  margin-top: 20px;
  margin-bottom: 20px;
}

/* Search bar */

.algolia-autocomplete {
    display: inline-block;
    margin-left: 10px;
    vertical-align: sub;
    background-color: #fffff8;
    color: #03b3ff;             /* Color of text in drop-down*/
    padding: 6px;
    padding-top: 8px;
    padding-bottom: 0;
    border-radius: 6px;
    border: 0px #03b3ff solid;  /* Removed border */
    width: 180px;
}
</style>
<!--/radix_placeholder_site_in_header-->

  <link rel="stylesheet" href="../../test.css" type="text/css"/>

</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Mediation Models","description":"Various package options for conducting mediation analysis","authors":[{"author":"Michael Clark","authorURL":"https://m-clark.github.io","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}],"publishedDate":"2019-03-12T00:00:00.000+00:00","citationText":"Clark, 2019"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a class="logo" href="../../index.html">
<img src="../../img/mc_logo.png" alt="Logo"/>
</a>
<a href="../../index.html" class="title">Michael Clark</a>
<input id="distill-search" class="nav-search hidden" type="text" placeholder="Search..."/>
</div>
<div class="nav-right">
<a href="../../about.html">About</a>
<a href="../../documents.html">Documents</a>
<a href="../../workshops.html">Workshops</a>
<a href="../../code.html">Code</a>
<a href="../../resources.html">Resources</a>
<a href="https://github.com/m-clark">
<i class="fab fa-github-alt fa-1x" aria-hidden="true"></i>
</a>
<a href="../../index.xml">
<i class="fa fa-rss fa-1x" aria-hidden="true"></i>
</a>
<a href="https://twitter.com/statsdatasci">
<i class="fab fa-twitter fa-1x" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Mediation Models</h1>
<p><p>Various package options for conducting mediation analysis</p></p>
</div>

<div class="d-byline">
  Michael Clark <a href="https://m-clark.github.io" class="uri">https://m-clark.github.io</a> 
  
<br/>2019-03-12
</div>

<div class="d-article">
<h3 class="d-toc-header">Table of Contents</h3>
<nav class="d-toc" id="TOC">
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#data">Data</a></li>
<li><a href="#model">Model</a></li>
<li><a href="#packages">Packages</a><ul>
<li><a href="#mediation">mediation</a></li>
<li><a href="#lavaan">lavaan</a></li>
<li><a href="#piecewisesem">piecewiseSEM</a></li>
<li><a href="#psych">psych</a></li>
<li><a href="#brms">brms</a></li>
</ul></li>
<li><a href="#more-complexity">More complexity</a><ul>
<li><a href="#interactions">Interactions</a></li>
<li><a href="#generalized-linear-models">Generalized Linear Models</a></li>
<li><a href="#missing-data">Missing data</a></li>
</ul></li>
<li><a href="#alternatives">Alternatives</a><ul>
<li><a href="#bnlearn">bnlearn</a></li>
<li><a href="#python">Python</a></li>
<li><a href="#stata">Stata</a></li>
</ul></li>
<li><a href="#summary">Summary</a></li>
</ul>
</nav>
<hr class="d-toc-separator"/>
<p>Updated August 04, 2020. Code can be downloaded <a href="https://raw.githubusercontent.com/m-clark/m-clark.github.io/master/_posts/2019-03-12-mediation-models/mediation-models-code.R">here</a>.</p>
<p><br></p>
<h2 id="introduction">Introduction</h2>
<p>In some situations we may consider the <span class="emph">indirect effect</span> of some variable on an outcome or result. As an example, poor living conditions at home in childhood may decrease learning outcomes in school, which subsequently have a negative effect on later quality of life, for example, lifetime income earnings. In another case we might consider a single variable collected at multiple time points, such that there exists an effect of the variable at time 1 on time 2, and time 2 on time 3. The basic idea is something like:</p>
<p><span class="math display">\[\mathcal{A} \rightarrow \mathcal{B} \rightarrow \mathcal{C}\]</span></p>
<p>In other words, <span class="math inline">\(\mathcal{A}\)</span> leads to <span class="math inline">\(\mathcal{B}\)</span>, and then <span class="math inline">\(\mathcal{B}\)</span> leads to <span class="math inline">\(\mathcal{C}\)</span>. With <span class="emph">mediation</span> models, we posit an intervening variable between the normal covariate <span class="math inline">\(\rightarrow\)</span> outcome path that we might have in the standard regression setting, and these models allow us to investigate such behaviors. In the above, the intervening variable, or <em>mediator</em>, is <span class="math inline">\(\mathcal{B}\)</span>. It is often the case that we still might have a <span class="emph">direct effect</span> of <span class="math inline">\(\mathcal{A}\)</span> on <span class="math inline">\(\mathcal{C}\)</span>, but as with the model in general, this would be theoretically motivated.</p>
<p>Mediation analysis is very popular in social science disciplines, though by no means restricted to those, and usually conducted under the guise of structural equation modeling (SEM), which itself is a specific orientation of graphical models more generally<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. The graphical model of a mediation model might look like the following.</p>
<aside>
Confounding and mediation are not distinguishable statistically in the standard linear model setting, only conceptually. One way to think about it is that confounding doesn’t require a causal relationship, and/or could be a common cause between the variable of interest and the outcome. See <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2819361/">MacKinnon et al.</a>
</aside>
<div class="layout-chunk" data-layout="l-body">
<div id="htmlwidget-6d2582b6b7d37f33d5a6" style="width:800px;height:200px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-6d2582b6b7d37f33d5a6">{"x":{"diagram":"digraph mediation {\ngraph [rankdir = BT  bgcolor=transparent]\n\nnode [shape = rectangle style=filled fillcolor=\"#d9edf7\" color=gray80 width=.5 height=.25]\n\nnode [fontcolor=\"#404040\" fontname=Roboto fixedsize=true fontsize=\"5%\"]\n subgraph {\n    rank = same;\n    X;  Outcome;\n }\n \n Mediator;\n\nedge [color=gray50 fontsize=6 style=filled arrowsize=.5]\n\nX -> Mediator[label=\"a\"]; Mediator -> Outcome[label=\"b\"]; X -> Outcome [label = \" c′ \" minlen=5];\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
<p>In this case, <code>a</code> and <code>b</code> reflect the indirect path of the effect of <span class="math inline">\(\mathrm{X}\)</span> on the outcome through the mediator, while <code>c'</code> is the direct effect of <span class="math inline">\(\mathrm{X}\)</span> on the outcome after the indirect path has been removed (<code>c</code> would be the effect before positing the indirect effect, and <code>c</code> - <code>c'</code> equals the indirect effect). The <span class="emph" style="">total effect</span> of <span class="math inline">\(\mathrm{X}\)</span> is the combined indirect and direct effects.</p>
<p>I should note a few things based on what I see in consulting across dozens of disciplines. To begin, it seems very few people who think they need a mediation model actually do. For example, if you cannot think of your model in temporal or physical terms, such that <span class="math inline">\(\mathrm{X}\)</span> <em>necessarily</em> leads to the mediator, which then <em>necessarily</em> leads to the outcome, you likely do not need a mediation model. If you could see the arrows going either direction, again, you probably don’t need such a model. Also, if when describing your model, everyone thinks you’re talking about an interaction (a.k.a. <span class="emph">moderation</span>), you might not need this. And finally, as one might suspect, if there is no <strong>strong</strong> correlation between key variables (<span class="math inline">\(\mathrm{X}\)</span>) and mediator (path <code>a</code>), and if there is no <strong>strong</strong> correlation between mediator and the outcome(s) (path <code>b</code>), you probably don’t need this. While nothing will stop you from doing mediation analysis, without such prerequisites, you will almost certainly have a weak and probably more confusing model than you otherwise would have.</p>
<p>In short, mediation works best when there are strongly implied causal connections among the variables. Even then, such a model should be compared to simpler model of no mediation<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>. In any case, there are a few very easy ways to investigate such models in R, and that is the goal here, just to demonstrate how you can get started.</p>
<h2 id="data">Data</h2>
<p>For demonstration of mediation models with the different packages, we will use the <span class="objclass">jobs</span> data set that comes with the <span class="pack">mediation</span> package. Here is the description.</p>
<p><span style="font-size: 75%;">Job Search Intervention Study (JOBS II). JOBS II is a randomized field experiment that investigates the efficacy of a job training intervention on unemployed workers. The program is designed to not only increase reemployment among the unemployed but also enhance the mental health of the job seekers. In the JOBS II field experiment, 1,801 unemployed workers received a pre-screening questionnaire and were then randomly assigned to treatment and control groups. Those in the treatment group participated in job-skills workshops. In the workshops, respondents learned job-search skills and coping strategies for dealing with setbacks in the job-search process. Those in the control condition received a booklet describing job-search tips. In follow-up interviews, the two key outcome variables were a continuous measure of depressive symptoms based on the Hopkins Symptom Checklist, and a binary variable, representing whether the respondent had become employed.</span></p>
<p>Here is a description of the variables in this demonstration. There are others available you might also want to play around with.</p>
<ul>
<li><span class="objclass">econ_hard</span>: Level of economic hardship pre-treatment with values from 1 to 5.</li>
<li><span class="objclass">sex</span>: Indicator variable for sex. 1 = female</li>
<li><span class="objclass">age</span>: Age in years.</li>
<li><span class="objclass">educ</span>: Factor with five categories for educational attainment.</li>
<li><span class="objclass">job_seek</span>: A continuous scale measuring the level of job-search self-efficacy with values from 1 to 5. The mediator variable.</li>
<li><span class="objclass">depress2</span>: Measure of depressive symptoms post-treatment. The outcome variable.</li>
<li><span class="objclass">treat</span>: Indicator variable for whether participant was randomly selected for the JOBS II training program. 1 = assignment to participation.</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
data(jobs, package = &#39;mediation&#39;)</code></pre>
</div>
<h2 id="model">Model</h2>
<p>Given this data the models for the mediator and outcome are as follows:</p>
<p><span class="math display">\[
\begin{aligned}
\mathrm{\color{#00b294}{job\_seek}} &amp;\sim \mathrm{\color{#b2001d}{treatment} + econ\_hard + sex + age} \\
\mathrm{depression} &amp;\sim \mathrm{\color{#b2001d}{treatment} + econ\_hard + sex + age + \color{#00b294}{job\_seek}}
\end{aligned}
\]</span></p>
<p>Thus we expect the job skills training to have a negative effect on depression (i.e. an increase in well-being), but at least part of this would be due to a positive effect on job search.</p>
<p>As a graphical model, we might depict it succinctly as follows.</p>
<div class="layout-chunk" data-layout="l-body">
<div id="htmlwidget-4f392d2d4de7d01efc08" style="width:800px;height:200px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-4f392d2d4de7d01efc08">{"x":{"diagram":"digraph mediation {\ngraph [rankdir = TB  bgcolor=transparent]\n\n    \nnode [shape = rectangle style=filled color=gray80 width=.5 height=.25 fontname=Roboto fixedsize=true fontsize=\"5%\"]\n\nnode [fillcolor=\"gray90\" ]\n    other; \nnode [fillcolor=\"#d9edf7\" ]\n    treatment;  depress2; job_seek;\n \n subgraph {\n    rank = same;\n    treatment;  depress2;\n }\n subgraph {\n    rank = same;\n    other; job_seek;\n }\n\n\n\nedge [color=gray95 fontsize=6 style=filled arrowsize=.5]\nother -> depress2 [];\nother -> job_seek [];\n\nedge [color=gray50 fontsize=6 style=filled arrowsize=.5]\ntreatment -> job_seek[label=\" a\" ]; \njob_seek -> depress2[label=\" b\" ]; \ntreatment -> depress2 [label = \" c′ \" ];\n\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
<h2 id="packages">Packages</h2>
<p>We will look at the following packages to demonstrate how one can conduct mediation analysis in R:</p>
<ul>
<li><span class="pack">mediation</span></li>
<li><span class="pack">lavaan</span></li>
<li><span class="pack">psych</span></li>
<li><span class="pack">brms</span></li>
</ul>
<p>While these will be the focus, I’ll also note some other alternatives, including Python and Stata.</p>
<h3 id="mediation">mediation</h3>
<p>We will start with the <span class="pack">mediation</span> package, as it basically requires no more programming ability to conduct than one possesses already from running standard regression models in R. The package provides the <span class="emph">average causal mediation effect</span>, defined as follows from the help file and Imai’s articles<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>:</p>
<blockquote>
<p>The average causal mediation effect (ACME) represents the expected difference in the potential outcome when the mediator took the value that would realize under the treatment condition as opposed to the control condition, while the treatment status itself is held constant.</p>
</blockquote>
<p>Note how this definition is focused on expected or predicted values conditional on the treatment value. This notion of <span class="emph">counterfactuals</span>, or what would the observation look like under the opposite setting, has a long history in modeling at this point. Think of it this way, if one is in the treatment group, they would have a specific value for the mediator, and, given that, they would then have a specific expected value for the outcome. However, we could posit the same observation as being in the control group as well, and assess the effect on the outcome through the mediator just the same. We can assess the <span class="emph" style="">potential outcomes</span> while holding the treatment constant. Thinking of outcome changes given the value of the mediator makes no assumption about the model type. This is how the <span class="pack">mediation</span> package is able to incorporate different models for the mediator vs. the outcome. For example, the mediator could be binary, requiring a logistic regression model, while the outcome model might be a survival model.</p>
<aside>
As this document is a tools-based demo and not for depth, see the works of <a href="http://bayes.cs.ucla.edu/jp_home.html">Judea Pearl</a> for more details.
</aside>
<p>In our example, we will stick with standard (normal) linear models. Note also, that while our treatment is a binary variable, this generalizes to the continuous case, where we consider the result of a one unit movement on the ‘treatment’. For the <span class="pack">mediation</span> package to work, we simply run our respective models for the mediator and outcome, then use the <span class="func">mediate</span> function to get the final result.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
library(mediation)

model_mediator &lt;- lm(job_seek ~ treat + econ_hard + sex + age, data = jobs)
model_outcome  &lt;- lm(depress2 ~ treat + econ_hard + sex + age + job_seek, data = jobs)

# Estimation via quasi-Bayesian approximation
?mediate
mediation_result &lt;- mediate(
  model_mediator, 
  model_outcome, 
  sims = 500,
  treat = &quot;treat&quot;,
  mediator = &quot;job_seek&quot;
)

detach(package:mediation)
detach(package:MASS)</code></pre>
</div>
<aside>
<p>The result is based on simulations of a multivariate normal draw of the coefficients given their estimated covariance matrix. The algorithm is summarized as follows (from Imai et al. 2010)</p>
<ol type="1">
<li>Fit models for the observed outcome and mediator variables.</li>
<li>Simulate model parameters from their sampling distribution.</li>
<li>Repeat the following three steps:
<ol type="a">
<li>simulate the potential values of the mediator,</li>
<li>simulate the potential outcomes given the simulated values of the mediator,</li>
<li>compute the causal mediation effects.</li>
</ol></li>
<li>Compute summary statistics such as point estimates and confidence intervals.</li>
</ol>
With this approach we can obtain the average difference and corresponding quantiles based on the simulated draws.
</aside>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
summary(mediation_result)
plot(mediation_result)</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
95% CI Lower
</th>
<th style="text-align:right;">
95% CI Upper
</th>
<th style="text-align:right;">
p-value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
ACME
</td>
<td style="text-align:right;">
-0.016
</td>
<td style="text-align:right;">
-0.038
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:right;">
0.220
</td>
</tr>
<tr>
<td style="text-align:left;">
ADE
</td>
<td style="text-align:right;">
-0.045
</td>
<td style="text-align:right;">
-0.127
</td>
<td style="text-align:right;">
0.047
</td>
<td style="text-align:right;">
0.292
</td>
</tr>
<tr>
<td style="text-align:left;">
Total Effect
</td>
<td style="text-align:right;">
-0.061
</td>
<td style="text-align:right;">
-0.149
</td>
<td style="text-align:right;">
0.027
</td>
<td style="text-align:right;">
0.188
</td>
</tr>
<tr>
<td style="text-align:left;">
Prop. Mediated
</td>
<td style="text-align:right;">
0.226
</td>
<td style="text-align:right;">
-3.222
</td>
<td style="text-align:right;">
1.596
</td>
<td style="text-align:right;">
0.344
</td>
</tr>
</tbody>
</table>
<p><img src="mediation-models_files/figure-html5/mediation_result_pretty-1.svg" width="624" style="display: block; margin: auto;" /></p>
</div>
<p>The results above demonstrate that the ACME is not statistically distinct from zero, or no mediation. The average direct effect is negative but likewise not statistically notable, neither is the total effect (indirect + direct effect). Also provided is the soi disant ‘proportion mediated’, which is the ratio of the indirect effect to the total. However this is not a proportion, and can even be negative, and so is mostly a meaningless number.</p>
<h4 id="pros">Pros</h4>
<ul>
<li>Standard R models and syntax</li>
<li>Multiple types of models for both mediator and outcome</li>
<li>Provides multiple results simultaneously</li>
<li>Good documentation and associated articles are freely available</li>
<li>Can do ‘moderated’ mediation</li>
</ul>
<h4 id="limitations">Limitations</h4>
<ul>
<li>Use of MASS<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></li>
<li>Simple random effects models</li>
<li>Functionality maybe limited with some model complexities</li>
<li>No latent variable capabilities</li>
</ul>
<h3 id="lavaan">lavaan</h3>
<p>In the specific case where both mediation and outcome models are standard linear models with a normal distribution for the target variable, the indirect effect is equivalent to the product of the <code>a</code> and <code>b</code> paths in the previous diagram. The direct effect is the <code>c'</code> path. A comparison of standalone direct effect, which we might call <code>c</code>, vs this estimated direct effect in the mediation model <code>c'</code>, is such that <code>c - c' = a*b</code>. What was mentioned earlier might now be more clear, if either <code>a</code> or <code>b</code> are nearly zero, then the indirect effect can only be nearly zero, so it is prudent to investigate such relationships beforehand.</p>
<aside>
<img src="../../img/mediation_basic.png" style="display:block; margin:0 0; width:150%">
</aside>
<p>This product-of-paths (or difference in coefficients) approach is the one we will take with the <span class="pack">lavaan</span> package, and in fact, as of this writing, that is our only way of going about it. <span class="pack">lavaan</span> is specifically geared toward structural equation modeling, such as factor analysis, growth models, and mediation models like we’re conducting here, and is highly recommended for such models. While it is limited to the standard linear model case to assess mediation, it is the only one of our tools that can incorporate latent variables readily<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>. For example, we could have our depression outcome as a latent variable underlying the individual questionnaire items. In addition, we could also incorporate multiple mediators and multiple outcomes.</p>
<aside>
<span class="pack">lavaan</span> can still estimate the model with binary or ordinal variables, there just is no way to produce the proper indirect effect, at least not without a lot more effort.
</aside>
<p>To keep things as we have been discussing, I will label the <code>a</code>, <code>b</code> and <code>c'</code> paths in <span class="pack">lavaan</span> according to how they have been depicted previously. Otherwise <span class="pack">lavaan</span> is very easy to use, and in the case of observed variables, uses standard R formula notation for the models. Beyond that we define the effects of interest that we want to calculate with the <code>:=</code> operator. We specify the model in its entirety as a simple character string, then use the <span class="func">sem</span> function to do the analysis.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
library(lavaan)

sem_model = &#39;
  job_seek ~ a*treat + econ_hard + sex + age
  depress2 ~ c*treat + econ_hard + sex + age + b*job_seek
 
  # direct effect
  direct := c
 
  # indirect effect
  indirect := a*b
 
  # total effect
  total := c + (a*b)
&#39;

model_sem = sem(sem_model, data=jobs, se=&#39;boot&#39;, bootstrap=500)
summary(model_sem, rsq=T)  # compare with ACME in mediation</code></pre>
<pre><code>
lavaan 0.6-6 ended normally after 25 iterations

  Estimator                                         ML
  Optimization method                           NLMINB
  Number of free parameters                         11
                                                      
  Number of observations                           899
                                                      
Model Test User Model:
                                                      
  Test statistic                                 0.000
  Degrees of freedom                                 0

Parameter Estimates:

  Standard errors                            Bootstrap
  Number of requested bootstrap draws              500
  Number of successful bootstrap draws             500

Regressions:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
  job_seek ~                                          
    treat      (a)    0.066    0.049    1.332    0.183
    econ_hard         0.053    0.024    2.242    0.025
    sex              -0.008    0.047   -0.163    0.870
    age               0.005    0.002    1.934    0.053
  depress2 ~                                          
    treat      (c)   -0.040    0.044   -0.905    0.365
    econ_hard         0.149    0.022    6.908    0.000
    sex               0.107    0.038    2.831    0.005
    age               0.001    0.002    0.332    0.740
    job_seek   (b)   -0.240    0.030   -8.079    0.000

Variances:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
   .job_seek          0.524    0.030   17.610    0.000
   .depress2          0.373    0.022   17.178    0.000

R-Square:
                   Estimate
    job_seek          0.011
    depress2          0.120

Defined Parameters:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
    direct           -0.040    0.045   -0.904    0.366
    indirect         -0.016    0.012   -1.324    0.185
    total            -0.056    0.046   -1.224    0.221</code></pre>
</div>
<p>We see the same output before and can compare our <code>indirect</code> parameter to the ACME we had before, the <code>direct</code> effect is compared to the ADE, and the <code>total</code> compares to the previous total effect. The values are essentially the same.</p>
<p>Note also that the output shows the <span class="math inline">\(R^2\)</span> value for both models. In the case of <code>job_seek</code>, we can see that the reason we’re not finding much in the way of mediation is because the covariates involved do not explain any variation in the mediator to begin with. Preliminary investigation would have saved us the trouble in this case.</p>
<h4 id="pros-1">Pros</h4>
<ul>
<li>Can handle multiple mediators</li>
<li>Can handle multiple ‘treatments’</li>
<li>Can handle multiple outcomes</li>
<li>Can use latent variables</li>
<li>Some multilevel support</li>
<li>Can do moderated mediation and mediated moderation (though not for latent variables)</li>
</ul>
<h4 id="limitations-1">Limitations</h4>
<ul>
<li>Requires additional coding to estimate the indirect effect</li>
<li>Single random effects</li>
<li>While the models could incorporate binary or ordinal variables for the mediator/outcomes, there is no straightforward way to calculate the indirect effect in the manner of the <span class="pack">mediation</span> package in those settings.</li>
</ul>
<h3 id="piecewisesem">piecewiseSEM</h3>
<p>The <span class="pack" style="">piecewiseSEM</span> package works very similar to the <span class="pack" style="">mediation</span> package. The nice thing about this relative to the <span class="pack" style="">mediation</span> package is that <span class="pack" style="">piecewiseSEM</span> can handle additional types of models, as well as provide additional output (e.g. standardized results), additional options (e.g. multigroup, correlated residuals), and visualization of the model.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
library(piecewiseSEM)

model_mediator &lt;- lm(job_seek ~ treat + econ_hard + sex + age, data = jobs)
model_outcome  &lt;- lm(depress2 ~ treat + econ_hard + sex + age + job_seek, data = jobs)

mediation_result &lt;-  psem(model_mediator, model_outcome, data = jobs)

summary(mediation_result)</code></pre>
<pre><code>
Structural Equation Model of mediation_result 

Call:
  job_seek ~ treat + econ_hard + sex + age
  depress2 ~ treat + econ_hard + sex + age + job_seek

    AIC      BIC
 26.000   88.417

---
Tests of directed separation:

 No independence claims present. Tests of directed separation not possible.

Global goodness-of-fit:

  Fisher&#39;s C = 0 with P-value = 1 and on 0 degrees of freedom

---
Coefficients:

  Response Predictor Estimate Std.Error  DF Crit.Value P.Value Std.Estimate    
  job_seek     treat   0.0656    0.0515 894     1.2748  0.2027       0.0425    
  job_seek econ_hard   0.0532    0.0246 894     2.1612  0.0309       0.0720   *
  job_seek       sex  -0.0076    0.0487 894    -0.1567  0.8755      -0.0052    
  job_seek       age   0.0046    0.0023 894     1.9779  0.0482       0.0658   *
  depress2     treat  -0.0403    0.0435 893    -0.9255  0.3550      -0.0291    
  depress2 econ_hard   0.1485    0.0208 893     7.1323  0.0000       0.2248 ***
  depress2       sex   0.1068    0.0411 893     2.5957  0.0096       0.0818  **
  depress2       age   0.0006    0.0020 893     0.3306  0.7410       0.0104    
  depress2  job_seek  -0.2400    0.0282 893    -8.4960  0.0000      -0.2682 ***

  Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05

---
Individual R-squared:

  Response method R.squared
  job_seek   none      0.01
  depress2   none      0.12</code></pre>
</div>
<p>We can use it’s plotting capabilities to create a quick visualization of the model.</p>
<aside>
The plot is using <span class="pack" style="">Diagrammer</span> and <span class="pack" style="">graphviz</span> under the hood, which is appealing to me as I use those anyway, so could use the generated code as a starting point.
</aside>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
plot(mediation_result)</code></pre>
<div id="htmlwidget-0ae4e51414d18be25606" style="width:624px;height:384px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-0ae4e51414d18be25606">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"job_seek\", shape = \"rectangle\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"2\" [label = \"depress2\", shape = \"rectangle\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"3\" [label = \"treat\", shape = \"rectangle\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"4\" [label = \"econ_hard\", shape = \"rectangle\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"5\" [label = \"sex\", shape = \"rectangle\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"6\" [label = \"age\", shape = \"rectangle\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n\"3\"->\"1\" [style = \"dashed\", color = \"black\", label = \" 0.043 \"] \n\"4\"->\"1\" [style = \"solid\", color = \"black\", label = \" 0.072 \"] \n\"5\"->\"1\" [style = \"dashed\", color = \"black\", label = \" -0.005 \"] \n\"6\"->\"1\" [style = \"solid\", color = \"black\", label = \" 0.066 \"] \n\"3\"->\"2\" [style = \"dashed\", color = \"black\", label = \" -0.029 \"] \n\"4\"->\"2\" [style = \"solid\", color = \"black\", label = \" 0.225 \"] \n\"5\"->\"2\" [style = \"solid\", color = \"black\", label = \" 0.082 \"] \n\"6\"->\"2\" [style = \"dashed\", color = \"black\", label = \" 0.01 \"] \n\"1\"->\"2\" [style = \"solid\", color = \"black\", label = \" -0.268 \"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
<p>Unfortunately, there is no automatic way to calculate the indirect effects at present, so one would have to bootstrap the results by hand.</p>
<aside>
There used to be a package to calculate indirect effects of a <span class="pack" style="">psem</span> object, semEff, but it currently <a href="https://github.com/murphymv/semEff/issues/5">doesn’t work</a>.
</aside>
<div class="layout-chunk" data-layout="l-body">

</div>
<h4 id="pros-2">Pros</h4>
<ul>
<li>Standard R models and syntax</li>
<li>Multiple types of models for both mediator and outcome</li>
<li>Some SEM-style results (e.g. fit, standardized coefficients, AIC)</li>
<li>Quick plot of results</li>
<li>Can handle multiple mediators, ‘treatments’, and outcomes</li>
</ul>
<h4 id="limitations-2">Limitations</h4>
<ul>
<li>Doesn’t automatically calculate indirect effects</li>
<li>No latent variable capabilities</li>
</ul>
<h3 id="psych">psych</h3>
<p>The <span class="pack">psych</span> package takes advantage of the fact that in the standard linear model case, one can obtain the results via the appropriate regression models based on the covariance matrices alone. It’s very similar to <span class="pack">lavaan</span>, although using an ordinary least squares approach as opposed to maximum likelihood. The nice thing here is a syntax that allows you to focus only on the effect of interest, or include everything, which is nice if you were interested in the indirect effects for economic hardship, age, and sex as well.</p>
<p>For this demo we’ll use the cleaned up version using the <code>-</code>, instead of <code>+</code>, for the non-treatment effects. This just means they are included with the models, but results are not shown concerning them. The mediator is identified with <code>()</code>. Another bonus is a quick plot of the results, showing the difference between the unadjusted and adjusted direct effects, and the appropriate bootstrapped interval.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
library(psych)

mediation_psych = mediate(
  depress2 ~ treat + (job_seek) - econ_hard - sex - age, 
  data = jobs,
  n.iter = 500
)</code></pre>
<p><img src="mediation-models_files/figure-html5/psych_mediate-1.svg" width="624" style="display: block; margin: auto;" /></p>
<pre class="r"><code>
mediation_psych</code></pre>
<pre><code>
Mediation/Moderation Analysis 
Call: mediate(y = depress2 ~ treat + (job_seek) - econ_hard - sex - 
    age, data = jobs, n.iter = 500)

The DV (Y) was  depress2* . The IV (X) was  treat* . The mediating variable(s) =  job_seek* . Variable(s)  partialled out were econ_hard sex age

Total effect(c) of  treat*  on  depress2*  =  -0.06   S.E. =  0.05  t  =  -1.24  df=  895   with p =  0.21
Direct effect (c&#39;) of  treat*  on  depress2*  removing  job_seek*  =  -0.04   S.E. =  0.15  t  =  14.91  df=  893   with p =  4.6e-45
Indirect effect (ab) of  treat*  on  depress2*  through  job_seek*   =  -0.02 
Mean bootstrapped indirect effect =  -0.02  with standard error =  0.01  Lower CI =  -0.04    Upper CI =  0.01
R = 1.07 R2 = 1.15   F = -3510.4 on 2 and 893 DF   p-value:  1 

 To see the longer output, specify short = FALSE in the print statement or ask for the summary</code></pre>
<pre class="r"><code>
summary(mediation_psych)</code></pre>
<pre><code>
Call: mediate(y = depress2 ~ treat + (job_seek) - econ_hard - sex - 
    age, data = jobs, n.iter = 500)

Direct effect estimates (traditional regression)    (c&#39;) 
          depress2*   se     t  df     Prob
Intercept      2.21 0.15 14.91 893 4.60e-45
treat         -0.04 0.04 -0.93 893 3.55e-01
job_seek      -0.24 0.03 -8.50 893 8.14e-17

R = 1.07 R2 = 1.15   F = -3510.4 on 2 and 893 DF   p-value:  1 

 Total effect estimates (c) 
      depress2*   se     t  df  Prob
treat     -0.06 0.05 -1.24 895 0.215

 &#39;a&#39;  effect estimates 
          job_seek   se     t  df      Prob
Intercept     3.67 0.13 29.33 894 5.65e-133
treat         0.07 0.05  1.27 894  2.03e-01

 &#39;b&#39;  effect estimates 
         depress2*   se    t  df     Prob
job_seek     -0.24 0.03 -8.5 894 7.83e-17

 &#39;ab&#39;  effect estimates (through mediators)
      depress2*  boot   sd lower upper
treat     -0.02 -0.02 0.01 -0.04  0.01</code></pre>
</div>
<p>Same results, different packaging, but possibly the easiest route yet as it only required one function call. The <span class="pack">psych</span> package also handles multiple mediators and outcomes as a bonus.</p>
<h4 id="pros-3">Pros</h4>
<ul>
<li>Easiest syntax, basically a one line model</li>
<li>Quick plot of results</li>
<li>Can handle multiple mediators, ‘treatments’, and outcomes</li>
<li>Can do ‘moderated’ mediation</li>
</ul>
<h4 id="limitations-3">Limitations</h4>
<ul>
<li>Limited to standard linear model (<code>lm</code>)</li>
<li>Use of MASS</li>
</ul>
<h3 id="brms">brms</h3>
<p>For our next demo we come to what I feel is the most powerful package, <span class="pack">brms</span>. The name stands for Bayesian Regression Modeling with Stan, and Stan is a powerful probabilistic programming language for Bayesian analysis. I won’t go into details about Bayesian analysis, but feel free to see <a href="https://m-clark.github.io/bayesian-basics/">my document</a> that does.</p>
<p>We generally do as we have before, specifying the mediator model and the outcome model. <span class="pack">brms</span> doesn’t do anything special for mediation analysis, but its <span class="func">hypothesis</span> function can allow us to test the product-of-paths approach. Furthermore, the <span class="pack">sjstats</span> package will essentially provide the results in the same way the <span class="pack">mediation</span> package does for us, and for that matter, the <span class="pack">mediation</span> package is basically an attempt at a Bayesian solution using frequentist methods anyway. If we did have different distributions for the outcome and mediator, we’d have an relatively easy time getting these average prediction values and their differences, as Bayesian approaches are always thinking about posterior predictive distributions. In any case, here is the code.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
library(brms)

model_mediator &lt;- bf(job_seek ~ treat + econ_hard + sex + age)
model_outcome  &lt;- bf(depress2 ~ treat + job_seek + econ_hard + sex + age)

med_result = brm(
  model_mediator + model_outcome + set_rescor(FALSE), 
  data = jobs
)
save(med_result, file = &#39;data/mediation_brms.RData&#39;)</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">

<pre class="r"><code>
load(&#39;data/mediation_brms.RData&#39;)
summary(med_result)</code></pre>
<pre><code>
 Family: MV(gaussian, gaussian) 
  Links: mu = identity; sigma = identity
         mu = identity; sigma = identity 
Formula: job_seek ~ treat + econ_hard + sex + age 
         depress2 ~ treat + job_seek + econ_hard + sex + age 
   Data: jobs (Number of observations: 899) 
Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup samples = 4000

Population-Level Effects: 
                   Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
jobseek_Intercept      3.67      0.12     3.43     3.91 1.00     6699     3749
depress2_Intercept     2.21      0.15     1.92     2.50 1.00     6174     3091
jobseek_treat          0.07      0.05    -0.03     0.17 1.00     6322     2709
jobseek_econ_hard      0.05      0.02     0.00     0.10 1.00     6266     2656
jobseek_sex           -0.01      0.05    -0.10     0.09 1.00     5741     2655
jobseek_age            0.00      0.00     0.00     0.01 1.00     6539     2846
depress2_treat        -0.04      0.04    -0.12     0.04 1.00     5458     3102
depress2_job_seek     -0.24      0.03    -0.30    -0.18 1.00     5950     2938
depress2_econ_hard     0.15      0.02     0.11     0.19 1.00     7543     3102
depress2_sex           0.11      0.04     0.03     0.19 1.00     5599     2699
depress2_age           0.00      0.00    -0.00     0.00 1.00     4555     2887

Family Specific Parameters: 
               Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma_jobseek      0.73      0.02     0.69     0.76 1.00     6639     3276
sigma_depress2     0.61      0.01     0.59     0.64 1.00     6145     2987

Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<pre class="r"><code>
# using brms we can calculate the indirect effect as follows
# hypothesis(med_result, &#39;jobseek_treat*depress2_job_seek = 0&#39;)

# sjstats provides similar printing as the mediation package
# print(sjstats::mediation(med_result), digits=4)
sjstats::mediation(med_result) %&gt;% kable_df()</code></pre>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
effect
</th>
<th style="text-align:right;">
value
</th>
<th style="text-align:right;">
hdi.low
</th>
<th style="text-align:right;">
hdi.high
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
direct
</td>
<td style="text-align:right;">
-0.039
</td>
<td style="text-align:right;">
-0.112
</td>
<td style="text-align:right;">
0.031
</td>
</tr>
<tr>
<td style="text-align:left;">
indirect
</td>
<td style="text-align:right;">
-0.015
</td>
<td style="text-align:right;">
-0.036
</td>
<td style="text-align:right;">
0.005
</td>
</tr>
<tr>
<td style="text-align:left;">
mediator
</td>
<td style="text-align:right;">
-0.240
</td>
<td style="text-align:right;">
-0.286
</td>
<td style="text-align:right;">
-0.193
</td>
</tr>
<tr>
<td style="text-align:left;">
total
</td>
<td style="text-align:right;">
-0.055
</td>
<td style="text-align:right;">
-0.133
</td>
<td style="text-align:right;">
0.017
</td>
</tr>
<tr>
<td style="text-align:left;">
proportion mediated
</td>
<td style="text-align:right;">
0.277
</td>
<td style="text-align:right;">
-0.813
</td>
<td style="text-align:right;">
1.366
</td>
</tr>
</tbody>
</table>
</div>
<p>In the output, anything with <code>jobseek_*</code> is a result for the mediator model, while <code>depress2_*</code> is for the outcome. We have the same old story at this point, but with the Bayesian approach we have more fun things to look at. For example, we can see that we aren’t actually capturing the skewness of depression outcome well. Our predicted values vs. the observed don’t quite match up. We’re a little better for the mediator, but perhaps still a little high with some of our model-based predictions.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
pp_check(med_result, resp = &#39;depress2&#39;) + ggtitle(&#39;Depression Outcome&#39;)</code></pre>
<p><img src="mediation-models_files/figure-html5/mediation_bayes_ppcheck-1.svg" width="624" style="display: block; margin: auto;" /></p>
<pre class="r"><code>
pp_check(med_result, resp = &#39;jobseek&#39;) + ggtitle(&#39;Mediator&#39;)</code></pre>
<p><img src="mediation-models_files/figure-html5/mediation_bayes_ppcheck-2.svg" width="624" style="display: block; margin: auto;" /></p>
</div>
<aside>
The faint lines (<code>yrep</code>) are posterior predictive draws.
</aside>
<h4 id="pros-4">Pros</h4>
<ul>
<li>Straightforward syntax</li>
<li>Extremely powerful- Models are mostly limited to one’s imagination</li>
<li>Basically does what the <span class="pack">mediation</span> package approximates</li>
<li>All the perks of Bayesian inference: diagnostics, posterior predictive checks, model comparison, etc.</li>
</ul>
<h4 id="limitations-4">Limitations</h4>
<ul>
<li>Slower to estimate</li>
<li>‘By-hand’ calculations needed for going beyond the standard linear model, but this is already a common approach from the Bayesian perspective</li>
<li>Some comfort with the Bayesian approach required</li>
</ul>
<h2 id="more-complexity">More complexity</h2>
<p>Some of the packages mentioned can handle more complex models or provide additional approaches to investigate indirect effects.</p>
<h3 id="interactions">Interactions</h3>
<p>Some models involve interactions either for the mediation model or outcome, and unfortunately this is often referred to as mediated moderation or moderated mediation. I personally don’t see the advantage to giving ambiguous names to what otherwise might be a straightforward concept (if still not-so-straightforward model), but that ship sailed long ago. I’m not going to go into the details, but the idea is that you might have an interaction term somewhere in the model, and the interaction might involve the treatment variable, the mediator, or both.</p>
<p>Suffice it to say, since we’re using standard modeling tools like <code>lm</code> and extensions of it, incorporating interactions is trivial for all of the above packages, but the product-of-paths type of approach doesn’t hold (<code>a*b != c'</code>).</p>
<h3 id="generalized-linear-models">Generalized Linear Models</h3>
<p>In some cases our mediator or outcome may be binary, count, or something where assuming a normal distribution might not be the best idea. Or we might want to investigate nonlinear relationships among the treatment/mediator/outcome. Or we might have data that has correlated observations like repeated measurements or similar. The <span class="pack">mediation</span> package prides itself on this in particular, but <span class="pack">brms</span> can do anything it can do and more, though you might have to do a little more work to actually calculate the result. <span class="pack">lavaan</span> can actually do a limited set of models for binary and ordinal variables, but getting the appropriate indirect estimate would require a very tedious by-hand approach.</p>
<h3 id="missing-data">Missing data</h3>
<p>Often when dealing with such data, especially in the social sciences, data is often missing on any of the covariates. Sometimes we can drop these if there isn’t too many, but in other cases we will want to do something about it. The packages <span class="pack">lavaan</span>, <span class="pack">psych</span>, and <span class="pack">brms</span> provide one or more ways to deal with the situation (e.g. multiple imputation).</p>
<h2 id="alternatives">Alternatives</h2>
<p>We have been depicting the models as networks of nodes, with arcs/edges/paths connecting them. Our discussion revolves around what are called <span class="emph">Directed Acyclic Graphs</span> (DAG) where the arrows can only go one direction with no feedback loops. The result of any outcome variable is a function of the arrows preceding it, and conditionally independent of others. Some theoretical models may relax this, and others may have no arrows at all, i.e. are <span class="emph">undirected</span>, such that we are interested in just the connections (e.g. with some social networks).</p>
<h3 id="bnlearn">bnlearn</h3>
<p>The <span class="pack">bnlearn</span> package allows investigation of directed, partially directed, and undirected graphs. In terms of DAGs, we can use it to essentially duplicate the mediation models we’ve been discussing. The nice thing though is that this package will efficiently test paths for inclusion rather than assume them, but we can still impose theoretical constraints as needed. Not only can we then search for the paths of interest in a principled way with <span class="emph">bayesian networks</span> and Pearl’s causal graph theory as a basis, we also will have tools to further avoid overfitting via cross-validation.</p>
<p>For the initial model, we’ll make sure that paths exist between treatment - mediator, treatment - outcome, and mediator - outcome (the <span class="emph">whitelist</span>). We will disallow nonsensical paths like having arrows to the treatment (which was randomly assigned), sex, economic hardship, and age (the <span class="emph">blacklist</span>). Otherwise, we’ll see what the data suggests.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
whitelist = data.frame(
  from = c(&#39;treat&#39;, &#39;treat&#39;, &#39;job_seek&#39;),
  to   = c(&#39;job_seek&#39;, &#39;depress2&#39;, &#39;depress2&#39;)
)

blacklist = expand.grid(
  from = colnames(mediation_result$model.y$model),
  to   = c(&#39;treat&#39;, &#39;sex&#39;, &#39;age&#39;, &#39;econ_hard&#39;)
)

# For simpler output we&#39;ll use treatment and sex as numeric (explained later)
library(dplyr)

jobs_trim = jobs %&gt;% 
  select(depress2, treat, econ_hard, sex, age, job_seek) %&gt;% 
  mutate(
    treat = as.numeric(jobs$treat),
    sex = as.numeric(jobs$sex)
    )


# extract path coefficients if desired
# parameters = bn.fit(model, jobs_trim)
# parameters$job_seek
# parameters$econ_hard
# parameters$depress2</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
library(bnlearn)

model = gs(jobs_trim, whitelist = whitelist, blacklist = blacklist)

plot(model)</code></pre>
<p><img src="mediation-models_files/figure-html5/bnlearn-model-1.svg" width="624" style="display: block; margin: auto;" /></p>
</div>
<p>We see in the plot that things have changed a bit. For example, age now only relates to job seeking self-efficacy, and sex only has an effect on depression.</p>
<p>If we restrict the paths to only be what they are in our previous examples, we’d get the same results.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
library(bnlearn)

whitelist = data.frame(
  from = c(&#39;treat&#39;, &#39;age&#39;, &#39;sex&#39;, &#39;econ_hard&#39;, &#39;treat&#39;, &#39;job_seek&#39;, &#39;age&#39;, &#39;sex&#39;, &#39;econ_hard&#39;),
  to   = c(&#39;job_seek&#39;, &#39;job_seek&#39;,&#39;job_seek&#39;,&#39;job_seek&#39;, &#39;depress2&#39;, &#39;depress2&#39;, &#39;depress2&#39;, &#39;depress2&#39;, &#39;depress2&#39;)
)

blacklist = expand.grid(
  from = colnames(mediation_result$model.y$model),
  to   = c(&#39;treat&#39;, &#39;sex&#39;, &#39;age&#39;, &#39;econ_hard&#39;)
) 

model = gs(jobs_trim, whitelist = whitelist, blacklist = blacklist)
plot(model)</code></pre>
<p><img src="mediation-models_files/figure-html5/bnlearn_reproduction-1.svg" width="624" style="display: block; margin: auto;" /></p>
<pre class="r"><code>
parameters = bn.fit(model, jobs_trim)

parameters$depress2$coefficients</code></pre>
<pre><code>
  (Intercept)         treat     econ_hard           sex           age      job_seek 
 2.2076414333 -0.0402647000  0.1485433818  0.1068048699  0.0006488642 -0.2399549527 </code></pre>
<pre class="r"><code>
parameters$job_seek$coefficients</code></pre>
<pre><code>
 (Intercept)        treat    econ_hard          sex          age 
 3.670584908  0.065615003  0.053162413 -0.007637336  0.004586492 </code></pre>
</div>
<p>The main thing to note is that the estimated parameters equal the same thing we got with previous packages. It’s essentially equivalent to using <span class="pack">lavaan</span> with the default maximum likelihood estimator.</p>
<p>If we use treatment and sex as factors, <span class="pack">bnlearn</span> will produce conditional models that are different depending on the factor value taken. In other words, one would have a separate model for when <code>treatment == 'treatment'</code> and one for when <code>treatment == control</code>. In our case, this would be identical to allowing everything to interact with treatment, e.g. <code>lm( job_seek ~ treat * (econ_hard + sex + age))</code>, and likewise for the depression model. This would extend to potentially any binary variable (e.g. including sex). If the mediator is a binary variable, this is likely what we’d want to do.</p>
<h3 id="python">Python</h3>
<p>CSCAR director Kerby Shedden has given a <a href="nbviewer.jupyter.org/urls/umich.box.com/shared/static/jpmd9y99259u6dv0rj6p46993981m7zm.ipynb">Python workshop</a> on mediation models, so I show the <span class="pack">statsmodels</span> implementation here. It follows the Imai approach and so can be seen as the Python version of the <span class="pack">mediation</span> package. The output is essentially the same as what you would have using treatment as a factor variable, where you get separate results for each treatment category. This is unnecessary for our demo, so you can just compare the ‘average’ results to the previous <span class="pack">mediation</span> package results.</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<pre class="python"><code>
import statsmodels.api as sm
from statsmodels.stats.mediation import Mediation
import numpy as np
import pandas as pd


outcome_model = sm.OLS.from_formula(&quot;depress2 ~ treat + econ_hard + sex + age + job_seek&quot;,
                                    data = jobs)

mediator_model = sm.OLS.from_formula(&quot;job_seek ~ treat + econ_hard + sex + age&quot;,
                                     data = jobs)

med = Mediation(outcome_model, mediator_model, &quot;treat&quot;, &quot;job_seek&quot;)

med_result = med.fit(n_rep = 500)

print(np.round(med_result.summary(), decimals = 3))</code></pre>
<pre><code>
                          Estimate  Lower CI bound  Upper CI bound  P-value
ACME (control)              -0.016          -0.048           0.014    0.332
ACME (treated)              -0.016          -0.048           0.014    0.332
ADE (control)               -0.043          -0.130           0.044    0.308
ADE (treated)               -0.043          -0.130           0.044    0.308
Total effect                -0.059          -0.144           0.029    0.208
Prop. mediated (control)     0.241          -1.710           2.254    0.364
Prop. mediated (treated)     0.241          -1.710           2.254    0.364
ACME (average)              -0.016          -0.048           0.014    0.332
ADE (average)               -0.043          -0.130           0.044    0.308
Prop. mediated (average)     0.241          -1.710           2.254    0.364</code></pre>
</div>
<h3 id="stata">Stata</h3>
<p>Finally, I provide an option in Stata using its <code>sem</code> command. Stata makes it easy to get the indirect effects in this example, but it does so for every covariate, so the output is a bit verbose to say the least<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a>. For those working with Stata, they do not need a separate SEM package to get these sorts of results.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="stata"><code>
use &quot;data\jobs.dta&quot;

sem (job_seek &lt;- treat econ_hard sex age) (depress2 &lt;- treat econ_hard sex age job_seek), cformat(%9.3f) pformat(%5.2f)

estat teffects, compact cformat(%9.3f) pformat(%5.2f)</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<pre><code>
. use &#39;data\jobs.dta&#39;

. 
. sem (job_seek &lt;- treat econ_hard sex age) (depress2 &lt;- treat econ_hard sex age job_seek), 
cformat(%9.3f) pformat(%5.2f)

Endogenous variables

Observed:  job_seek depress2

Exogenous variables

Observed:  treat econ_hard sex age

Fitting target model:

Iteration 0:   log likelihood = -7711.0956  
Iteration 1:   log likelihood = -7711.0956  

Structural equation model                       Number of obs     =        899
Estimation method  = ml
Log likelihood     = -7711.0956

------------------------------------------------------------------------------
             |                 OIM
             |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
Structural   |
  job_seek   |
       treat |      0.066      0.051     1.28    0.20       -0.035       0.166
   econ_hard |      0.053      0.025     2.17    0.03        0.005       0.101
         sex |     -0.008      0.049    -0.16    0.88       -0.103       0.088
         age |      0.005      0.002     1.98    0.05        0.000       0.009
       _cons |      3.671      0.125    29.41    0.00        3.426       3.915
  -----------+----------------------------------------------------------------
  depress2   |
    job_seek |     -0.240      0.028    -8.52    0.00       -0.295      -0.185
       treat |     -0.040      0.043    -0.93    0.35       -0.125       0.045
   econ_hard |      0.149      0.021     7.16    0.00        0.108       0.189
         sex |      0.107      0.041     2.60    0.01        0.026       0.187
         age |      0.001      0.002     0.33    0.74       -0.003       0.004
       _cons |      2.208      0.148    14.96    0.00        1.918       2.497
-------------+----------------------------------------------------------------
var(e.job_~k)|      0.524      0.025                         0.478       0.575
var(e.depr~2)|      0.373      0.018                         0.340       0.409
------------------------------------------------------------------------------
LR test of model vs. saturated: chi2(0)   =      0.00, Prob &gt; chi2 =      .

. 
. estat teffects, compact cformat(%9.3f) pformat(%5.2f)


Direct effects
------------------------------------------------------------------------------
             |                 OIM
             |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
Structural   |
  job_seek   |
       treat |      0.066      0.051     1.28    0.20       -0.035       0.166
   econ_hard |      0.053      0.025     2.17    0.03        0.005       0.101
         sex |     -0.008      0.049    -0.16    0.88       -0.103       0.088
         age |      0.005      0.002     1.98    0.05        0.000       0.009
  -----------+----------------------------------------------------------------
  depress2   |
    job_seek |     -0.240      0.028    -8.52    0.00       -0.295      -0.185
       treat |     -0.040      0.043    -0.93    0.35       -0.125       0.045
   econ_hard |      0.149      0.021     7.16    0.00        0.108       0.189
         sex |      0.107      0.041     2.60    0.01        0.026       0.187
         age |      0.001      0.002     0.33    0.74       -0.003       0.004
------------------------------------------------------------------------------


Indirect effects
------------------------------------------------------------------------------
             |                 OIM
             |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
Structural   |
  job_seek   |
  -----------+----------------------------------------------------------------
  depress2   |
       treat |     -0.016      0.012    -1.26    0.21       -0.040       0.009
   econ_hard |     -0.013      0.006    -2.10    0.04       -0.025      -0.001
         sex |      0.002      0.012     0.16    0.88       -0.021       0.025
         age |     -0.001      0.001    -1.93    0.05       -0.002       0.000
------------------------------------------------------------------------------


Total effects
------------------------------------------------------------------------------
             |                 OIM
             |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
Structural   |
  job_seek   |
       treat |      0.066      0.051     1.28    0.20       -0.035       0.166
   econ_hard |      0.053      0.025     2.17    0.03        0.005       0.101
         sex |     -0.008      0.049    -0.16    0.88       -0.103       0.088
         age |      0.005      0.002     1.98    0.05        0.000       0.009
  -----------+----------------------------------------------------------------
  depress2   |
    job_seek |     -0.240      0.028    -8.52    0.00       -0.295      -0.185
       treat |     -0.056      0.045    -1.24    0.21       -0.144       0.032
   econ_hard |      0.136      0.022     6.31    0.00        0.094       0.178
         sex |      0.109      0.043     2.55    0.01        0.025       0.192
         age |     -0.000      0.002    -0.22    0.82       -0.004       0.004
------------------------------------------------------------------------------
  </code></pre>
</div>
<h2 id="summary">Summary</h2>
<p>Models with indirect effects require careful theoretical consideration to employ for data analysis. However, if the model is appropriate for your data situation, it is quite easy to get results from a variety of packages in R. Furthermore, one does not need to use a structural equation modeling package to conduct an analysis with indirect effects, and in fact, one can get far using standard R syntax. For strictly observed, i.e. no latent, variables, no SEM tool is necessary, or even recommended.</p>
<p><span class="math display">\[\mathcal{Enjoy\ your\ model\ exploration!}\]</span></p>
<h5 id="package-comparison-summarized">Package comparison summarized</h5>
<p>The following table may help one decide which package to use for their needs given their theoretical considerations.</p>
<div class="layout-chunk" data-layout="l-body">
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
mediation
</th>
<th style="text-align:left;">
lavaan
</th>
<th style="text-align:left;">
piecewiseSEM
</th>
<th style="text-align:left;">
psych
</th>
<th style="text-align:left;">
brms
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Automatic
</td>
<td style="text-align:left;">
•
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
•
</td>
<td style="text-align:left;">
•<sup>*</sup>
</td>
</tr>
<tr>
<td style="text-align:left;">
Multiple Treatments<sup>☺</sup>
</td>
<td style="text-align:left;">
•
</td>
<td style="text-align:left;">
•
</td>
<td style="text-align:left;">
•
</td>
<td style="text-align:left;">
•
</td>
<td style="text-align:left;">
•
</td>
</tr>
<tr>
<td style="text-align:left;">
Multiple Mediators
</td>
<td style="text-align:left;">
•
</td>
<td style="text-align:left;">
•
</td>
<td style="text-align:left;">
•
</td>
<td style="text-align:left;">
•
</td>
<td style="text-align:left;">
•
</td>
</tr>
<tr>
<td style="text-align:left;">
Multiple Outcomes
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
•
</td>
<td style="text-align:left;">
•
</td>
<td style="text-align:left;">
•
</td>
<td style="text-align:left;">
•
</td>
</tr>
<tr>
<td style="text-align:left;">
Beyond SLM<sup>†</sup>
</td>
<td style="text-align:left;">
•
</td>
<td style="text-align:left;">
•
</td>
<td style="text-align:left;">
•
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
•
</td>
</tr>
<tr>
<td style="text-align:left;">
Random Effects
</td>
<td style="text-align:left;">
•
</td>
<td style="text-align:left;">
•
</td>
<td style="text-align:left;">
•
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
•
</td>
</tr>
<tr>
<td style="text-align:left;">
Missing Values
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
•
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
•*
</td>
<td style="text-align:left;">
•
</td>
</tr>
<tr>
<td style="text-align:left;">
Latent Variables
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
•
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
•*
</td>
</tr>
</tbody>
<tfoot>
<tr>
<td style="padding: 0; border: 0;" colspan="100%">
<sup>*</sup> approximately, with some caveats
</td>
</tr>
<tr>
<td style="padding: 0; border: 0;" colspan="100%">
<sup><sup>☺</sup></sup> May require rerunning aspects of the model
</td>
</tr>
<tr>
<td style="padding: 0; border: 0;" colspan="100%">
<sup><sup>†</sup></sup> Standard linear model, as estimated by <code>lm</code>
</td>
</tr>
</tfoot>
</table>
</div>
<!-- footnotes -->
<section class="footnotes" role="doc-endnotes">
<hr />
<ol>
<li id="fn1" role="doc-endnote"><p>I have a much more <a href="https://m-clark.github.io/sem/">detailed document on SEM</a>, including mediation analysis.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2" role="doc-endnote"><p>For some reason you don’t see this in practice much, and one wonders what was done to make the data amenable to such a model if it wasn’t warranted.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3" role="doc-endnote"><p>Imai makes his articles available at his <a href="https://imai.fas.harvard.edu/projects/mechanisms.html">website</a>.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4" role="doc-endnote"><p><span class="pack">MASS</span> has been superseded by others for over a decade at this point, and it mostly just tends to muck up your <span class="pack" style="">tidyverse</span> and other packages when it’s loaded. It’s a fine package (and was great back in the day), but if you want to use it in a package, it would be good to not load it (or other packages) in the environment just to use a function or two. I mostly just see it used for <span class="func">mvrnorm</span> (multivariate normal distribution) and <span class="func">glm.nb</span>, but there are other packages with that functionality that would provide additional benefits, and not mask <span class="pack">dplyr</span> functions, which are among the most commonly used in the R community.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5" role="doc-endnote"><p><a href="https://github.com/paul-buerkner/brms/issues/304"><span class="pack">brms</span> is working on it</a>.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6" role="doc-endnote"><p>The options in the code are there to suppress/minimize what can be.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
<!--radix_placeholder_article_footer-->
<div class="article-footer">
  <p class="social_footer">
    <span class="article-sharing">
      Share: &nbsp;
      <a href="https://twitter.com/share?text=Mediation%20Models&amp;url=https%3A%2F%2Fm-clark.github.io%2Fposts%2F2019-03-12-mediation-models%2F">
        <i class="fab fa-twitter"></i>
      </a>
      <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fm-clark.github.io%2Fposts%2F2019-03-12-mediation-models%2F&amp;title=Mediation%20Models">
        <i class="fab fa-linkedin"></i>
      </a>
      <a href="https://www.facebook.com/sharer/sharer.php?s=100&amp;p[url]=https%3A%2F%2Fm-clark.github.io%2Fposts%2F2019-03-12-mediation-models%2F">
        <i class="fab fa-facebook"></i>
      </a>
    </span>
  </p>
</div>
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
  <h3 id="updates-and-corrections">Corrections</h3>
  <p>If you see mistakes or want to suggest changes, please <a href="https://github.com//m-clark/m-clark.github.io/issues/new">create an issue</a> on the source repository.</p>
  <h3 id="reuse">Reuse</h3>
  <p>Text and figures are licensed under Creative Commons Attribution <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a>. Source code is available at <a href="https://github.com//m-clark/m-clark.github.io">https://github.com//m-clark/m-clark.github.io</a>, unless otherwise noted. The figures that have been reused from other sources don't fall under this license and can be recognized by a note in their caption: "Figure from ...".</p>
  <h3 id="citation">Citation</h3>
  <p>For attribution, please cite this work as</p>
  <pre class="citation-appendix short">Clark (2019, March 12). Michael Clark: Mediation Models. Retrieved from https://m-clark.github.io/posts/2019-03-12-mediation-models/</pre>
  <p>BibTeX citation</p>
  <pre class="citation-appendix long">@misc{clark2019mediation,
  author = {Clark, Michael},
  title = {Michael Clark: Mediation Models},
  url = {https://m-clark.github.io/posts/2019-03-12-mediation-models/},
  year = {2019}
}</pre>
</div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<div class="distill-site-nav distill-site-footer">
  <div>


Michael Clark • 2021 •  <a href="https://m-clark.github.io">https://m-clark.github.io/</a>
</div>
</div>
<!--/radix_placeholder_navigation_after_body-->


</body>

</html>
