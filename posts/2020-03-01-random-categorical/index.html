<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

  <!--radix_placeholder_meta_tags-->
<title>Michael Clark: Categorical Effects as Random</title>

<meta property="description" itemprop="description" content="Exploring random slopes for categorical covariates and similar models"/>

<link rel="canonical" href="https://m-clark.github.io/posts/2020-03-01-random-categorical/"/>
<link rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/"/>
<link rel="icon" type="image/vnd.microsoft.icon" href="../../img/favicon.ico"/>

<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2020-03-01"/>
<meta property="article:created" itemprop="dateCreated" content="2020-03-01"/>
<meta name="article:author" content="Michael Clark"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content="Michael Clark: Categorical Effects as Random"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content="Exploring random slopes for categorical covariates and similar models"/>
<meta property="og:url" content="https://m-clark.github.io/posts/2020-03-01-random-categorical/"/>
<meta property="og:image" content="https://m-clark.github.io/posts/2020-03-01-random-categorical/../../img/cat_ran/machines.svg"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content="Michael Clark"/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary_large_image"/>
<meta property="twitter:title" content="Michael Clark: Categorical Effects as Random"/>
<meta property="twitter:description" content="Exploring random slopes for categorical covariates and similar models"/>
<meta property="twitter:url" content="https://m-clark.github.io/posts/2020-03-01-random-categorical/"/>
<meta property="twitter:image" content="https://m-clark.github.io/posts/2020-03-01-random-categorical/../../img/cat_ran/machines.svg"/>

<!--  https://scholar.google.com/intl/en/scholar/inclusion.html#indexing -->
<meta name="citation_title" content="Michael Clark: Categorical Effects as Random"/>
<meta name="citation_fulltext_html_url" content="https://m-clark.github.io/posts/2020-03-01-random-categorical/"/>
<meta name="citation_fulltext_world_readable" content=""/>
<meta name="citation_online_date" content="2020/03/01"/>
<meta name="citation_publication_date" content="2020/03/01"/>
<meta name="citation_author" content="Michael Clark"/>
<!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["creative_commons","title","description","author","date","preview","output","draft","tags","categories","citation_url","canonical_url"]}},"value":[{"type":"character","attributes":{},"value":["CC BY-SA"]},{"type":"character","attributes":{},"value":["Categorical Effects as Random"]},{"type":"character","attributes":{},"value":["Exploring random slopes for categorical covariates and similar models"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","url"]}},"value":[{"type":"character","attributes":{},"value":["Michael Clark"]},{"type":"character","attributes":{},"value":["https://m-clark.github.io"]}]}]},{"type":"character","attributes":{},"value":["2020-03-01"]},{"type":"character","attributes":{},"value":["../../img/cat_ran/machines.svg"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","toc","css"]}},"value":[{"type":"logical","attributes":{},"value":[false]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["../../styles.css"]}]}]},{"type":"logical","attributes":{},"value":[false]},{"type":"character","attributes":{},"value":["mixed models","generalized linear mixed models","random effects","lme4","glmmTMB","lmer","glmer"]},{"type":"character","attributes":{},"value":["mixed models"]},{"type":"character","attributes":{},"value":["https://m-clark.github.io/posts/2020-03-01-random-categorical/"]},{"type":"character","attributes":{},"value":["https://m-clark.github.io/posts/2020-03-01-random-categorical/"]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["random_categories_files/bowser-1.9.3/bowser.min.js","random_categories_files/distill-2.2.21/template.v2.js","random_categories_files/figure-html5/vis-data-1.svg","random_categories_files/jquery-1.11.3/jquery.min.js","random_categories_files/kePrint-0.0.1/kePrint.js","random_categories_files/webcomponents-2.0.0/webcomponents.js"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
<meta name="distill:offset" content="../.."/>

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      tolerance: 5,
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #0F2E3D;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
  min-width: 150px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative; min-height: 500px; }
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

/* adjust viewport for navbar height */
/* helps vertically center bootstrap (non-distill) content */
.min-vh-100 {
  min-height: calc(100vh - 100px) !important;
}

</style>

<script src="../../site_libs/jquery-1.11.3/jquery.min.js"></script>
<link href="../../site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
<link href="../../site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
<script src="../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<script src="../../site_libs/autocomplete-0.37.1/autocomplete.min.js"></script>
<script src="../../site_libs/fuse-6.4.1/fuse.min.js"></script>

<script type="application/javascript">

function getMeta(metaName) {
  var metas = document.getElementsByTagName('meta');
  for (let i = 0; i < metas.length; i++) {
    if (metas[i].getAttribute('name') === metaName) {
      return metas[i].getAttribute('content');
    }
  }
  return '';
}

function offsetURL(url) {
  var offset = getMeta('distill:offset');
  return offset ? offset + '/' + url : url;
}

function createFuseIndex() {

  // create fuse index
  var options = {
    keys: [
      { name: 'title', weight: 20 },
      { name: 'categories', weight: 15 },
      { name: 'description', weight: 10 },
      { name: 'contents', weight: 5 },
    ],
    ignoreLocation: true,
    threshold: 0
  };
  var fuse = new window.Fuse([], options);

  // fetch the main search.json
  return fetch(offsetURL('search.json'))
    .then(function(response) {
      if (response.status == 200) {
        return response.json().then(function(json) {
          // index main articles
          json.articles.forEach(function(article) {
            fuse.add(article);
          });
          // download collections and index their articles
          return Promise.all(json.collections.map(function(collection) {
            return fetch(offsetURL(collection)).then(function(response) {
              if (response.status === 200) {
                return response.json().then(function(articles) {
                  articles.forEach(function(article) {
                    fuse.add(article);
                  });
                })
              } else {
                return Promise.reject(
                  new Error('Unexpected status from search index request: ' +
                            response.status)
                );
              }
            });
          })).then(function() {
            return fuse;
          });
        });

      } else {
        return Promise.reject(
          new Error('Unexpected status from search index request: ' +
                      response.status)
        );
      }
    });
}

window.document.addEventListener("DOMContentLoaded", function (event) {

  // get search element (bail if we don't have one)
  var searchEl = window.document.getElementById('distill-search');
  if (!searchEl)
    return;

  createFuseIndex()
    .then(function(fuse) {

      // make search box visible
      searchEl.classList.remove('hidden');

      // initialize autocomplete
      var options = {
        autoselect: true,
        hint: false,
        minLength: 2,
      };
      window.autocomplete(searchEl, options, [{
        source: function(query, callback) {
          const searchOptions = {
            isCaseSensitive: false,
            shouldSort: true,
            minMatchCharLength: 2,
            limit: 10,
          };
          var results = fuse.search(query, searchOptions);
          callback(results
            .map(function(result) { return result.item; })
          );
        },
        templates: {
          suggestion: function(suggestion) {
            var img = suggestion.preview && Object.keys(suggestion.preview).length > 0
              ? `<img src="${offsetURL(suggestion.preview)}"</img>`
              : '';
            var html = `
              <div class="search-item">
                <h3>${suggestion.title}</h3>
                <div class="search-item-description">
                  ${suggestion.description || ''}
                </div>
                <div class="search-item-preview">
                  ${img}
                </div>
              </div>
            `;
            return html;
          }
        }
      }]).on('autocomplete:selected', function(event, suggestion) {
        window.location.href = offsetURL(suggestion.path);
      });
      // remove inline display style on autocompleter (we want to
      // manage responsive display via css)
      $('.algolia-autocomplete').css("display", "");
    })
    .catch(function(error) {
      console.log(error);
    });

});

</script>

<style type="text/css">

.nav-search {
  font-size: x-small;
}

/* Algolioa Autocomplete */

.algolia-autocomplete {
  display: inline-block;
  margin-left: 10px;
  vertical-align: sub;
  background-color: white;
  color: black;
  padding: 6px;
  padding-top: 8px;
  padding-bottom: 0;
  border-radius: 6px;
  border: 1px #0F2E3D solid;
  width: 180px;
}


@media screen and (max-width: 768px) {
  .distill-site-nav .algolia-autocomplete {
    display: none;
    visibility: hidden;
  }
  .distill-site-nav.responsive .algolia-autocomplete {
    display: inline-block;
    visibility: visible;
  }
  .distill-site-nav.responsive .algolia-autocomplete .aa-dropdown-menu {
    margin-left: 0;
    width: 400px;
    max-height: 400px;
  }
}

.algolia-autocomplete .aa-input, .algolia-autocomplete .aa-hint {
  width: 90%;
  outline: none;
  border: none;
}

.algolia-autocomplete .aa-hint {
  color: #999;
}
.algolia-autocomplete .aa-dropdown-menu {
  width: 550px;
  max-height: 70vh;
  overflow-x: visible;
  overflow-y: scroll;
  padding: 5px;
  margin-top: 3px;
  margin-left: -150px;
  background-color: #fff;
  border-radius: 5px;
  border: 1px solid #999;
  border-top: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion {
  cursor: pointer;
  padding: 5px 4px;
  border-bottom: 1px solid #eee;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion:last-of-type {
  border-bottom: none;
  margin-bottom: 2px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item {
  overflow: hidden;
  font-size: 0.8em;
  line-height: 1.4em;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item h3 {
  font-size: 1rem;
  margin-block-start: 0;
  margin-block-end: 5px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-description {
  display: inline-block;
  overflow: hidden;
  height: 2.8em;
  width: 80%;
  margin-right: 4%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview {
  display: inline-block;
  width: 15%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img {
  height: 3em;
  width: auto;
  display: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img[src] {
  display: initial;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion.aa-cursor {
  background-color: #eee;
}
.algolia-autocomplete .aa-dropdown-menu .aa-suggestion em {
  font-weight: bold;
  font-style: normal;
}

</style>


<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

d-byline .byline {
  grid-template-columns: 2fr 2fr;
}

d-byline .byline h3 {
  margin-block-start: 1.5em;
}

d-byline .byline .authors-affiliations h3 {
  margin-block-start: 0.5em;
}

.authors-affiliations .orcid-id {
  width: 16px;
  height:16px;
  margin-left: 4px;
  margin-right: 4px;
  vertical-align: middle;
  padding-bottom: 2px;
}

d-title .dt-tags {
  margin-top: 1em;
  grid-column: text;
}

.dt-tags .dt-tag {
  text-decoration: none;
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0em 0.4em;
  margin-right: 0.5em;
  margin-bottom: 0.4em;
  font-size: 70%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

d-article table.gt_table td,
d-article table.gt_table th {
  border-bottom: none;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

d-article {
  padding-top: 2.5rem;
  padding-bottom: 30px;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article h2 {
  margin: 1rem 0 1.5rem 0;
}

d-article h3 {
  margin-top: 1.5rem;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

/* Tweak code blocks */

d-article div.sourceCode code,
d-article pre code {
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: auto;
}

d-article div.sourceCode {
  background-color: white;
}

d-article div.sourceCode pre {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

d-article pre {
  font-size: 12px;
  color: black;
  background: none;
  margin-top: 0;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

d-article pre a {
  border-bottom: none;
}

d-article pre a:hover {
  border-bottom: none;
  text-decoration: underline;
}

d-article details {
  grid-column: text;
  margin-bottom: 0.8em;
}

@media(min-width: 768px) {

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: visible !important;
}

d-article div.sourceCode pre {
  padding-left: 18px;
  font-size: 14px;
}

d-article pre {
  font-size: 14px;
}

}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for d-contents */

.d-contents {
  grid-column: text;
  color: rgba(0,0,0,0.8);
  font-size: 0.9em;
  padding-bottom: 1em;
  margin-bottom: 1em;
  padding-bottom: 0.5em;
  margin-bottom: 1em;
  padding-left: 0.25em;
  justify-self: start;
}

@media(min-width: 1000px) {
  .d-contents.d-contents-float {
    height: 0;
    grid-column-start: 1;
    grid-column-end: 4;
    justify-self: center;
    padding-right: 3em;
    padding-left: 2em;
  }
}

.d-contents nav h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 1em;
}

.d-contents li {
  list-style-type: none
}

.d-contents nav > ul {
  padding-left: 0;
}

.d-contents ul {
  padding-left: 1em
}

.d-contents nav ul li {
  margin-top: 0.6em;
  margin-bottom: 0.2em;
}

.d-contents nav a {
  font-size: 13px;
  border-bottom: none;
  text-decoration: none
  color: rgba(0, 0, 0, 0.8);
}

.d-contents nav a:hover {
  text-decoration: underline solid rgba(0, 0, 0, 0.6)
}

.d-contents nav > ul > li > a {
  font-weight: 600;
}

.d-contents nav > ul > li > ul {
  font-weight: inherit;
}

.d-contents nav > ul > li > ul > li {
  margin-top: 0.2em;
}


.d-contents nav ul {
  margin-top: 0;
  margin-bottom: 0.25em;
}

.d-article-with-toc h2:nth-child(2) {
  margin-top: 0;
}


/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure img {
  width: 100%;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}

/* Citations */

d-article .citation {
  color: inherit;
  cursor: inherit;
}

div.hanging-indent{
  margin-left: 1em; text-indent: -1em;
}

/* Citation hover box */

.tippy-box[data-theme~=light-border] {
  background-color: rgba(250, 250, 250, 0.95);
}

.tippy-content > p {
  margin-bottom: 0;
  padding: 2px;
}


/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Include appendix styles here so they can be overridden */

d-appendix {
  contain: layout style;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-top: 60px;
  margin-bottom: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  color: rgba(0,0,0,0.5);
  padding-top: 60px;
  padding-bottom: 48px;
}

d-appendix h3 {
  grid-column: page-start / text-start;
  font-size: 15px;
  font-weight: 500;
  margin-top: 1em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.65);
}

d-appendix h3 + * {
  margin-top: 1em;
}

d-appendix ol {
  padding: 0 0 0 15px;
}

@media (min-width: 768px) {
  d-appendix ol {
    padding: 0 0 0 30px;
    margin-left: -30px;
  }
}

d-appendix li {
  margin-bottom: 1em;
}

d-appendix a {
  color: rgba(0, 0, 0, 0.6);
}

d-appendix > * {
  grid-column: text;
}

d-appendix > d-footnote-list,
d-appendix > d-citation-list,
d-appendix > distill-appendix {
  grid-column: screen;
}

/* Include footnote styles here so they can be overridden */

d-footnote-list {
  contain: layout style;
}

d-footnote-list > * {
  grid-column: text;
}

d-footnote-list a.footnote-backlink {
  color: rgba(0,0,0,0.3);
  padding-left: 0.5em;
}



/* Anchor.js */

.anchorjs-link {
  /*transition: all .25s linear; */
  text-decoration: none;
  border-bottom: none;
}
*:hover > .anchorjs-link {
  margin-left: -1.125em !important;
  text-decoration: none;
  border-bottom: none;
}

/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


.sidebar-section.custom {
  font-size: 12px;
  line-height: 1.6em;
}

.custom p {
  margin-bottom: 0.5em;
}

/* Styles for listing layout (hide title) */
.layout-listing d-title, .layout-listing .d-title {
  display: none;
}

/* Styles for posts lists (not auto-injected) */


.posts-with-sidebar {
  padding-left: 45px;
  padding-right: 45px;
}

.posts-list .description h2,
.posts-list .description p {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

.posts-list .description h2 {
  font-weight: 700;
  border-bottom: none;
  padding-bottom: 0;
}

.posts-list h2.post-tag {
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
  padding-bottom: 12px;
}
.posts-list {
  margin-top: 60px;
  margin-bottom: 24px;
}

.posts-list .post-preview {
  text-decoration: none;
  overflow: hidden;
  display: block;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  padding: 24px 0;
}

.post-preview-last {
  border-bottom: none !important;
}

.posts-list .posts-list-caption {
  grid-column: screen;
  font-weight: 400;
}

.posts-list .post-preview h2 {
  margin: 0 0 6px 0;
  line-height: 1.2em;
  font-style: normal;
  font-size: 24px;
}

.posts-list .post-preview p {
  margin: 0 0 12px 0;
  line-height: 1.4em;
  font-size: 16px;
}

.posts-list .post-preview .thumbnail {
  box-sizing: border-box;
  margin-bottom: 24px;
  position: relative;
  max-width: 500px;
}
.posts-list .post-preview img {
  width: 100%;
  display: block;
}

.posts-list .metadata {
  font-size: 12px;
  line-height: 1.4em;
  margin-bottom: 18px;
}

.posts-list .metadata > * {
  display: inline-block;
}

.posts-list .metadata .publishedDate {
  margin-right: 2em;
}

.posts-list .metadata .dt-authors {
  display: block;
  margin-top: 0.3em;
  margin-right: 2em;
}

.posts-list .dt-tags {
  display: block;
  line-height: 1em;
}

.posts-list .dt-tags .dt-tag {
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0.3em 0.4em;
  margin-right: 0.2em;
  margin-bottom: 0.4em;
  font-size: 60%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

.posts-list img {
  opacity: 1;
}

.posts-list img[data-src] {
  opacity: 0;
}

.posts-more {
  clear: both;
}


.posts-sidebar {
  font-size: 16px;
}

.posts-sidebar h3 {
  font-size: 16px;
  margin-top: 0;
  margin-bottom: 0.5em;
  font-weight: 400;
  text-transform: uppercase;
}

.sidebar-section {
  margin-bottom: 30px;
}

.categories ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

.categories li {
  color: rgba(0, 0, 0, 0.8);
  margin-bottom: 0;
}

.categories li>a {
  border-bottom: none;
}

.categories li>a:hover {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
}

.categories .active {
  font-weight: 600;
}

.categories .category-count {
  color: rgba(0, 0, 0, 0.4);
}


@media(min-width: 768px) {
  .posts-list .post-preview h2 {
    font-size: 26px;
  }
  .posts-list .post-preview .thumbnail {
    float: right;
    width: 30%;
    margin-bottom: 0;
  }
  .posts-list .post-preview .description {
    float: left;
    width: 45%;
  }
  .posts-list .post-preview .metadata {
    float: left;
    width: 20%;
    margin-top: 8px;
  }
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.5em;
    font-size: 16px;
  }
  .posts-with-sidebar .posts-list {
    float: left;
    width: 75%;
  }
  .posts-with-sidebar .posts-sidebar {
    float: right;
    width: 20%;
    margin-top: 60px;
    padding-top: 24px;
    padding-bottom: 24px;
  }
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

.downlevel .posts-list .post-preview {
  color: inherit;
}



</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // add anchors
  if (window.anchors) {
    window.anchors.options.placement = 'left';
    window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
  }


  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  // move refs into #references-listing
  $('#references-listing').replaceWith($('#refs'));

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-contents a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('details, div.sourceCode, pre, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // remove code block used to force  highlighting css
  $('.distill-force-highlighting-css').parent().remove();

  // remove empty line numbers inserted by pandoc when using a
  // custom syntax highlighting theme
  $('code.sourceCode a:empty').remove();

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // article with toc class
    $('.d-contents').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // add orcid ids
    $('.authors-affiliations').find('.author').each(function(i, el) {
      var orcid_id = front_matter.authors[i].orcidID;
      if (orcid_id) {
        var a = $('<a></a>');
        a.attr('href', 'https://orcid.org/' + orcid_id);
        var img = $('<img></img>');
        img.addClass('orcid-id');
        img.attr('alt', 'ORCID ID');
        img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
        a.append(img);
        $(this).append(a);
      }
    });

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // remove d-appendix and d-footnote-list local styles
    $('d-appendix > style:first-child').remove();
    $('d-footnote-list > style:first-child').remove();

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // hoverable references
    $('span.citation[data-cites]').each(function() {
      var refHtml = $('#ref-' + $(this).attr('data-cites')).html();
      window.tippy(this, {
        allowHTML: true,
        content: refHtml,
        maxWidth: 500,
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start'
      });
    });

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-contents').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<!--/radix_placeholder_distill-->
  <script src="../../site_libs/kePrint-0.0.1/kePrint.js"></script>
  <script src="../../site_libs/jquery-1.11.3/jquery.min.js"></script>
  <script src="../../site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="../../site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<script type="text/javascript" cookie-consent="tracking" async src="https://www.googletagmanager.com/gtag/js?id=UA-79528685-1"></script>
<script type="text/javascript" cookie-consent="tracking">
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-79528685-1');
</script>
<style type="text/css">
@import url("pygment_highlights.css");
@import url(https://fonts.googleapis.com/css?family=Roboto:400,400italic,500,500italic,700,700italic,900,900italic,300italic,300,100italic,100);
@import url("https://fonts.googleapis.com/css?family=Roboto|Roboto+Mono|Roboto+Condensed|Open+Sans|Open+Sans+Condensed:300|Open+Sans+Condensed:light|Lato|Lora|Fira+Sans|Fira+Mono");


body {
  font-family: Roboto, 'Libre Baskerville', sans-serif; /*, et-book, "Palatino Linotype", "Palatino LT STD", 'Lora', serif*/
  font-size: 15px;
  font-weight: 300;
  color: #404040;        /* #404040*/
  position: relative;
  background: #FFFFF8;      /* {{ site.page-col }}; */
}

/* distill specific */

d-title h1 {
  font-family: 'Open Sans Condensed', Roboto, Helvetica, Arial, sans;
  font-weight: 200;
  font-size: 50px;
  color: #ff5500;
  margin-top: 4rem;
  margin-bottom: 1.5rem;
  line-height: 1;
}

.index-title h1 {
  font-family: 'Open Sans Condensed', Roboto, Helvetica, Arial, sans;
  font-weight: 200;
  font-size: 75px;
  font-variant: small-caps;
  text-align: center;
  color: #ff5500;
  margin-top: 4rem;
  margin-bottom: 1.5rem;
  line-height: 1;
  border-bottom: 0; /*same as default h2*/
  padding-bottom: 1rem; 
}

d-article h1 {
  font-family: 'Open Sans Condensed', Roboto, Helvetica, Arial, sans;
  font-style: normal;
  font-variant: small-caps;
  font-weight: 400;
  font-size: 175%;
  color: #ff5500;
  margin-top: 2.1rem;
  margin-bottom: 1.2rem;
  line-height: 1;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1); /*same as default h2*/
  padding-bottom: 1rem;
}

d-article h2 {
  font-family: 'Open Sans Condensed', Roboto, Helvetica, Arial, sans;
  font-style: normal;
  font-weight: 400;
  font-size: 150%;
  color: #ff5500;
  margin-top: 2.1rem;
  margin-bottom: 1.2rem;
  line-height: 1;
  /* to remove will require something to keep the inline from inserting */
  border-bottom: 0px solid rgba(0, 0, 0, 0.1); 
  padding-bottom: 1rem; 
  
}


d-article h3 {
  font-family: 'Open Sans Condensed', Roboto, Helvetica, Arial, sans;
  font-style: normal;
  font-weight: 400;
  font-size: 125%;
  color: #ff5500;
  opacity: .9;
  margin-top: 2rem;
  margin-bottom: 1.2rem;
  line-height: 1;
}

d-article  h4 {
  font-family: 'Open Sans Condensed', Roboto, Helvetica, Arial, sans;
  font-style: normal;
  text-transform: none;  /*default is uppercase*/
  font-weight: 400;
  font-size: 110%;
  color: #ff5500;
  opacity: .9;
  margin-top: 1.9rem;
  margin-bottom: 1.2rem;
  line-height: 1;
}

d-article  h5 {
  font-family: 'Open Sans Condensed', Roboto, Helvetica, Arial, sans;
  font-style: normal;
  text-transform: none;  /*default is uppercase*/
  font-weight: 400;
  font-size: 100%;
  color: #ff5500;
  opacity: .9;
  margin-top: 1.9rem;
  margin-bottom: 1.2rem;
  line-height: 1;
}



/* Nav bar */

.distill-site-nav {
  color: #404040;
  background-color: #d9edf7;
  font-size: 20px;
  font-weight: 300;
}


.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: #0085a1;
}

/* sidebar on front page with category listing */

.posts-with-sidebar .posts-sidebar {
  float: right;
  width: 10%;    /* default 20, made narrow */
  margin-top: 60px;
  padding-top: 24px;
  padding-bottom: 24px;
}

/* attempt to make result not so wide/spacious */ 

.posts-with-sidebar .posts-list {
  width: 66%;
  margin-left: 11%;
}

.posts-sidebar {
  font-size: 75%;
  margin-right: 10%;
}


/* code */

/* will now work as of latest distill version*/

d-article div.sourceCode code, d-article pre code {
  font-family: 'Roboto Mono', Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  color: #404040FF;
  font-size: 90%;
}


d-article pre {
  background-color: #FFFFF8;
}

/* Otherwise will leave a white background visible at bottom of code chunks*/
d-article div.sourceCode {
  background-color: #FFFFF8;
}

/* code results/output */
pre.text-output {
  font-family: 'Roboto Mono', Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  color: #000000CC;
}



/* latex */
.math {
  color: #404040;  
  font-weight: normal;
  font-size: 90%;
}


/* link effects; appendix apply to footnote return links */

/*remove old line*/
d-article a:hover {
  text-decoration: none;
  border-bottom: none;
  background-size: 100% 100%;
  cursor: pointer;
}


/* add new effects */
p a, aside a, li a, d-appendix a, a.footnote-backlink {
    color: #03b3ff;
    display: inline-block;
    text-decoration: none;
    transition: background-size .4s ease;
    border-bottom: 0px solid;
}

p a {
  /* text-decoration: underline */
  color: #03b3ff;
}

p a:after, aside a:after, li a:after, d-appendix a:after {
    content: '';
    display: block;
    width: 0;
    height: 1.25px;
    background: #FF4F03;
    transition: width .3s;
}

p a:hover::after, aside a:hover::after, li a:hover::after, d-appendix a:hover::after {
  width: 100%;
  //transition: width .3s;
 }

/* for twitter etc icon links */
.social-icon {
  color: #03b3ff;
  background-image: none;  /* remove hover line*/
  background-size: 0 100%;
  background-repeat: no-repeat;
  text-decoration: none;
  transition: background-size .4s ease;
  border-bottom: 0px solid;
}

d-footnote-list a.footnote-backlink {
    color:  #03b3ff !important; /* otherwise some inline injection will occur*/
    padding-left: 0.5em;
}

.categories li > a:hover {
  border-bottom: none !important;
}

/* remove underline for TOC */
.d-contents nav a:hover {
    text-decoration: none;
}



/* text highlights */
.emph, em {
  color: #E32D00;  /*#ff5500 #D14300*/
  font-style: normal;
  font-weight: 450;
}

/* don't do color for references */
.references em {
  color: rgba(0,0,0,0.5);
  font-style: normal;
  font-weight: 450;
}

strong {
  color: #404040;  
}

/* pack func and objclass colors initially come from hcl(seq(90,360, length.out=4), c=80, l=80); redone for contrast*/
.pack {
  color: #1f65b7; /* #990071 #AC9CFF #e41a1c*/
  font-weight: 400;
}

.func {
  color: #007020;   /*#007199 #00CBB6; #984ea3; can just use `` instead*/
  font-weight: 400;
}

.objclass {
  color:  #947100;  /*#AAB400 #4daf4a; #FFC5D0*/
  font-weight: 400;
}

/* object/class via inline code */
p code {
  color: #947100;
}


/* figures and tables */

d-article table {
    border-collapse: collapse;
    margin-top: 20px;
    margin-bottom: 20px;
    border-bottom: 1px solid rgba(0, 0, 0, 0.2);
}

/* add spacing for figs and tables, so text and other figs/tables don't 
start right up at their border */
.l-body {
  margin-top: 20px;
  margin-bottom: 20px;
}

/* Search bar */

.algolia-autocomplete {
    display: inline-block;
    margin-left: 10px;
    vertical-align: sub;
    background-color: #fffff8;
    color: #03b3ff;             /* Color of text in drop-down*/
    padding: 6px;
    padding-top: 8px;
    padding-bottom: 0;
    border-radius: 6px;
    border: 0px #03b3ff solid;  /* Removed border */
    width: 180px;
}
</style>
<!--/radix_placeholder_site_in_header-->

  <link rel="stylesheet" href="../../styles.css" type="text/css"/>

</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Categorical Effects as Random","description":"Exploring random slopes for categorical covariates and similar models","authors":[{"author":"Michael Clark","authorURL":"https://m-clark.github.io","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}],"publishedDate":"2020-03-01T00:00:00.000+00:00","citationText":"Clark, 2020"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a class="logo" href="../../index.html">
<img src="../../img/mc_logo.png" alt="Logo"/>
</a>
<a href="../../index.html" class="title">Michael Clark</a>
<input id="distill-search" class="nav-search hidden" type="text" placeholder="Search..."/>
</div>
<div class="nav-right">
<a href="../../about.html">About</a>
<a href="../../documents.html">Documents</a>
<a href="../../workshops.html">Workshops</a>
<a href="../../code.html">Code</a>
<a href="../../resources.html">Resources</a>
<a href="https://github.com/m-clark">
<i class="fab fa-github-alt fa-1x" aria-hidden="true"></i>
</a>
<a href="../../index.xml">
<i class="fa fa-rss fa-1x" aria-hidden="true"></i>
</a>
<a href="https://twitter.com/statsdatasci">
<i class="fab fa-twitter fa-1x" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Categorical Effects as Random</h1>
<p><p>Exploring random slopes for categorical covariates and similar models</p></p>
</div>

<div class="d-byline">
  Michael Clark <a href="https://m-clark.github.io" class="uri">https://m-clark.github.io</a> 
  
<br/>2020-03-01
</div>

<div class="d-article">
<h3 class="d-toc-header">Table of Contents</h3>
<nav class="d-toc" id="TOC">
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#machines">Machines</a><ul>
<li><a href="#the-data">The Data</a></li>
<li><a href="#random-effects-models">Random Effects Models</a></li>
<li><a href="#summarize-all-the-models">Summarize All the Models</a></li>
</ul></li>
<li><a href="#simulation">Simulation</a><ul>
<li><a href="#data-creation">Data Creation</a></li>
<li><a href="#run-the-models-summarize">Run the Models &amp; Summarize</a></li>
<li><a href="#change-the-model-orientation">Change the model orientation</a></li>
</ul></li>
<li><a href="#summary">Summary</a></li>
</ul>
</nav>
<hr class="d-toc-separator"/>
<aside>
Last updated March 09, 2020.
</aside>
<p>Prerequisites: familiarity with <a href="https://m-clark.github.io/mixed-models-with-R/">mixed models</a></p>
<h2 id="introduction">Introduction</h2>
<p>It’s often the case where, for mixed models, we want to look at random ‘slopes’ as well as random intercepts, such that coefficients for the fixed effects are expected to vary by group. This is very common in longitudinal settings, were we want to examine an overall trend, but allow the trend to vary by individual.</p>
<p>In such settings, when time is numeric, things are straightforward. The variance components are decomposed into parts for the intercept, the coefficient for the time indicator, and the residual variance (for linear mixed models). But what happens if we have only three time points? Does it make sense to treat it as numeric and hope for the best?</p>
<p>This came up in consulting because someone had a similar issue, and tried to keep the format for random slopes while treating the time indicator as categorical. This led to convergence issues, so we thought about what models might be possible. This post explores that scenario.</p>
<p>Packages used:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
library(tidyverse)
library(lme4)
library(mixedup)  # http://m-clark.github.io/mixedup</code></pre>
</div>
<h2 id="machines">Machines</h2>
<h3 id="the-data">The Data</h3>
<p>Let’s start with a very simple data set from the <span class="pack" style="">nlme</span> package, which comes with the standard R installation. The reason I chose this is because <a href="http://pages.stat.wisc.edu/~bates/UseR2008/WorkshopD.pdf">Doug Bates has a good treatment on this topic</a> using that example (starting at slide 85), which I just extend a bit.</p>
<p>Here is the data description from the help file.</p>
<blockquote>
<p>Data on an experiment to compare three brands of machines used in an industrial process are presented in Milliken and Johnson (p. 285, 1992). Six workers were chosen randomly among the employees of a factory to operate each machine three times. The response is an overall productivity score taking into account the number and quality of components produced.</p>
</blockquote>
<p>So for each worker and each machine, we’ll have three scores. Let’s look.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
machines = nlme::Machines

# for some reason worker is an ordered factor.
machines = machines %&gt;% 
  mutate(Worker = factor(Worker, levels = 1:6, ordered = FALSE))</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Worker
</th>
<th style="text-align:left;">
Machine
</th>
<th style="text-align:right;">
score
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
52.0
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
52.8
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
53.1
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
62.1
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
62.6
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
64.0
</td>
</tr>
</tbody>
</table>
</div>
<p>This duplicates the plot in Bates’ notes and visually describes the entire data set. There likely is variability due to both workers and machines.</p>
<div class="layout-chunk" data-layout="l-body">
<p><img src="random_categories_files/figure-html5/vis-data-1.svg" width="624" style="display: block; margin: auto;" /></p>
</div>
<h3 id="random-effects-models">Random Effects Models</h3>
<p>The random effects of potential interest are for worker and machine, so how do we specify this? Let’s try a standard approach. The following is the type of model tried by our client.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
model_m_slope = lmer(score ~ Machine + (1 + Machine | Worker), machines)</code></pre>
<pre><code>
Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl = control$checkConv, : Model failed to converge with max|grad| =
0.00805193 (tol = 0.002, component 1)</code></pre>
</div>
<p>This was exactly the same issue our client had- problematic convergence. This could be more of an issue with <span class="pack" style="">lme4</span>, and we could certainly explore tweaks to make the problem go away (or use a different package like <span class="pack" style="">glmmTMB</span>), but let’s go ahead and keep it.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
summarize_model(model_m_slope, ci = FALSE, cor_re = TRUE)</code></pre>
<pre><code>
Variance Components:</code></pre>
<pre><code>
    Group    Effect Variance   SD Var_prop
   Worker Intercept    16.68 4.08     0.25
   Worker  MachineB    34.72 5.89     0.53
   Worker  MachineC    13.62 3.69     0.21
 Residual               0.92 0.96     0.01</code></pre>
<pre><code>
Correlation of Random Effects:</code></pre>
<pre><code>
          Intercept MachineB MachineC
Intercept      1.00     0.49    -0.36
MachineB       0.49     1.00     0.30
MachineC      -0.36     0.30     1.00</code></pre>
<pre><code>

Fixed Effects:</code></pre>
<pre><code>
      Term Value   SE     t P_value Lower_2.5 Upper_97.5
 Intercept 52.36 1.68 31.12    0.00     49.06      55.65
  MachineB  7.97 2.43  3.28    0.00      3.21      12.72
  MachineC 13.92 1.54  9.03    0.00     10.90      16.94</code></pre>
</div>
<p>We get the variance components we expect, i.e. the variance attributable to the intercept (i.e. Machine A), as well as for the slopes for the difference in machine B vs. A, and C vs. A. We also see the correlations among the random effects. It’s this part that Bates acknowledges is hard to estimate, and incurs estimating potentially notably more parameters than typical random effects models. We have different options that will be available to us though, so let’s try some.</p>
<p>Let’s start with the simplest, most plausible models. The first would be to have at least a worker effect. The next baseline model could be if we only had a machine by worker effect, i.e. a separate effect of each machine for each worker, essentially treating the interaction term as the sole clustering unit.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
model_base_w  = lmer(score ~ Machine + (1 | Worker), machines)
model_base_wm = lmer(score ~ Machine + (1 | Worker:Machine), machines)</code></pre>
</div>
<p>Examining the random effects makes clear the difference between the two models. For our first baseline model, we only have 6 effects, one for each worker. For the second we have an effect of each machine for each worker.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
extract_random_effects(model_base_w)  # only 6 effects
extract_random_effects(model_base_wm) # 6 workers by 3 machines = 18 effects</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
group_var
</th>
<th style="text-align:left;">
effect
</th>
<th style="text-align:left;">
group
</th>
<th style="text-align:right;">
value
</th>
<th style="text-align:right;">
se
</th>
<th style="text-align:right;">
lower_2.5
</th>
<th style="text-align:right;">
upper_97.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Worker
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
1.210
</td>
<td style="text-align:right;">
1.032
</td>
<td style="text-align:right;">
-0.813
</td>
<td style="text-align:right;">
3.234
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
-1.594
</td>
<td style="text-align:right;">
1.032
</td>
<td style="text-align:right;">
-3.618
</td>
<td style="text-align:right;">
0.429
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
6.212
</td>
<td style="text-align:right;">
1.032
</td>
<td style="text-align:right;">
4.188
</td>
<td style="text-align:right;">
8.235
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
-0.069
</td>
<td style="text-align:right;">
1.032
</td>
<td style="text-align:right;">
-2.093
</td>
<td style="text-align:right;">
1.954
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:right;">
2.949
</td>
<td style="text-align:right;">
1.032
</td>
<td style="text-align:right;">
0.925
</td>
<td style="text-align:right;">
4.972
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
6
</td>
<td style="text-align:right;">
-8.707
</td>
<td style="text-align:right;">
1.032
</td>
<td style="text-align:right;">
-10.731
</td>
<td style="text-align:right;">
-6.684
</td>
</tr>
</tbody>
</table>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
group_var
</th>
<th style="text-align:left;">
effect
</th>
<th style="text-align:left;">
group
</th>
<th style="text-align:right;">
value
</th>
<th style="text-align:right;">
se
</th>
<th style="text-align:right;">
lower_2.5
</th>
<th style="text-align:right;">
upper_97.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
1:A
</td>
<td style="text-align:right;">
0.275
</td>
<td style="text-align:right;">
0.553
</td>
<td style="text-align:right;">
-0.808
</td>
<td style="text-align:right;">
1.359
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
1:B
</td>
<td style="text-align:right;">
2.556
</td>
<td style="text-align:right;">
0.553
</td>
<td style="text-align:right;">
1.473
</td>
<td style="text-align:right;">
3.640
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
1:C
</td>
<td style="text-align:right;">
0.920
</td>
<td style="text-align:right;">
0.553
</td>
<td style="text-align:right;">
-0.164
</td>
<td style="text-align:right;">
2.004
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
2:A
</td>
<td style="text-align:right;">
0.209
</td>
<td style="text-align:right;">
0.553
</td>
<td style="text-align:right;">
-0.874
</td>
<td style="text-align:right;">
1.293
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
2:B
</td>
<td style="text-align:right;">
-0.749
</td>
<td style="text-align:right;">
0.553
</td>
<td style="text-align:right;">
-1.833
</td>
<td style="text-align:right;">
0.334
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
2:C
</td>
<td style="text-align:right;">
-4.402
</td>
<td style="text-align:right;">
0.553
</td>
<td style="text-align:right;">
-5.486
</td>
<td style="text-align:right;">
-3.318
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
3:A
</td>
<td style="text-align:right;">
7.118
</td>
<td style="text-align:right;">
0.553
</td>
<td style="text-align:right;">
6.035
</td>
<td style="text-align:right;">
8.202
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
3:B
</td>
<td style="text-align:right;">
7.647
</td>
<td style="text-align:right;">
0.553
</td>
<td style="text-align:right;">
6.563
</td>
<td style="text-align:right;">
8.731
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
3:C
</td>
<td style="text-align:right;">
4.490
</td>
<td style="text-align:right;">
0.553
</td>
<td style="text-align:right;">
3.407
</td>
<td style="text-align:right;">
5.574
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
4:A
</td>
<td style="text-align:right;">
-1.113
</td>
<td style="text-align:right;">
0.553
</td>
<td style="text-align:right;">
-2.196
</td>
<td style="text-align:right;">
-0.029
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
4:B
</td>
<td style="text-align:right;">
2.391
</td>
<td style="text-align:right;">
0.553
</td>
<td style="text-align:right;">
1.307
</td>
<td style="text-align:right;">
3.475
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
4:C
</td>
<td style="text-align:right;">
-1.493
</td>
<td style="text-align:right;">
0.553
</td>
<td style="text-align:right;">
-2.577
</td>
<td style="text-align:right;">
-0.409
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
5:A
</td>
<td style="text-align:right;">
-0.981
</td>
<td style="text-align:right;">
0.553
</td>
<td style="text-align:right;">
-2.064
</td>
<td style="text-align:right;">
0.103
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
5:B
</td>
<td style="text-align:right;">
4.705
</td>
<td style="text-align:right;">
0.553
</td>
<td style="text-align:right;">
3.621
</td>
<td style="text-align:right;">
5.789
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
5:C
</td>
<td style="text-align:right;">
5.416
</td>
<td style="text-align:right;">
0.553
</td>
<td style="text-align:right;">
4.332
</td>
<td style="text-align:right;">
6.499
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
6:A
</td>
<td style="text-align:right;">
-5.509
</td>
<td style="text-align:right;">
0.553
</td>
<td style="text-align:right;">
-6.593
</td>
<td style="text-align:right;">
-4.426
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
6:B
</td>
<td style="text-align:right;">
-16.550
</td>
<td style="text-align:right;">
0.553
</td>
<td style="text-align:right;">
-17.634
</td>
<td style="text-align:right;">
-15.467
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
6:C
</td>
<td style="text-align:right;">
-4.931
</td>
<td style="text-align:right;">
0.553
</td>
<td style="text-align:right;">
-6.014
</td>
<td style="text-align:right;">
-3.847
</td>
</tr>
</tbody>
</table>
</div>
<p>As a next step, we’ll essentially combine our two baseline models.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
model_w_wm = lmer(score ~ Machine + (1 | Worker) + (1 | Worker:Machine), machines)</code></pre>
</div>
<p>Now we have 6 worker effects plus 18 machine within worker effects<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
extract_random_effects(model_w_wm)</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
group_var
</th>
<th style="text-align:left;">
effect
</th>
<th style="text-align:left;">
group
</th>
<th style="text-align:right;">
value
</th>
<th style="text-align:right;">
se
</th>
<th style="text-align:right;">
lower_2.5
</th>
<th style="text-align:right;">
upper_97.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
1:A
</td>
<td style="text-align:right;">
-0.750
</td>
<td style="text-align:right;">
2.015
</td>
<td style="text-align:right;">
-4.699
</td>
<td style="text-align:right;">
3.198
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
1:B
</td>
<td style="text-align:right;">
1.500
</td>
<td style="text-align:right;">
2.015
</td>
<td style="text-align:right;">
-2.449
</td>
<td style="text-align:right;">
5.449
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
1:C
</td>
<td style="text-align:right;">
-0.114
</td>
<td style="text-align:right;">
2.015
</td>
<td style="text-align:right;">
-4.063
</td>
<td style="text-align:right;">
3.834
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
2:A
</td>
<td style="text-align:right;">
1.553
</td>
<td style="text-align:right;">
2.015
</td>
<td style="text-align:right;">
-2.396
</td>
<td style="text-align:right;">
5.501
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
2:B
</td>
<td style="text-align:right;">
0.607
</td>
<td style="text-align:right;">
2.015
</td>
<td style="text-align:right;">
-3.342
</td>
<td style="text-align:right;">
4.555
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
2:C
</td>
<td style="text-align:right;">
-2.997
</td>
<td style="text-align:right;">
2.015
</td>
<td style="text-align:right;">
-6.945
</td>
<td style="text-align:right;">
0.952
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
3:A
</td>
<td style="text-align:right;">
1.778
</td>
<td style="text-align:right;">
2.015
</td>
<td style="text-align:right;">
-2.171
</td>
<td style="text-align:right;">
5.726
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
3:B
</td>
<td style="text-align:right;">
2.299
</td>
<td style="text-align:right;">
2.015
</td>
<td style="text-align:right;">
-1.649
</td>
<td style="text-align:right;">
6.248
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
3:C
</td>
<td style="text-align:right;">
-0.815
</td>
<td style="text-align:right;">
2.015
</td>
<td style="text-align:right;">
-4.763
</td>
<td style="text-align:right;">
3.134
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
4:A
</td>
<td style="text-align:right;">
-1.039
</td>
<td style="text-align:right;">
2.015
</td>
<td style="text-align:right;">
-4.988
</td>
<td style="text-align:right;">
2.909
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
4:B
</td>
<td style="text-align:right;">
2.417
</td>
<td style="text-align:right;">
2.015
</td>
<td style="text-align:right;">
-1.531
</td>
<td style="text-align:right;">
6.366
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
4:C
</td>
<td style="text-align:right;">
-1.414
</td>
<td style="text-align:right;">
2.015
</td>
<td style="text-align:right;">
-5.363
</td>
<td style="text-align:right;">
2.534
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
5:A
</td>
<td style="text-align:right;">
-3.457
</td>
<td style="text-align:right;">
2.015
</td>
<td style="text-align:right;">
-7.405
</td>
<td style="text-align:right;">
0.492
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
5:B
</td>
<td style="text-align:right;">
2.152
</td>
<td style="text-align:right;">
2.015
</td>
<td style="text-align:right;">
-1.796
</td>
<td style="text-align:right;">
6.101
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
5:C
</td>
<td style="text-align:right;">
2.853
</td>
<td style="text-align:right;">
2.015
</td>
<td style="text-align:right;">
-1.095
</td>
<td style="text-align:right;">
6.802
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
6:A
</td>
<td style="text-align:right;">
1.916
</td>
<td style="text-align:right;">
2.015
</td>
<td style="text-align:right;">
-2.032
</td>
<td style="text-align:right;">
5.865
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
6:B
</td>
<td style="text-align:right;">
-8.976
</td>
<td style="text-align:right;">
2.015
</td>
<td style="text-align:right;">
-12.924
</td>
<td style="text-align:right;">
-5.027
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
6:C
</td>
<td style="text-align:right;">
2.487
</td>
<td style="text-align:right;">
2.015
</td>
<td style="text-align:right;">
-1.462
</td>
<td style="text-align:right;">
6.435
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
1.045
</td>
<td style="text-align:right;">
1.981
</td>
<td style="text-align:right;">
-2.839
</td>
<td style="text-align:right;">
4.928
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
-1.376
</td>
<td style="text-align:right;">
1.981
</td>
<td style="text-align:right;">
-5.259
</td>
<td style="text-align:right;">
2.507
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
5.361
</td>
<td style="text-align:right;">
1.981
</td>
<td style="text-align:right;">
1.478
</td>
<td style="text-align:right;">
9.244
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
-0.060
</td>
<td style="text-align:right;">
1.981
</td>
<td style="text-align:right;">
-3.943
</td>
<td style="text-align:right;">
3.823
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:right;">
2.545
</td>
<td style="text-align:right;">
1.981
</td>
<td style="text-align:right;">
-1.339
</td>
<td style="text-align:right;">
6.428
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
6
</td>
<td style="text-align:right;">
-7.514
</td>
<td style="text-align:right;">
1.981
</td>
<td style="text-align:right;">
-11.397
</td>
<td style="text-align:right;">
-3.631
</td>
</tr>
</tbody>
</table>
</div>
<p>If you look closely at these effects, and add them together, you will get a value similar to our second baseline model, which is probably not too surprising. For example in the above model <code>1:B + 1</code> = 1.5 <code>+</code> 1.045. Looking at the initial model, the estimated random effect for <code>1:B</code> was 2.556. Likewise if we look at the variance components, we can see that the sum of the non-residual effect variances for <code>model_w_wm</code> equals the variance of <code>model_base_wm</code> (36.8). So this latest model allows us to disentangle the worker and machine effects, where our baseline models did not.</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<p>Next we’ll do the ‘vector-valued’ model Bates describes. This removes the intercept portion of the formula in the original random slopes model, but is otherwise the same. We can look at the results here, but I will hold off description for comparing it to other models. Note that at least have no convergence problem.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
model_m_vv = lmer(score ~ Machine + (0 + Machine | Worker), machines)

summarize_model(model_m_vv, ci = 0, cor_re = TRUE)</code></pre>
<pre><code>
Variance Components:</code></pre>
<pre><code>
    Group   Effect Variance   SD Var_prop
   Worker MachineA    16.67 4.08     0.15
   Worker MachineB    74.30 8.62     0.67
   Worker MachineC    19.27 4.39     0.17
 Residual              0.93 0.96     0.01</code></pre>
<pre><code>
Correlation of Random Effects:</code></pre>
<pre><code>
         MachineA MachineB MachineC
MachineA     1.00     0.80     0.62
MachineB     0.80     1.00     0.77
MachineC     0.62     0.77     1.00</code></pre>
<pre><code>

Fixed Effects:</code></pre>
<pre><code>
      Term Value   SE     t P_value Lower_2.5 Upper_97.5
 Intercept 52.36 1.68 31.12    0.00     49.06      55.65
  MachineB  7.97 2.42  3.30    0.00      3.23      12.70
  MachineC 13.92 1.54  9.05    0.00     10.90      16.93</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<h3 id="summarize-all-the-models">Summarize All the Models</h3>
<p>Now let’s extract the fixed effect and variance component summaries for all the models.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
model_list = mget(ls(pattern = &#39;model_&#39;))

fe = map_df(model_list, extract_fixed_effects, .id = &#39;model&#39;)

vc = map_df(model_list, extract_vc, ci_level = 0, .id = &#39;model&#39;)</code></pre>
</div>
<p>First, let’s look at the fixed effects. We see that there are no differences in the coefficients for the fixed effect of machine, which is our only covariate in the model. However, there are notable differences for the estimated standard errors. Practically we’d come to no differences in our conclusions, but the uncertainty associated with them would be different.</p>
<div class="layout-chunk" data-layout="l-body">
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
model
</th>
<th style="text-align:left;">
term
</th>
<th style="text-align:right;">
value
</th>
<th style="text-align:right;">
se
</th>
<th style="text-align:right;">
t
</th>
<th style="text-align:right;">
p_value
</th>
<th style="text-align:right;">
lower_2.5
</th>
<th style="text-align:right;">
upper_97.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
model_base_w
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:right;">
52.356
</td>
<td style="text-align:right;">
2.229
</td>
<td style="text-align:right;">
23.485
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
47.986
</td>
<td style="text-align:right;">
56.725
</td>
</tr>
<tr>
<td style="text-align:left;">
model_base_w
</td>
<td style="text-align:left;">
MachineB
</td>
<td style="text-align:right;">
7.967
</td>
<td style="text-align:right;">
1.054
</td>
<td style="text-align:right;">
7.559
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
5.901
</td>
<td style="text-align:right;">
10.032
</td>
</tr>
<tr>
<td style="text-align:left;">
model_base_w
</td>
<td style="text-align:left;">
MachineC
</td>
<td style="text-align:right;">
13.917
</td>
<td style="text-align:right;">
1.054
</td>
<td style="text-align:right;">
13.205
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
11.851
</td>
<td style="text-align:right;">
15.982
</td>
</tr>
<tr>
<td style="text-align:left;">
model_base_wm
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:right;">
52.356
</td>
<td style="text-align:right;">
2.486
</td>
<td style="text-align:right;">
21.062
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
47.483
</td>
<td style="text-align:right;">
57.228
</td>
</tr>
<tr>
<td style="text-align:left;">
model_base_wm
</td>
<td style="text-align:left;">
MachineB
</td>
<td style="text-align:right;">
7.967
</td>
<td style="text-align:right;">
3.516
</td>
<td style="text-align:right;">
2.266
</td>
<td style="text-align:right;">
0.023
</td>
<td style="text-align:right;">
1.076
</td>
<td style="text-align:right;">
14.857
</td>
</tr>
<tr>
<td style="text-align:left;">
model_base_wm
</td>
<td style="text-align:left;">
MachineC
</td>
<td style="text-align:right;">
13.917
</td>
<td style="text-align:right;">
3.516
</td>
<td style="text-align:right;">
3.959
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
7.026
</td>
<td style="text-align:right;">
20.807
</td>
</tr>
<tr>
<td style="text-align:left;">
model_m_slope
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:right;">
52.356
</td>
<td style="text-align:right;">
1.683
</td>
<td style="text-align:right;">
31.116
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
49.058
</td>
<td style="text-align:right;">
55.653
</td>
</tr>
<tr>
<td style="text-align:left;">
model_m_slope
</td>
<td style="text-align:left;">
MachineB
</td>
<td style="text-align:right;">
7.967
</td>
<td style="text-align:right;">
2.427
</td>
<td style="text-align:right;">
3.283
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
3.210
</td>
<td style="text-align:right;">
12.723
</td>
</tr>
<tr>
<td style="text-align:left;">
model_m_slope
</td>
<td style="text-align:left;">
MachineC
</td>
<td style="text-align:right;">
13.917
</td>
<td style="text-align:right;">
1.541
</td>
<td style="text-align:right;">
9.033
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
10.897
</td>
<td style="text-align:right;">
16.936
</td>
</tr>
<tr>
<td style="text-align:left;">
model_m_vv
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:right;">
52.356
</td>
<td style="text-align:right;">
1.682
</td>
<td style="text-align:right;">
31.122
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
49.058
</td>
<td style="text-align:right;">
55.653
</td>
</tr>
<tr>
<td style="text-align:left;">
model_m_vv
</td>
<td style="text-align:left;">
MachineB
</td>
<td style="text-align:right;">
7.967
</td>
<td style="text-align:right;">
2.416
</td>
<td style="text-align:right;">
3.297
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
3.230
</td>
<td style="text-align:right;">
12.703
</td>
</tr>
<tr>
<td style="text-align:left;">
model_m_vv
</td>
<td style="text-align:left;">
MachineC
</td>
<td style="text-align:right;">
13.917
</td>
<td style="text-align:right;">
1.537
</td>
<td style="text-align:right;">
9.053
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
10.904
</td>
<td style="text-align:right;">
16.930
</td>
</tr>
<tr>
<td style="text-align:left;">
model_w_wm
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:right;">
52.356
</td>
<td style="text-align:right;">
2.486
</td>
<td style="text-align:right;">
21.062
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
47.483
</td>
<td style="text-align:right;">
57.228
</td>
</tr>
<tr>
<td style="text-align:left;">
model_w_wm
</td>
<td style="text-align:left;">
MachineB
</td>
<td style="text-align:right;">
7.967
</td>
<td style="text-align:right;">
2.177
</td>
<td style="text-align:right;">
3.660
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
3.700
</td>
<td style="text-align:right;">
12.233
</td>
</tr>
<tr>
<td style="text-align:left;">
model_w_wm
</td>
<td style="text-align:left;">
MachineC
</td>
<td style="text-align:right;">
13.917
</td>
<td style="text-align:right;">
2.177
</td>
<td style="text-align:right;">
6.393
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
9.650
</td>
<td style="text-align:right;">
18.183
</td>
</tr>
</tbody>
</table>
</div>
<p>Here are the variance components, there are definitely some differences here, but, as we’ll see, maybe not as much as we suspect.</p>
<div class="layout-chunk" data-layout="l-body">
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
model
</th>
<th style="text-align:left;">
group
</th>
<th style="text-align:left;">
effect
</th>
<th style="text-align:right;">
variance
</th>
<th style="text-align:right;">
sd
</th>
<th style="text-align:right;">
var_prop
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
model_base_w
</td>
<td style="text-align:left;">
Worker
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:right;">
26.487
</td>
<td style="text-align:right;">
5.147
</td>
<td style="text-align:right;">
0.726
</td>
</tr>
<tr>
<td style="text-align:left;">
model_base_w
</td>
<td style="text-align:left;">
Residual
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
9.996
</td>
<td style="text-align:right;">
3.162
</td>
<td style="text-align:right;">
0.274
</td>
</tr>
<tr>
<td style="text-align:left;">
model_base_wm
</td>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:right;">
36.768
</td>
<td style="text-align:right;">
6.064
</td>
<td style="text-align:right;">
0.975
</td>
</tr>
<tr>
<td style="text-align:left;">
model_base_wm
</td>
<td style="text-align:left;">
Residual
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
0.925
</td>
<td style="text-align:right;">
0.962
</td>
<td style="text-align:right;">
0.025
</td>
</tr>
<tr>
<td style="text-align:left;">
model_m_slope
</td>
<td style="text-align:left;">
Worker
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:right;">
16.679
</td>
<td style="text-align:right;">
4.084
</td>
<td style="text-align:right;">
0.253
</td>
</tr>
<tr>
<td style="text-align:left;">
model_m_slope
</td>
<td style="text-align:left;">
Worker
</td>
<td style="text-align:left;">
MachineB
</td>
<td style="text-align:right;">
34.717
</td>
<td style="text-align:right;">
5.892
</td>
<td style="text-align:right;">
0.526
</td>
</tr>
<tr>
<td style="text-align:left;">
model_m_slope
</td>
<td style="text-align:left;">
Worker
</td>
<td style="text-align:left;">
MachineC
</td>
<td style="text-align:right;">
13.625
</td>
<td style="text-align:right;">
3.691
</td>
<td style="text-align:right;">
0.207
</td>
</tr>
<tr>
<td style="text-align:left;">
model_m_slope
</td>
<td style="text-align:left;">
Residual
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
0.924
</td>
<td style="text-align:right;">
0.961
</td>
<td style="text-align:right;">
0.014
</td>
</tr>
<tr>
<td style="text-align:left;">
model_m_vv
</td>
<td style="text-align:left;">
Worker
</td>
<td style="text-align:left;">
MachineA
</td>
<td style="text-align:right;">
16.672
</td>
<td style="text-align:right;">
4.083
</td>
<td style="text-align:right;">
0.150
</td>
</tr>
<tr>
<td style="text-align:left;">
model_m_vv
</td>
<td style="text-align:left;">
Worker
</td>
<td style="text-align:left;">
MachineB
</td>
<td style="text-align:right;">
74.302
</td>
<td style="text-align:right;">
8.620
</td>
<td style="text-align:right;">
0.668
</td>
</tr>
<tr>
<td style="text-align:left;">
model_m_vv
</td>
<td style="text-align:left;">
Worker
</td>
<td style="text-align:left;">
MachineC
</td>
<td style="text-align:right;">
19.270
</td>
<td style="text-align:right;">
4.390
</td>
<td style="text-align:right;">
0.173
</td>
</tr>
<tr>
<td style="text-align:left;">
model_m_vv
</td>
<td style="text-align:left;">
Residual
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
0.925
</td>
<td style="text-align:right;">
0.962
</td>
<td style="text-align:right;">
0.008
</td>
</tr>
<tr>
<td style="text-align:left;">
model_w_wm
</td>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:right;">
13.909
</td>
<td style="text-align:right;">
3.730
</td>
<td style="text-align:right;">
0.369
</td>
</tr>
<tr>
<td style="text-align:left;">
model_w_wm
</td>
<td style="text-align:left;">
Worker
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:right;">
22.858
</td>
<td style="text-align:right;">
4.781
</td>
<td style="text-align:right;">
0.606
</td>
</tr>
<tr>
<td style="text-align:left;">
model_w_wm
</td>
<td style="text-align:left;">
Residual
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
0.925
</td>
<td style="text-align:right;">
0.962
</td>
<td style="text-align:right;">
0.025
</td>
</tr>
</tbody>
</table>
</div>
<p>We can see that the <code>base_wm</code> model has (non-residual) variance 36.768. This equals the total of the two (non-residual) variance components of the <code>w_wm</code> model 13.909 <code>+</code> 22.858, which again speaks to the latter model decomposing a machine effect into worker + machine effects. This value also equals the variance of the vector-valued model divided by the number of groups (16.672 + 74.302 + 19.27) <code>/</code> 3.</p>
<p>We can see that the estimated random effects from the vector-valued model (<code>m_vv</code>) are essentially the same as from the baseline, interaction-only model. However, the way it is estimated allows for incorporation of correlations among the machine random effects, so they are not identical (but pretty close).</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
extract_random_effects(model_m_vv)

extract_random_effects(model_base_wm) </code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
group_var
</th>
<th style="text-align:left;">
effect
</th>
<th style="text-align:left;">
group
</th>
<th style="text-align:right;">
value
</th>
<th style="text-align:right;">
se
</th>
<th style="text-align:right;">
lower_2.5
</th>
<th style="text-align:right;">
upper_97.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Worker
</td>
<td style="text-align:left;">
MachineA
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
0.312
</td>
<td style="text-align:right;">
0.541
</td>
<td style="text-align:right;">
-0.749
</td>
<td style="text-align:right;">
1.373
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker
</td>
<td style="text-align:left;">
MachineB
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
2.553
</td>
<td style="text-align:right;">
0.551
</td>
<td style="text-align:right;">
1.474
</td>
<td style="text-align:right;">
3.632
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker
</td>
<td style="text-align:left;">
MachineC
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
0.930
</td>
<td style="text-align:right;">
0.545
</td>
<td style="text-align:right;">
-0.137
</td>
<td style="text-align:right;">
1.998
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker
</td>
<td style="text-align:left;">
MachineA
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
0.183
</td>
<td style="text-align:right;">
0.541
</td>
<td style="text-align:right;">
-0.878
</td>
<td style="text-align:right;">
1.245
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker
</td>
<td style="text-align:left;">
MachineB
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
-0.803
</td>
<td style="text-align:right;">
0.551
</td>
<td style="text-align:right;">
-1.882
</td>
<td style="text-align:right;">
0.276
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker
</td>
<td style="text-align:left;">
MachineC
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
-4.282
</td>
<td style="text-align:right;">
0.545
</td>
<td style="text-align:right;">
-5.350
</td>
<td style="text-align:right;">
-3.214
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker
</td>
<td style="text-align:left;">
MachineA
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
6.969
</td>
<td style="text-align:right;">
0.541
</td>
<td style="text-align:right;">
5.908
</td>
<td style="text-align:right;">
8.031
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker
</td>
<td style="text-align:left;">
MachineB
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
7.779
</td>
<td style="text-align:right;">
0.551
</td>
<td style="text-align:right;">
6.700
</td>
<td style="text-align:right;">
8.858
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker
</td>
<td style="text-align:left;">
MachineC
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
4.474
</td>
<td style="text-align:right;">
0.545
</td>
<td style="text-align:right;">
3.406
</td>
<td style="text-align:right;">
5.542
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker
</td>
<td style="text-align:left;">
MachineA
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
-1.024
</td>
<td style="text-align:right;">
0.541
</td>
<td style="text-align:right;">
-2.085
</td>
<td style="text-align:right;">
0.037
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker
</td>
<td style="text-align:left;">
MachineB
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
2.328
</td>
<td style="text-align:right;">
0.551
</td>
<td style="text-align:right;">
1.249
</td>
<td style="text-align:right;">
3.408
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker
</td>
<td style="text-align:left;">
MachineC
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
-1.415
</td>
<td style="text-align:right;">
0.545
</td>
<td style="text-align:right;">
-2.482
</td>
<td style="text-align:right;">
-0.347
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker
</td>
<td style="text-align:left;">
MachineA
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:right;">
-0.849
</td>
<td style="text-align:right;">
0.541
</td>
<td style="text-align:right;">
-1.910
</td>
<td style="text-align:right;">
0.212
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker
</td>
<td style="text-align:left;">
MachineB
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:right;">
4.726
</td>
<td style="text-align:right;">
0.551
</td>
<td style="text-align:right;">
3.647
</td>
<td style="text-align:right;">
5.805
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker
</td>
<td style="text-align:left;">
MachineC
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:right;">
5.323
</td>
<td style="text-align:right;">
0.545
</td>
<td style="text-align:right;">
4.255
</td>
<td style="text-align:right;">
6.390
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker
</td>
<td style="text-align:left;">
MachineA
</td>
<td style="text-align:left;">
6
</td>
<td style="text-align:right;">
-5.592
</td>
<td style="text-align:right;">
0.541
</td>
<td style="text-align:right;">
-6.653
</td>
<td style="text-align:right;">
-4.531
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker
</td>
<td style="text-align:left;">
MachineB
</td>
<td style="text-align:left;">
6
</td>
<td style="text-align:right;">
-16.583
</td>
<td style="text-align:right;">
0.551
</td>
<td style="text-align:right;">
-17.662
</td>
<td style="text-align:right;">
-15.504
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker
</td>
<td style="text-align:left;">
MachineC
</td>
<td style="text-align:left;">
6
</td>
<td style="text-align:right;">
-5.030
</td>
<td style="text-align:right;">
0.545
</td>
<td style="text-align:right;">
-6.098
</td>
<td style="text-align:right;">
-3.963
</td>
</tr>
</tbody>
</table>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
group_var
</th>
<th style="text-align:left;">
effect
</th>
<th style="text-align:left;">
group
</th>
<th style="text-align:right;">
value
</th>
<th style="text-align:right;">
se
</th>
<th style="text-align:right;">
lower_2.5
</th>
<th style="text-align:right;">
upper_97.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
1:A
</td>
<td style="text-align:right;">
0.275
</td>
<td style="text-align:right;">
0.553
</td>
<td style="text-align:right;">
-0.808
</td>
<td style="text-align:right;">
1.359
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
1:B
</td>
<td style="text-align:right;">
2.556
</td>
<td style="text-align:right;">
0.553
</td>
<td style="text-align:right;">
1.473
</td>
<td style="text-align:right;">
3.640
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
1:C
</td>
<td style="text-align:right;">
0.920
</td>
<td style="text-align:right;">
0.553
</td>
<td style="text-align:right;">
-0.164
</td>
<td style="text-align:right;">
2.004
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
2:A
</td>
<td style="text-align:right;">
0.209
</td>
<td style="text-align:right;">
0.553
</td>
<td style="text-align:right;">
-0.874
</td>
<td style="text-align:right;">
1.293
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
2:B
</td>
<td style="text-align:right;">
-0.749
</td>
<td style="text-align:right;">
0.553
</td>
<td style="text-align:right;">
-1.833
</td>
<td style="text-align:right;">
0.334
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
2:C
</td>
<td style="text-align:right;">
-4.402
</td>
<td style="text-align:right;">
0.553
</td>
<td style="text-align:right;">
-5.486
</td>
<td style="text-align:right;">
-3.318
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
3:A
</td>
<td style="text-align:right;">
7.118
</td>
<td style="text-align:right;">
0.553
</td>
<td style="text-align:right;">
6.035
</td>
<td style="text-align:right;">
8.202
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
3:B
</td>
<td style="text-align:right;">
7.647
</td>
<td style="text-align:right;">
0.553
</td>
<td style="text-align:right;">
6.563
</td>
<td style="text-align:right;">
8.731
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
3:C
</td>
<td style="text-align:right;">
4.490
</td>
<td style="text-align:right;">
0.553
</td>
<td style="text-align:right;">
3.407
</td>
<td style="text-align:right;">
5.574
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
4:A
</td>
<td style="text-align:right;">
-1.113
</td>
<td style="text-align:right;">
0.553
</td>
<td style="text-align:right;">
-2.196
</td>
<td style="text-align:right;">
-0.029
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
4:B
</td>
<td style="text-align:right;">
2.391
</td>
<td style="text-align:right;">
0.553
</td>
<td style="text-align:right;">
1.307
</td>
<td style="text-align:right;">
3.475
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
4:C
</td>
<td style="text-align:right;">
-1.493
</td>
<td style="text-align:right;">
0.553
</td>
<td style="text-align:right;">
-2.577
</td>
<td style="text-align:right;">
-0.409
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
5:A
</td>
<td style="text-align:right;">
-0.981
</td>
<td style="text-align:right;">
0.553
</td>
<td style="text-align:right;">
-2.064
</td>
<td style="text-align:right;">
0.103
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
5:B
</td>
<td style="text-align:right;">
4.705
</td>
<td style="text-align:right;">
0.553
</td>
<td style="text-align:right;">
3.621
</td>
<td style="text-align:right;">
5.789
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
5:C
</td>
<td style="text-align:right;">
5.416
</td>
<td style="text-align:right;">
0.553
</td>
<td style="text-align:right;">
4.332
</td>
<td style="text-align:right;">
6.499
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
6:A
</td>
<td style="text-align:right;">
-5.509
</td>
<td style="text-align:right;">
0.553
</td>
<td style="text-align:right;">
-6.593
</td>
<td style="text-align:right;">
-4.426
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
6:B
</td>
<td style="text-align:right;">
-16.550
</td>
<td style="text-align:right;">
0.553
</td>
<td style="text-align:right;">
-17.634
</td>
<td style="text-align:right;">
-15.467
</td>
</tr>
<tr>
<td style="text-align:left;">
Worker:Machine
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
6:C
</td>
<td style="text-align:right;">
-4.931
</td>
<td style="text-align:right;">
0.553
</td>
<td style="text-align:right;">
-6.014
</td>
<td style="text-align:right;">
-3.847
</td>
</tr>
</tbody>
</table>
</div>
<p>Even the default way that the extracted random effects are structured implies this difference. In the vector-valued model we have a multivariate normal draw for 3 machines (i.e. 3 variances and 3 covariances) for each of six workers. In the baseline model, we do not estimate any covariances and assume equal variance to draw for 18 groups (1 variance).</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
ranef(model_m_vv)</code></pre>
<pre><code>
$Worker
    MachineA    MachineB   MachineC
1  0.3121470   2.5531279  0.9302595
2  0.1833294  -0.8032619 -4.2820004
3  6.9694168   7.7792265  4.4740418
4 -1.0238949   2.3283434 -1.4146891
5 -0.8487803   4.7258593  5.3227211
6 -5.5922179 -16.5832953 -5.0303328

with conditional variances for &quot;Worker&quot; </code></pre>
<pre class="r"><code>
ranef(model_base_wm)</code></pre>
<pre><code>
$`Worker:Machine`
    (Intercept)
1:A   0.2754687
1:B   2.5563491
1:C   0.9200653
2:A   0.2093562
2:B  -0.7492747
2:C  -4.4019891
3:A   7.1181101
3:B   7.6470099
3:C   4.4901391
4:A  -1.1128934
4:B   2.3910679
4:C  -1.4930401
5:A  -0.9806684
5:B   4.7050047
5:C   5.4157138
6:A  -5.5093731
6:B -16.5501569
6:C  -4.9308890

with conditional variances for &quot;Worker:Machine&quot; </code></pre>
</div>
<p>Now let’s compare the models directly via AIC. As we would expect if we dummy coded a predictor vs. running a model without the intercept (e.g. <code>lm(score ~ machine)</code>, vs. <code>lm(score ~ -1 + machine)</code>), the random slope model and vector-valued models are identical and produce the same AIC. Likewise the intercept variance of the former is equal to the first group variance of the vector-valued model.</p>
<div class="layout-chunk" data-layout="l-body">
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;">
model_base_w
</th>
<th style="text-align:right;">
model_base_wm
</th>
<th style="text-align:right;">
model_m_slope
</th>
<th style="text-align:right;">
model_m_vv
</th>
<th style="text-align:right;">
model_w_wm
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
296.878
</td>
<td style="text-align:right;">
231.256
</td>
<td style="text-align:right;">
228.311
</td>
<td style="text-align:right;">
228.311
</td>
<td style="text-align:right;">
227.688
</td>
</tr>
</tbody>
</table>
</div>
<p>While such a model is doing better than either of our baseline models, it turns out that our other approach is slightly better, as the additional complexity of estimating the covariances and separate variances wasn’t really worth it.</p>
<p>At this point we’ve seen a couple of ways of doing a model in this situation. Some may be a little too simplistic for a given scenario, others may not capture the correlation structure the way we’d want. In any case, we have options to explore.</p>
<!-- https://github.com/m-clark/Visuals/tree/master/random_effects -->
<h2 id="simulation">Simulation</h2>
<p>The following is a simplified approach to creating data in this scenario, and allows us to play around with the settings to see what happens.</p>
<h3 id="data-creation">Data Creation</h3>
<p>First we need some data. The following creates a group identifier similar to <code>Worker</code> in our previous example, a <code>cat_var</code> like our <code>Machine</code>, and other covariates just to make it interesting.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
# for simplicity keeping to 3 cat levels
set.seed(1234)
ng = 5000     # n groups
cat_levs = 3  # n levels per group
reps = 4      # number of obs per level per cat

id = rep(1:ng, each = cat_levs * reps)           # id indicator (e.g. like Worker)
cat_var = rep(1:cat_levs, times = ng, e = reps)  # categorical variable (e.g. Machine)
x = rnorm(ng * cat_levs * reps)                  # continuous covariate
x_c = rep(rnorm(ng), e = cat_levs * reps)        # continuous cluster level covariate</code></pre>
</div>
<p>So we have the basic data in place, now we need to create the random effects. There are several ways we could do this, including more efficient ones, but this approach focuses on a conceptual approach and on the model that got us here, i.e. something of the form <code>(1 + cat_var | group)</code>. In this case we assume this model is ‘correct’, so we’re going to create a multivariate normal draw of random effects for each level of the <code>cat_var</code>, which is only 3 levels. The correlations depicted are the estimates we expect from our model for the random effects<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
# as correlated  (1, .5, .5) var, (1, .25, .25) sd 
cov_mat = lazerhawk::create_corr(c(.1, .25, .25), diagonal = c(1, .5, .5))

cov2cor(cov_mat)  # these will be the estimated correlations for the random_slope model</code></pre>
<pre><code>
          [,1]      [,2]      [,3]
[1,] 1.0000000 0.1414214 0.3535534
[2,] 0.1414214 1.0000000 0.5000000
[3,] 0.3535534 0.5000000 1.0000000</code></pre>
</div>
<p>Now we create the random effects by drawing an effect for each categorical level for each group.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
# take a multivariate normal draw for each of the groups in `id`
re_id_cat_lev = mvtnorm::rmvnorm(ng, mean = rep(0, 3), sigma = cov_mat) %&gt;% 
  data.frame()

head(re_id_cat_lev)</code></pre>
<pre><code>
          X1          X2          X3
1  0.5618465  0.62780841  1.15175459
2  0.6588685  0.78045939  0.25942427
3  0.2680315 -0.06403496  1.30173301
4 -0.3711184  0.37579392 -0.03242486
5 -1.1306064 -0.08450038 -0.38165685
6 -0.7537223  0.65320469  0.33269260</code></pre>
</div>
<p>Now that we have the random effects, we can create our target variable. We do this by adding our first effect to the intercept, and the others to their respective coefficients.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
y = 
  # fixed effect = (2, .5, -.5)
  2  + .5*x - .5*x_c +   
  # random intercept
  rep(re_id_cat_lev[, 1], each = cat_levs * reps) +                           
  # .25 is the fixef for group 2 vs. 1
  (.25 + rep(re_id_cat_lev[, 2], each = cat_levs * reps)) * (cat_var == 2) +  
  # .40 is the fixef for group 3 vs. 1
  (.40 + rep(re_id_cat_lev[, 3], each = cat_levs * reps)) * (cat_var == 3) +  
  rnorm(ng * cat_levs * reps, sd = .5)</code></pre>
</div>
<p>Now we create a data frame so we can see everything together.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
df = tibble(
    id,
    cat_var,
    x,
    x_c,
    y,
    re_id = rep(re_id_cat_lev[, 1], each = cat_levs*reps),
    re_id_cat_lev2 = rep(re_id_cat_lev[, 2], each = cat_levs*reps),
    re_id_cat_lev3 = rep(re_id_cat_lev[, 3], each = cat_levs*reps)
  ) %&gt;% 
  mutate(
    cat_var = factor(cat_var),
    cat_as_num = as.integer(cat_var),
    id = factor(id)
  )

df %&gt;% print(n = 30)</code></pre>
<pre><code>
# A tibble: 60,000 x 9
   id    cat_var       x    x_c     y re_id re_id_cat_lev2 re_id_cat_lev3 cat_as_num
   &lt;fct&gt; &lt;fct&gt;     &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;          &lt;dbl&gt;          &lt;dbl&gt;      &lt;int&gt;
 1 1     1       -1.21   -1.43  3.04  0.562         0.628           1.15           1
 2 1     1        0.277  -1.43  3.35  0.562         0.628           1.15           1
 3 1     1        1.08   -1.43  3.46  0.562         0.628           1.15           1
 4 1     1       -2.35   -1.43  2.64  0.562         0.628           1.15           1
 5 1     2        0.429  -1.43  4.59  0.562         0.628           1.15           2
 6 1     2        0.506  -1.43  3.61  0.562         0.628           1.15           2
 7 1     2       -0.575  -1.43  3.54  0.562         0.628           1.15           2
 8 1     2       -0.547  -1.43  2.98  0.562         0.628           1.15           2
 9 1     3       -0.564  -1.43  5.28  0.562         0.628           1.15           3
10 1     3       -0.890  -1.43  4.06  0.562         0.628           1.15           3
11 1     3       -0.477  -1.43  4.31  0.562         0.628           1.15           3
12 1     3       -0.998  -1.43  4.70  0.562         0.628           1.15           3
13 2     1       -0.776   0.126 2.25  0.659         0.780           0.259          1
14 2     1        0.0645  0.126 2.48  0.659         0.780           0.259          1
15 2     1        0.959   0.126 2.99  0.659         0.780           0.259          1
16 2     1       -0.110   0.126 2.55  0.659         0.780           0.259          1
17 2     2       -0.511   0.126 3.94  0.659         0.780           0.259          2
18 2     2       -0.911   0.126 3.22  0.659         0.780           0.259          2
19 2     2       -0.837   0.126 3.98  0.659         0.780           0.259          2
20 2     2        2.42    0.126 4.59  0.659         0.780           0.259          2
21 2     3        0.134   0.126 3.58  0.659         0.780           0.259          3
22 2     3       -0.491   0.126 3.31  0.659         0.780           0.259          3
23 2     3       -0.441   0.126 2.66  0.659         0.780           0.259          3
24 2     3        0.460   0.126 3.42  0.659         0.780           0.259          3
25 3     1       -0.694   0.437 0.985 0.268        -0.0640          1.30           1
26 3     1       -1.45    0.437 2.08  0.268        -0.0640          1.30           1
27 3     1        0.575   0.437 2.62  0.268        -0.0640          1.30           1
28 3     1       -1.02    0.437 1.24  0.268        -0.0640          1.30           1
29 3     2       -0.0151  0.437 2.24  0.268        -0.0640          1.30           2
30 3     2       -0.936   0.437 2.57  0.268        -0.0640          1.30           2
# … with 5.997e+04 more rows</code></pre>
</div>
<h3 id="run-the-models-summarize">Run the Models &amp; Summarize</h3>
<p>With everything in place, let’s run four models similar to our previous models from the Machine example:</p>
<ol type="1">
<li>The baseline model that does not distinguish the id from cat_var variance.</li>
<li>The random slope approach (data generating model)</li>
<li>The vector valued model (equivalent to #2)</li>
<li>The scalar model that does not estimate the random effect correlations</li>
</ol>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
m_interaction_only = lmer(y ~ x + x_c + cat_var + (1 | id:cat_var), df)
m_random_slope = lmer(y ~ x + x_c + cat_var + (1 + cat_var | id), df)    
m_vector_valued = lmer(y ~ x + x_c + cat_var + (0 + cat_var | id), df)
m_separate_re = lmer(y ~ x + x_c + cat_var + (1 | id) + (1 | id:cat_var), df)</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
model_mixed = list(
  m_interaction_only = m_interaction_only,
  m_random_slope = m_random_slope,
  m_vector_valued = m_vector_valued,
  m_separate_re = m_separate_re
)

# model summaries if desired
# map(model_mixed, summarize_model, ci = 0, cor_re = TRUE)
fe = map_df(model_mixed, extract_fixed_effects, .id = &#39;model&#39;) 
vc = map_df(model_mixed, extract_vc, ci_level = 0, .id = &#39;model&#39;)</code></pre>
</div>
<p>Looking at the fixed effects, we get what we should but, as before, we do see differences in the standard errors.</p>
<div class="layout-chunk" data-layout="l-body">
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
model
</th>
<th style="text-align:left;">
term
</th>
<th style="text-align:right;">
value
</th>
<th style="text-align:right;">
se
</th>
<th style="text-align:right;">
t
</th>
<th style="text-align:right;">
p_value
</th>
<th style="text-align:right;">
lower_2.5
</th>
<th style="text-align:right;">
upper_97.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
m_interaction_only
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:right;">
2.006
</td>
<td style="text-align:right;">
0.018
</td>
<td style="text-align:right;">
111.051
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.971
</td>
<td style="text-align:right;">
2.042
</td>
</tr>
<tr>
<td style="text-align:left;">
m_interaction_only
</td>
<td style="text-align:left;">
x
</td>
<td style="text-align:right;">
0.497
</td>
<td style="text-align:right;">
0.002
</td>
<td style="text-align:right;">
212.962
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.492
</td>
<td style="text-align:right;">
0.501
</td>
</tr>
<tr>
<td style="text-align:left;">
m_interaction_only
</td>
<td style="text-align:left;">
x_c
</td>
<td style="text-align:right;">
-0.489
</td>
<td style="text-align:right;">
0.010
</td>
<td style="text-align:right;">
-46.776
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
-0.509
</td>
<td style="text-align:right;">
-0.469
</td>
</tr>
<tr>
<td style="text-align:left;">
m_interaction_only
</td>
<td style="text-align:left;">
cat_var2
</td>
<td style="text-align:right;">
0.256
</td>
<td style="text-align:right;">
0.026
</td>
<td style="text-align:right;">
10.026
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.206
</td>
<td style="text-align:right;">
0.306
</td>
</tr>
<tr>
<td style="text-align:left;">
m_interaction_only
</td>
<td style="text-align:left;">
cat_var3
</td>
<td style="text-align:right;">
0.389
</td>
<td style="text-align:right;">
0.026
</td>
<td style="text-align:right;">
15.228
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.339
</td>
<td style="text-align:right;">
0.439
</td>
</tr>
<tr>
<td style="text-align:left;">
m_random_slope
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:right;">
2.006
</td>
<td style="text-align:right;">
0.015
</td>
<td style="text-align:right;">
136.942
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.977
</td>
<td style="text-align:right;">
2.035
</td>
</tr>
<tr>
<td style="text-align:left;">
m_random_slope
</td>
<td style="text-align:left;">
x
</td>
<td style="text-align:right;">
0.497
</td>
<td style="text-align:right;">
0.002
</td>
<td style="text-align:right;">
217.676
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.493
</td>
<td style="text-align:right;">
0.502
</td>
</tr>
<tr>
<td style="text-align:left;">
m_random_slope
</td>
<td style="text-align:left;">
x_c
</td>
<td style="text-align:right;">
-0.495
</td>
<td style="text-align:right;">
0.014
</td>
<td style="text-align:right;">
-34.636
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
-0.523
</td>
<td style="text-align:right;">
-0.467
</td>
</tr>
<tr>
<td style="text-align:left;">
m_random_slope
</td>
<td style="text-align:left;">
cat_var2
</td>
<td style="text-align:right;">
0.256
</td>
<td style="text-align:right;">
0.011
</td>
<td style="text-align:right;">
23.038
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.234
</td>
<td style="text-align:right;">
0.278
</td>
</tr>
<tr>
<td style="text-align:left;">
m_random_slope
</td>
<td style="text-align:left;">
cat_var3
</td>
<td style="text-align:right;">
0.389
</td>
<td style="text-align:right;">
0.011
</td>
<td style="text-align:right;">
34.969
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.367
</td>
<td style="text-align:right;">
0.411
</td>
</tr>
<tr>
<td style="text-align:left;">
m_vector_valued
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:right;">
2.006
</td>
<td style="text-align:right;">
0.015
</td>
<td style="text-align:right;">
136.944
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.977
</td>
<td style="text-align:right;">
2.035
</td>
</tr>
<tr>
<td style="text-align:left;">
m_vector_valued
</td>
<td style="text-align:left;">
x
</td>
<td style="text-align:right;">
0.497
</td>
<td style="text-align:right;">
0.002
</td>
<td style="text-align:right;">
217.676
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.493
</td>
<td style="text-align:right;">
0.502
</td>
</tr>
<tr>
<td style="text-align:left;">
m_vector_valued
</td>
<td style="text-align:left;">
x_c
</td>
<td style="text-align:right;">
-0.495
</td>
<td style="text-align:right;">
0.014
</td>
<td style="text-align:right;">
-34.636
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
-0.523
</td>
<td style="text-align:right;">
-0.467
</td>
</tr>
<tr>
<td style="text-align:left;">
m_vector_valued
</td>
<td style="text-align:left;">
cat_var2
</td>
<td style="text-align:right;">
0.256
</td>
<td style="text-align:right;">
0.011
</td>
<td style="text-align:right;">
23.038
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.234
</td>
<td style="text-align:right;">
0.278
</td>
</tr>
<tr>
<td style="text-align:left;">
m_vector_valued
</td>
<td style="text-align:left;">
cat_var3
</td>
<td style="text-align:right;">
0.389
</td>
<td style="text-align:right;">
0.011
</td>
<td style="text-align:right;">
34.969
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.367
</td>
<td style="text-align:right;">
0.411
</td>
</tr>
<tr>
<td style="text-align:left;">
m_separate_re
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:right;">
2.006
</td>
<td style="text-align:right;">
0.018
</td>
<td style="text-align:right;">
111.045
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.971
</td>
<td style="text-align:right;">
2.042
</td>
</tr>
<tr>
<td style="text-align:left;">
m_separate_re
</td>
<td style="text-align:left;">
x
</td>
<td style="text-align:right;">
0.497
</td>
<td style="text-align:right;">
0.002
</td>
<td style="text-align:right;">
216.586
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.493
</td>
<td style="text-align:right;">
0.502
</td>
</tr>
<tr>
<td style="text-align:left;">
m_separate_re
</td>
<td style="text-align:left;">
x_c
</td>
<td style="text-align:right;">
-0.489
</td>
<td style="text-align:right;">
0.017
</td>
<td style="text-align:right;">
-28.883
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
-0.522
</td>
<td style="text-align:right;">
-0.456
</td>
</tr>
<tr>
<td style="text-align:left;">
m_separate_re
</td>
<td style="text-align:left;">
cat_var2
</td>
<td style="text-align:right;">
0.256
</td>
<td style="text-align:right;">
0.011
</td>
<td style="text-align:right;">
23.077
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.234
</td>
<td style="text-align:right;">
0.278
</td>
</tr>
<tr>
<td style="text-align:left;">
m_separate_re
</td>
<td style="text-align:left;">
cat_var3
</td>
<td style="text-align:right;">
0.389
</td>
<td style="text-align:right;">
0.011
</td>
<td style="text-align:right;">
35.050
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.367
</td>
<td style="text-align:right;">
0.411
</td>
</tr>
</tbody>
</table>
</div>
<p>The variance components break down as before.</p>
<div class="layout-chunk" data-layout="l-body">
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
model
</th>
<th style="text-align:left;">
group
</th>
<th style="text-align:left;">
effect
</th>
<th style="text-align:right;">
variance
</th>
<th style="text-align:right;">
sd
</th>
<th style="text-align:right;">
var_prop
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
m_interaction_only
</td>
<td style="text-align:left;">
id:cat_var
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:right;">
1.570
</td>
<td style="text-align:right;">
1.253
</td>
<td style="text-align:right;">
0.864
</td>
</tr>
<tr>
<td style="text-align:left;">
m_interaction_only
</td>
<td style="text-align:left;">
Residual
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
0.247
</td>
<td style="text-align:right;">
0.497
</td>
<td style="text-align:right;">
0.136
</td>
</tr>
<tr>
<td style="text-align:left;">
m_random_slope
</td>
<td style="text-align:left;">
id
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:right;">
1.011
</td>
<td style="text-align:right;">
1.006
</td>
<td style="text-align:right;">
0.450
</td>
</tr>
<tr>
<td style="text-align:left;">
m_random_slope
</td>
<td style="text-align:left;">
id
</td>
<td style="text-align:left;">
cat_var2
</td>
<td style="text-align:right;">
0.494
</td>
<td style="text-align:right;">
0.703
</td>
<td style="text-align:right;">
0.220
</td>
</tr>
<tr>
<td style="text-align:left;">
m_random_slope
</td>
<td style="text-align:left;">
id
</td>
<td style="text-align:left;">
cat_var3
</td>
<td style="text-align:right;">
0.495
</td>
<td style="text-align:right;">
0.704
</td>
<td style="text-align:right;">
0.220
</td>
</tr>
<tr>
<td style="text-align:left;">
m_random_slope
</td>
<td style="text-align:left;">
Residual
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
0.247
</td>
<td style="text-align:right;">
0.497
</td>
<td style="text-align:right;">
0.110
</td>
</tr>
<tr>
<td style="text-align:left;">
m_vector_valued
</td>
<td style="text-align:left;">
id
</td>
<td style="text-align:left;">
cat_var1
</td>
<td style="text-align:right;">
1.011
</td>
<td style="text-align:right;">
1.006
</td>
<td style="text-align:right;">
0.204
</td>
</tr>
<tr>
<td style="text-align:left;">
m_vector_valued
</td>
<td style="text-align:left;">
id
</td>
<td style="text-align:left;">
cat_var2
</td>
<td style="text-align:right;">
1.709
</td>
<td style="text-align:right;">
1.307
</td>
<td style="text-align:right;">
0.345
</td>
</tr>
<tr>
<td style="text-align:left;">
m_vector_valued
</td>
<td style="text-align:left;">
id
</td>
<td style="text-align:left;">
cat_var3
</td>
<td style="text-align:right;">
1.990
</td>
<td style="text-align:right;">
1.411
</td>
<td style="text-align:right;">
0.401
</td>
</tr>
<tr>
<td style="text-align:left;">
m_vector_valued
</td>
<td style="text-align:left;">
Residual
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
0.247
</td>
<td style="text-align:right;">
0.497
</td>
<td style="text-align:right;">
0.050
</td>
</tr>
<tr>
<td style="text-align:left;">
m_separate_re
</td>
<td style="text-align:left;">
id:cat_var
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:right;">
0.246
</td>
<td style="text-align:right;">
0.496
</td>
<td style="text-align:right;">
0.135
</td>
</tr>
<tr>
<td style="text-align:left;">
m_separate_re
</td>
<td style="text-align:left;">
id
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:right;">
1.324
</td>
<td style="text-align:right;">
1.151
</td>
<td style="text-align:right;">
0.728
</td>
</tr>
<tr>
<td style="text-align:left;">
m_separate_re
</td>
<td style="text-align:left;">
Residual
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
0.247
</td>
<td style="text-align:right;">
0.497
</td>
<td style="text-align:right;">
0.136
</td>
</tr>
</tbody>
</table>
</div>
<p>In this case, we know the model with correlated random effects is the more accurate model, and this is born out via AIC.</p>
<div class="layout-chunk" data-layout="l-body">
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;">
m_interaction_only
</th>
<th style="text-align:right;">
m_random_slope
</th>
<th style="text-align:right;">
m_vector_valued
</th>
<th style="text-align:right;">
m_separate_re
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
135592.8
</td>
<td style="text-align:right;">
122051.9
</td>
<td style="text-align:right;">
122051.9
</td>
<td style="text-align:right;">
123745.2
</td>
</tr>
</tbody>
</table>
</div>
<h3 id="change-the-model-orientation">Change the model orientation</h3>
<p>Now I will make the <code>vector_valued</code> model reduce to the <code>separate_re</code> model. First, we create a covariance matrix that has equal variances/covariances (i.e. compound symmetry), and for demonstration, we will apply the random effects a little differently. So, when we create the target variable, we make a slight alteration to apply it to the vector valued model instead.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
set.seed(1234)

cov_mat = lazerhawk::create_corr(c(0.1, 0.1, 0.1), diagonal = c(.5, .5, .5))

cov2cor(cov_mat)  # these will now be the estimated correlations for the vector_valued model</code></pre>
<pre><code>
     [,1] [,2] [,3]
[1,]  1.0  0.2  0.2
[2,]  0.2  1.0  0.2
[3,]  0.2  0.2  1.0</code></pre>
<pre class="r"><code>
re_id_cat_lev = mvtnorm::rmvnorm(ng, mean = rep(0, 3), sigma = cov_mat) %&gt;% 
  data.frame()

y = 2  + .5*x - .5*x_c +   # fixed effect = (2, .5, -.5)
  rep(re_id_cat_lev[, 1], each = cat_levs * reps) * (cat_var == 1) +     # added this
  rep(re_id_cat_lev[, 2], each = cat_levs * reps) * (cat_var == 2) +
  rep(re_id_cat_lev[, 3], each = cat_levs * reps) * (cat_var == 3) +
  .25 * (cat_var == 2) +  # .25 is the fixef for group 2 vs. 1
  .40 * (cat_var == 3) +  # .40 is the fixef for group 3 vs. 1
  rnorm(ng * cat_levs * reps, sd = .5)


df = tibble(
    id,
    cat_var  = factor(cat_var),
    x,
    x_c,
    y
  )</code></pre>
</div>
<p>Rerun the models.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
m_random_slope = lmer(y ~ x + x_c + cat_var + (1 + cat_var | id), df)  # still problems!
m_vector_valued = lmer(y ~ x + x_c + cat_var + (0 + cat_var | id), df)   
m_separate_re = lmer(y ~ x + x_c + cat_var + (1 | id) + (1 | id:cat_var), df)</code></pre>
</div>
<p>Examine the variance components.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
model_mixed = list(
  m_random_slope = m_random_slope,
  m_vector_valued = m_vector_valued,
  m_separate_re = m_separate_re
)

# model summaries if desired
# map(model_mixed, summarize_model, ci = 0, cor_re = TRUE)

# fixed effects if desired
# fe = map_df(model_mixed, extract_fixed_effects, .id = &#39;model&#39;)

vc = map_df(model_mixed, extract_vc, ci_level = 0, .id = &#39;model&#39;)</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
model
</th>
<th style="text-align:left;">
group
</th>
<th style="text-align:left;">
effect
</th>
<th style="text-align:right;">
variance
</th>
<th style="text-align:right;">
sd
</th>
<th style="text-align:right;">
var_prop
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
m_random_slope
</td>
<td style="text-align:left;">
id
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:right;">
0.491
</td>
<td style="text-align:right;">
0.700
</td>
<td style="text-align:right;">
0.213
</td>
</tr>
<tr>
<td style="text-align:left;">
m_random_slope
</td>
<td style="text-align:left;">
id
</td>
<td style="text-align:left;">
cat_var2
</td>
<td style="text-align:right;">
0.786
</td>
<td style="text-align:right;">
0.886
</td>
<td style="text-align:right;">
0.341
</td>
</tr>
<tr>
<td style="text-align:left;">
m_random_slope
</td>
<td style="text-align:left;">
id
</td>
<td style="text-align:left;">
cat_var3
</td>
<td style="text-align:right;">
0.778
</td>
<td style="text-align:right;">
0.882
</td>
<td style="text-align:right;">
0.337
</td>
</tr>
<tr>
<td style="text-align:left;">
m_random_slope
</td>
<td style="text-align:left;">
Residual
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
0.251
</td>
<td style="text-align:right;">
0.501
</td>
<td style="text-align:right;">
0.109
</td>
</tr>
<tr>
<td style="text-align:left;">
m_vector_valued
</td>
<td style="text-align:left;">
id
</td>
<td style="text-align:left;">
cat_var1
</td>
<td style="text-align:right;">
0.491
</td>
<td style="text-align:right;">
0.700
</td>
<td style="text-align:right;">
0.283
</td>
</tr>
<tr>
<td style="text-align:left;">
m_vector_valued
</td>
<td style="text-align:left;">
id
</td>
<td style="text-align:left;">
cat_var2
</td>
<td style="text-align:right;">
0.497
</td>
<td style="text-align:right;">
0.705
</td>
<td style="text-align:right;">
0.287
</td>
</tr>
<tr>
<td style="text-align:left;">
m_vector_valued
</td>
<td style="text-align:left;">
id
</td>
<td style="text-align:left;">
cat_var3
</td>
<td style="text-align:right;">
0.492
</td>
<td style="text-align:right;">
0.702
</td>
<td style="text-align:right;">
0.284
</td>
</tr>
<tr>
<td style="text-align:left;">
m_vector_valued
</td>
<td style="text-align:left;">
Residual
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
0.251
</td>
<td style="text-align:right;">
0.501
</td>
<td style="text-align:right;">
0.145
</td>
</tr>
<tr>
<td style="text-align:left;">
m_separate_re
</td>
<td style="text-align:left;">
id:cat_var
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:right;">
0.395
</td>
<td style="text-align:right;">
0.628
</td>
<td style="text-align:right;">
0.530
</td>
</tr>
<tr>
<td style="text-align:left;">
m_separate_re
</td>
<td style="text-align:left;">
id
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:right;">
0.099
</td>
<td style="text-align:right;">
0.314
</td>
<td style="text-align:right;">
0.133
</td>
</tr>
<tr>
<td style="text-align:left;">
m_separate_re
</td>
<td style="text-align:left;">
Residual
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
0.251
</td>
<td style="text-align:right;">
0.501
</td>
<td style="text-align:right;">
0.337
</td>
</tr>
</tbody>
</table>
</div>
<p>In this case, we know the true case regards zero correlations and equal variances, so estimating them is adding complexity we don’t need, thus our simpler model wins (log likelihoods are essentially the same).</p>
<div class="layout-chunk" data-layout="l-body">
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
parameter
</th>
<th style="text-align:right;">
m_random_slope
</th>
<th style="text-align:right;">
m_vector_valued
</th>
<th style="text-align:right;">
m_separate_re
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
LL
</td>
<td style="text-align:right;">
-59818.9
</td>
<td style="text-align:right;">
-59818.9
</td>
<td style="text-align:right;">
-59819.72
</td>
</tr>
<tr>
<td style="text-align:left;">
AIC
</td>
<td style="text-align:right;">
119661.8
</td>
<td style="text-align:right;">
119661.8
</td>
<td style="text-align:right;">
119655.45
</td>
</tr>
</tbody>
</table>
</div>
<h2 id="summary">Summary</h2>
<p>Here we’ve demonstrated a couple of different ways to specify a particular model with random slopes for a categorical covariate. Intuition may lead to a model that is not easy to estimate, often leading to convergence problems. Sometimes, this model may be overly complicated, and a simpler version will likely have less estimation difficulty. Try it out if you run into trouble!</p>
<section class="footnotes" role="doc-endnotes">
<hr />
<ol>
<li id="fn1" role="doc-endnote"><p>Though I use the word ‘within’, do not take it to mean we have nested data.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2" role="doc-endnote"><p>I use a personal package to create the matrix where I can just specify the lower diagonal, as this comes up a lot for simulation. Feel free to just create the matrix directly given it’s just a 3x3.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
<!--radix_placeholder_article_footer-->
<div class="article-footer">
  <p class="social_footer">
    <span class="article-sharing">
      Share: &nbsp;
      <a href="https://twitter.com/share?text=Categorical%20Effects%20as%20Random&amp;url=https%3A%2F%2Fm-clark.github.io%2Fposts%2F2020-03-01-random-categorical%2F">
        <i class="fab fa-twitter"></i>
      </a>
      <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fm-clark.github.io%2Fposts%2F2020-03-01-random-categorical%2F&amp;title=Categorical%20Effects%20as%20Random">
        <i class="fab fa-linkedin"></i>
      </a>
      <a href="https://www.facebook.com/sharer/sharer.php?s=100&amp;p[url]=https%3A%2F%2Fm-clark.github.io%2Fposts%2F2020-03-01-random-categorical%2F">
        <i class="fab fa-facebook"></i>
      </a>
    </span>
  </p>
</div>
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
  <h3 id="updates-and-corrections">Corrections</h3>
  <p>If you see mistakes or want to suggest changes, please <a href="https://github.com//m-clark/m-clark.github.io/issues/new">create an issue</a> on the source repository.</p>
  <h3 id="reuse">Reuse</h3>
  <p>Text and figures are licensed under Creative Commons Attribution <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a>. Source code is available at <a href="https://github.com//m-clark/m-clark.github.io">https://github.com//m-clark/m-clark.github.io</a>, unless otherwise noted. The figures that have been reused from other sources don't fall under this license and can be recognized by a note in their caption: "Figure from ...".</p>
  <h3 id="citation">Citation</h3>
  <p>For attribution, please cite this work as</p>
  <pre class="citation-appendix short">Clark (2020, March 1). Michael Clark: Categorical Effects as Random. Retrieved from https://m-clark.github.io/posts/2020-03-01-random-categorical/</pre>
  <p>BibTeX citation</p>
  <pre class="citation-appendix long">@misc{clark2020categorical,
  author = {Clark, Michael},
  title = {Michael Clark: Categorical Effects as Random},
  url = {https://m-clark.github.io/posts/2020-03-01-random-categorical/},
  year = {2020}
}</pre>
</div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<div class="distill-site-nav distill-site-footer">
  <div>


Michael Clark • 2021 •  <a href="https://m-clark.github.io">https://m-clark.github.io/</a>
</div>
</div>
<!--/radix_placeholder_navigation_after_body-->


</body>

</html>
