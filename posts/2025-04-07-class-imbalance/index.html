<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.33">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Michael Clark">
<meta name="dcterms.date" content="2025-04-07">
<meta name="description" content="Challenges and solutions for this common situation">

<title>Imbalanced Outcomes – Michael Clark</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-d1f6b35d3d184b33e56db6dc389785e2.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/quarto-contrib/social-share-1.0.0/social-share.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/social-share-1.0.0/all.min.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/fontawesome6-1.2.0/all.min.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/fontawesome6-1.2.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="floating nav-fixed slimcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../img/mc_logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Michael Clark</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/michael-clark-b475b5170/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/m-clark"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://bsky.app/profile/m-clark.bsky.social"> 
<span class="menu-text"><i class="fa-brands fa-bluesky" aria-label="bluesky"></i></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/statsdatasci"> <i class="bi bi-twitter-x" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../book.html"> 
<span class="menu-text">Models Demystified</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../documents.html"> 
<span class="menu-text">Content</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../code.html"> 
<span class="menu-text">Code</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Imbalanced Outcomes</h1>
                  <div>
        <div class="description">
          Challenges and solutions for this common situation
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">machine learning</div>
                <div class="quarto-category">regression</div>
                <div class="quarto-category">boosting</div>
              </div>
                  </div>
  </div>
    
  <div class="quarto-title-meta-author">
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-heading">Affiliation</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author"><a href="https://m-clark.github.io">Michael Clark</a> <a href="mailto:statsdatasci@gmail.com" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
    </div>
    <div class="quarto-title-meta-contents">
          <p class="affiliation">
              <a href="https://onesixsolutions.com">
              OneSix
              </a>
            </p>
        </div>
    </div>

  <div class="quarto-title-meta">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">April 7, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
  <li><a href="#goals" id="toc-goals" class="nav-link" data-scroll-target="#goals">Goals</a></li>
  </ul></li>
  <li><a href="#understanding-imbalanced-data" id="toc-understanding-imbalanced-data" class="nav-link" data-scroll-target="#understanding-imbalanced-data">Understanding Imbalanced Data</a>
  <ul class="collapse">
  <li><a href="#real-world-examples" id="toc-real-world-examples" class="nav-link" data-scroll-target="#real-world-examples">Real-world Examples</a></li>
  <li><a href="#is-imbalance-a-problem" id="toc-is-imbalance-a-problem" class="nav-link" data-scroll-target="#is-imbalance-a-problem">Is imbalance a problem?</a></li>
  </ul></li>
  <li><a href="#techniques-for-dealing-with-imbalanced-data" id="toc-techniques-for-dealing-with-imbalanced-data" class="nav-link" data-scroll-target="#techniques-for-dealing-with-imbalanced-data">Techniques for Dealing with Imbalanced Data</a>
  <ul class="collapse">
  <li><a href="#sampling-based-techniques" id="toc-sampling-based-techniques" class="nav-link" data-scroll-target="#sampling-based-techniques">Sampling-based Techniques</a></li>
  <li><a href="#algorithmic-techniques" id="toc-algorithmic-techniques" class="nav-link" data-scroll-target="#algorithmic-techniques">Algorithmic Techniques</a></li>
  <li><a href="#other-techniques" id="toc-other-techniques" class="nav-link" data-scroll-target="#other-techniques">Other Techniques</a></li>
  </ul></li>
  <li><a href="#performance-metrics-with-imbalanced-data" id="toc-performance-metrics-with-imbalanced-data" class="nav-link" data-scroll-target="#performance-metrics-with-imbalanced-data">Performance Metrics with Imbalanced Data</a>
  <ul class="collapse">
  <li><a href="#the-role-of-thresholds-in-balancing-trade-offs" id="toc-the-role-of-thresholds-in-balancing-trade-offs" class="nav-link" data-scroll-target="#the-role-of-thresholds-in-balancing-trade-offs">The Role of Thresholds in Balancing Trade-offs</a></li>
  <li><a href="#sec-confusion-matrix" id="toc-sec-confusion-matrix" class="nav-link" data-scroll-target="#sec-confusion-matrix">The Confusion Matrix</a></li>
  <li><a href="#sec-example-thresh-05" id="toc-sec-example-thresh-05" class="nav-link" data-scroll-target="#sec-example-thresh-05">Example: Classification with a .5 Threshold</a></li>
  <li><a href="#example-classification-with-a-lower-threshold" id="toc-example-classification-with-a-lower-threshold" class="nav-link" data-scroll-target="#example-classification-with-a-lower-threshold">Example: Classification with a Lower Threshold</a></li>
  </ul></li>
  <li><a href="#sec-case-study" id="toc-sec-case-study" class="nav-link" data-scroll-target="#sec-case-study">Case Study: Wine Quality Data</a>
  <ul class="collapse">
  <li><a href="#data-setup" id="toc-data-setup" class="nav-link" data-scroll-target="#data-setup">Data Setup</a></li>
  <li><a href="#models" id="toc-models" class="nav-link" data-scroll-target="#models">Models</a></li>
  <li><a href="#metrics" id="toc-metrics" class="nav-link" data-scroll-target="#metrics">Metrics</a></li>
  <li><a href="#logistic-model-results" id="toc-logistic-model-results" class="nav-link" data-scroll-target="#logistic-model-results">Logistic Model Results</a></li>
  <li><a href="#lgbm-model-results" id="toc-lgbm-model-results" class="nav-link" data-scroll-target="#lgbm-model-results">LGBM Model Results</a></li>
  </ul></li>
  <li><a href="#discussion" id="toc-discussion" class="nav-link" data-scroll-target="#discussion">Discussion</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  <li><a href="#sec-supplemental" id="toc-sec-supplemental" class="nav-link" data-scroll-target="#sec-supplemental">Supplemental</a>
  <ul class="collapse">
  <li><a href="#sec-supp-metrics" id="toc-sec-supp-metrics" class="nav-link" data-scroll-target="#sec-supp-metrics">Table Metrics</a></li>
  <li><a href="#sec-supp-multiclass" id="toc-sec-supp-multiclass" class="nav-link" data-scroll-target="#sec-supp-multiclass">Brief Discussion of the Multiclass Setting</a></li>
  <li><a href="#sec-supp-thresh" id="toc-sec-supp-thresh" class="nav-link" data-scroll-target="#sec-supp-thresh">Choosing a Classification Threshold</a></li>
  </ul></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content">





<blockquote class="blockquote">
<p>This post began around two years ago and was initially intended for the Strong Analytics blog, but for various reasons never came to fruition. We still thought the spirit of the content was valuable, so we did what we could to get it out one way or another. Both the intended audience and focus have changed over time, but hopefully the end result is cohesive enough to be useful to a wide audience. Much gratitude is owed to Elizabeth Li for her contributions to the initial drafts, and editorial help beyond.</p>
</blockquote>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Imagine you’re working on a fraud detection system for a bank. Out of millions of financial transactions, only a tiny fraction are fraudulent. This is a classic example of <em>class imbalance</em>, where one class we are trying to predict (fraudulent transactions) is much rarer than the other (legitimate transactions). Depending on your modeling approach, ignoring the imbalance can lead to the predictions missing most of the fraudulent transactions, as well as other issues we’d like to avoid. Here we’ll explore various issues regarding class imbalance, as well as techniques to address it. As we’ll see, the problem is nuanced and, very often, simple approaches to deal with it can work very well.</p>
<section id="goals" class="level3">
<h3 class="anchored" data-anchor-id="goals">Goals</h3>
<p>To guide our exploration, we have the following goals:</p>
<ul>
<li>Explain class imbalance generally</li>
<li>Review examples and consequences of class imbalance</li>
<li>Cover some common techniques for addressing the problem</li>
<li>Investigate the effects of classification thresholds on performance metrics</li>
<li>Explore a Case Study to see these concepts in action</li>
</ul>
<p>By the end, you should have a good understanding of the challenges posed by imbalanced data, and how to address them in your own work.</p>
</section>
</section>
<section id="understanding-imbalanced-data" class="level2">
<h2 class="anchored" data-anchor-id="understanding-imbalanced-data">Understanding Imbalanced Data</h2>
<p>The basic idea underpinning class imbalance is that one class is significantly less prevalent than the other, and this can happen for a variety of reasons, including the inherent nature of the data, or something about the way it was collected. For simplicity, we focus on the binary case, as it’s easier to get an intuitive understanding of what ‘imbalance’ would mean in that setting. However, the concepts discussed here can extend to multiclass settings also. Check out the <a href="#sec-supp-multiclass">supplemental section</a> for a brief overview of the multiclass case.</p>
<p>In a typical classification task, we would use a default threshold of 0.5 to classify predicted probabilities into binary outcomes, with anything above the threshold going to one class and the rest to the other class. This approach works well when the classes are balanced or nearly so, but it can fail in imbalanced settings where the minority class is underrepresented. For example, if less than 1% of the target data belongs to the minority class, a model trained without accounting for this imbalance may struggle to identify minority class instances effectively, if at all, and fall short for the task at hand.</p>
<section id="real-world-examples" class="level3">
<h3 class="anchored" data-anchor-id="real-world-examples">Real-world Examples</h3>
<p>Class imbalance is common in many real-world scenarios, such as:</p>
<ul>
<li>Fraud detection: As in our opening example, the vast majority of transactions are legitimate, but a small percentage are fraudulent.</li>
<li>Click-through rate: Most users on a website do not click on ads, but a small percentage do.</li>
<li>Disease detection: Consider classifying medical images for a rare disease. The vast majority of images may represent normal tissue, while only a small fraction show signs of the disease.</li>
<li>Spam detection: In email datasets, the majority of emails are legitimate (non-spam), while only a small fraction are spam emails.</li>
</ul>
<p>As one can see, it’s quite common and natural to have imbalanced data in many real-world applications. So how does it affect our modeling?</p>
</section>
<section id="is-imbalance-a-problem" class="level3">
<h3 class="anchored" data-anchor-id="is-imbalance-a-problem">Is imbalance a problem?</h3>
<p>Is imbalance a problem? Well, not exactly, at least not inherently. The real challenge often arises from its implications, such as the sample size (of the minority class), model limitations, and the metrics we use to evaluate the model.</p>
<p>For example, let’s say you had 10 million observations and 1% of them were in the minority class. Despite the imbalanced classes, you would likely have enough to work with to discover the feature-target relationships, and obtain good estimates of a variety of metrics even after test and validation splits. But with a smaller total sample or even rarer class prevalence, the problems of imbalance can be exacerbated due to the lack of data to work with, making it difficult to learn meaningful patterns or evaluate the model reliably.</p>
<p>In other cases, our model may not produce good predictions for the minority class, even if we have enough data. Maybe the model is not well suited to the problem, or the features aren’t strong enough to make good classifications. In this case, even if your data was balanced you’d potentially still have poor performance, and it will likely be worse with imbalance.</p>
<p>And finally, some metrics, even common ones such as accuracy, can be deceptive in the imbalanced setting. As an example, they may reflect the majority class performance while ignoring the minority class.</p>
<p>Addressing these challenges requires a thoughtful modeling approach and use of performance metrics, which we will explore in the following sections.</p>
</section>
</section>
<section id="techniques-for-dealing-with-imbalanced-data" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="techniques-for-dealing-with-imbalanced-data">Techniques for Dealing with Imbalanced Data</h2>
<p>There are a number of techniques one can use for handling imbalanced data to help meet modeling goals. Here, we will discuss a few commonly used methods, categorized into sampling-based techniques, algorithmic adjustments, and specialized approaches. Then we’ll see some in action later with our case study.</p>
<section id="sampling-based-techniques" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="sampling-based-techniques">Sampling-based Techniques</h3>
<p>Sampling-based techniques involve modifying the original dataset to balance the class distribution. These techniques can be broadly grouped into oversampling, undersampling, and hybrid sampling.</p>
<section id="oversampling" class="level4 page-columns page-full">
<h4 class="anchored" data-anchor-id="oversampling">Oversampling</h4>
<p><em>Oversampling</em> is a technique where we increase the number of observations in the minority class. Most commonly this is done by duplicating observations in the minority class or by generating synthetic observations.</p>
<p><em>Random over-sampling</em> (ROS) is akin to a bootstrap approach where we duplicate observations by sampling with replacement from the minority class, and this in turn increases the total number of observations. This is the simplest oversampling approach, and is often enough to potentially improve model performance on metrics that may be of interest. Other more complicated oversampling techniques could be used, but in practice are rarely going to do much better. However, while effective, oversampling can lead to overfitting, as the model may learn to memorize the duplicated observations rather than generalize from them.</p>
<p>There are also several methods for generating synthetic observations. Popular techniques include <em>SMOTE</em> (Synthetic Minority Over-sampling Technique), along with SMOTE variants such as Borderline-SMOTE and <em>ADASYN</em> (Adaptive Synthetic Sampling). SMOTE generates synthetic observations by creating interpolations of nearest neighbors of the minority class observations. It can be useful if using a ‘weak learner’ for the model (e.g.&nbsp;a simple logistic regression), but generally does not lead to improvement for modeling techniques common in machine learning, such as tree-based methods.</p>

<div class="no-row-height column-margin column-container"><div class="">
<p>A good package for implementing these techniques is the <code>imbalanced-learn</code> package in Python. The package is well-documented and easy to use, and is a good starting point for practitioners.</p>
</div></div></section>
<section id="undersampling" class="level4">
<h4 class="anchored" data-anchor-id="undersampling">Undersampling</h4>
<p>In contrast to oversampling, <em>undersampling</em> takes the opposite approach, reducing the number of observations in the majority class to make the target more balanced.</p>
<p><em>Random under-sampling</em> (RUS) is a technique where we decrease the number of observations in the majority class by randomly selecting observations in the majority class to remove. The goal is again to create a more balanced dataset. While it can be effective in that regard, it can also lead to loss of important information, especially if the sample size is not very large to begin with.</p>
<p>Other techniques look at nearest neighbors of the majority class, i.e.&nbsp;observations that are very similar, and remove some of them assuming they are not adding useful information. Variations include approaches, e.g., <em>NearMiss</em>, that are similar to ‘matched samples’ techniques long employed in statistical settings.</p>
</section>
<section id="hybrid-sampling" class="level4">
<h4 class="anchored" data-anchor-id="hybrid-sampling">Hybrid Sampling</h4>
<p>Hybrid sampling is a technique where we combine oversampling and undersampling to create a (more) balanced dataset. This is often done by oversampling the minority class and undersampling the majority class, and as before this could be done in a random fashion. An alternative hybrid sampling approach could also involve removing some observations from both classes that would be nearest neighbors (<em>TOMEK</em> links), which would hopefully improve the model’s ability to classify the observations among those that remain, as they are more clearly delineated among the features.</p>
</section>
</section>
<section id="algorithmic-techniques" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="algorithmic-techniques">Algorithmic Techniques</h3>
<p>We use the term ‘algorithmic techniques’ to refer to those that involve adjusting some aspect of the model estimation. Unlike sampling-based techniques, we do not manipulate the data directly.</p>
<section id="weighting" class="level4 page-columns page-full">
<h4 class="anchored" data-anchor-id="weighting">Weighting</h4>
<p>In some modeling contexts, we can adjust the importance of each example to handle the imbalance. The loss function is adjusted so that losses from the minority class contribute more than losses from the majority class. This is often done in the context of <em>cost-sensitive learning</em>, where the cost of misclassifying an observation in the minority class is higher than the cost of misclassifying an observation in the majority class.</p>

<div class="no-row-height column-margin column-container"><div class="">
<p>For some models, like logistic regression, weighting would essentially be equivalent to what is done with simple resampling techniques, negating the need to employ the latter. For example, doubling the weight of an observation would be equivalent to having two copies of the observation in the dataset. However, for other models, like tree-based methods, weighting and resampling are not equivalent. For example, in a random forest, resampling changes the composition of the bootstrap samples used to build the trees, while weighting changes the importance of each observation in the calculation of splits within each tree. As such, the difference in how the data is used can lead to different model behaviors and outcomes.</p>
</div></div></section>
<section id="thresholding" class="level4">
<h4 class="anchored" data-anchor-id="thresholding">Thresholding</h4>
<p>Thresholding regards changing the classification cutoff to account for the imbalance in the data. The default threshold of 0.5 is an intuitive choice (<span class="citation" data-cites="van_den_goorbergh_harm_2022">Goorbergh et al. (<a href="#ref-van_den_goorbergh_harm_2022" role="doc-biblioref">2022</a>)</span>), but is often not effective for imbalanced data. When modifying the threshold, we can use a lower threshold to potentially increase the number of positive classifications, or raise it to ensure we are only classifying the most confident observations as positive.</p>
<p>Identifying an optimal threshold can significantly improve certain metrics we may be interested in, especially when we want to avoid certain types of errors. And though this is a simple approach, it can actually be quite effective at achieving our goals in the context of imbalanced data, and there are a number of different techniques that can be used to identify the optimal threshold for our modeling purposes. Some of these are outlined in the <a href="#sec-supp-thresh">supplemental section</a>.</p>
</section>
</section>
<section id="other-techniques" class="level3">
<h3 class="anchored" data-anchor-id="other-techniques">Other Techniques</h3>
<p>You can find other techniques that are used to handle imbalanced data for specific model settings. For example, in uplift modeling, the goal is to predict the difference in outcomes between two groups, and the data is often imbalanced. Some will use a <em>class variable transformation</em> to predict differences in outcomes between treatment and control groups.</p>
<p>In addition, some approaches have been used in the context of deep learning models. For example, some focus on using different loss functions like <em>focal loss</em> (<span class="citation" data-cites="lin_focal_2018">Lin et al. (<a href="#ref-lin_focal_2018" role="doc-biblioref">2018</a>)</span>) and <em>label smoothing</em>. Others try different optimization approaches like <em>sharpness-aware minimization</em> (SAM, see <span class="citation" data-cites="foret_sharpness-aware_2021">Foret et al. (<a href="#ref-foret_sharpness-aware_2021" role="doc-biblioref">2021</a>)</span>), data augmentation, and more<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. At this time, it’s still difficult to know in advance whether deep learning models and associated methods for imbalance will work well for a typical tabular data setting, but they may be worth trying if you have the time and resources, and especially if your data is homogenous in nature<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>. In general, you may need to try a few different approaches to see what works best for your data and your model.</p>
</section>
</section>
<section id="performance-metrics-with-imbalanced-data" class="level2">
<h2 class="anchored" data-anchor-id="performance-metrics-with-imbalanced-data">Performance Metrics with Imbalanced Data</h2>
<p>When evaluating classification models, performance metrics are essential for understanding how well a model is performing and for identifying areas for improvement. However, in the context of imbalanced data, these metrics can be misleading if not used with care. This is because many metrics are sensitive to the classification threshold, so it’s important to consider how thresholds impact both classifications and the metrics derived from them.</p>
<section id="the-role-of-thresholds-in-balancing-trade-offs" class="level3">
<h3 class="anchored" data-anchor-id="the-role-of-thresholds-in-balancing-trade-offs">The Role of Thresholds in Balancing Trade-offs</h3>
<p>As noted previously, when creating a classification label, we use a threshold, or cutoff point, to determine which class to assign to the observation based on predicted probability for that observation. Anything beyond the threshold is classified as the positive class, and anything below is classified as the negative class. So, the choice of threshold directly affects the resulting classifications, and the performance metrics derived from them.</p>
<p>It’s important to note that there is not an inherently right or wrong choice here. For example:</p>
<ul>
<li>A lower threshold, which would lead to more positive classifications, may be appropriate when missing positive cases (false negatives) is costly, such as in disease detection<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>.</li>
<li>A higher threshold, leading to fewer positive classifications, may be better when false positives are more problematic, such as in fraud detection.</li>
</ul>
<p>The impact of thresholds highlights the trade-offs inherent in classification tasks, and selecting a threshold that aligns with the specific goals and constraints of your application is critical. Now let’s take a closer look at how thresholds can affect performance metrics. If you feel you already have the gist, you can skip ahead to the <a href="#sec-case-study">case study</a> to see how this plays out in practice.</p>
</section>
<section id="sec-confusion-matrix" class="level3">
<h3 class="anchored" data-anchor-id="sec-confusion-matrix">The Confusion Matrix</h3>
<p>Many commonly used metrics such as accuracy, precision, recall, and F1 score, are derived from the <em>confusion matrix</em>. The confusion matrix is the initial summary of the relationship between the predicted and observed classes. However, any metric derived in this way will be sensitive to the classification threshold.</p>
<p>On the other hand, many other metrics derived from predicted probabilities. Examples include the area under a receiver operating curve (AUROC) and Brier score, and these metrics are independent of the classification threshold, and so can provide an additional view of model performance. These metrics are particularly valuable in imbalanced settings, where the threshold-dependent metrics may fail to capture the nuances of model behavior. Let’s now see how this works.</p>
</section>
<section id="sec-example-thresh-05" class="level3">
<h3 class="anchored" data-anchor-id="sec-example-thresh-05">Example: Classification with a .5 Threshold</h3>
<p>In the following hypothetical example, the positive rate for the binary target is low - the true average underlying probability of the positive outcome is less than 0.1. Though in practice we’d not know the true probabilities, here we can visualize what their distribution might look like in the following density plot, where the mean probability of the positive class is marked by the line.</p>
<div id="fig-dens-true-prob" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-dens-true-prob-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="../../img/class-imbalance/density.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-dens-true-prob-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Density plot of underlying true probabilities, imbalanced setting
</figcaption>
</figure>
</div>
<p>Now assume we have a model that predicts probabilities for the target outcome. It may even produce probabilities that correspond well to the true probabilities, as shown in the following plot.</p>
<div id="fig-dens-pred-vs-true-prob" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-dens-pred-vs-true-prob-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="../../img/class-imbalance/density_pred_vs_true.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-dens-pred-vs-true-prob-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Predicted vs.&nbsp;True Probabilities
</figcaption>
</figure>
</div>
<p>Now, what might a confusion matrix for such data look like with a standard threshold of 0.5? In our hypothetical dataset, we have 100 total for the sample, but there are only five positive observations. Using the default threshold leads to ineffective classification of the minority class, as we only classified two observations as positive, and only one was correct. In this case our precision is 50%, meaning that half of the positive classifications were correct, but our recall is only 20%, meaning we only classified one out of five possible positive observations correctly.</p>
<div class="cell" data-execution_count="4">
<div id="tbl-confusion-matrix-1" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="4">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-confusion-matrix-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Confusion Matrix 1: Standard Threshold
</figcaption>
<div aria-describedby="tbl-confusion-matrix-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="4">
<div id="xfggvycmyk" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>
#xfggvycmyk table {
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
        }

#xfggvycmyk thead, tbody, tfoot, tr, td, th { border-style: none; }
 tr { background-color: transparent; }
#xfggvycmyk p { margin: 0; padding: 0; }
 #xfggvycmyk .gt_table { display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 2px; border-top-color: #A8A8A8; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #A8A8A8; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; }
 #xfggvycmyk .gt_caption { padding-top: 4px; padding-bottom: 4px; }
 #xfggvycmyk .gt_title { color: #333333; font-size: 125%; font-weight: initial; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; border-bottom-color: #FFFFFF; border-bottom-width: 0; }
 #xfggvycmyk .gt_subtitle { color: #333333; font-size: 85%; font-weight: initial; padding-top: 3px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; border-top-color: #FFFFFF; border-top-width: 0; }
 #xfggvycmyk .gt_heading { background-color: #FFFFFF; text-align: center; border-bottom-color: #FFFFFF; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #xfggvycmyk .gt_bottom_border { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; }
 #xfggvycmyk .gt_col_headings { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #xfggvycmyk .gt_col_heading { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; }
 #xfggvycmyk .gt_column_spanner_outer { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 4px; }
 #xfggvycmyk .gt_column_spanner_outer:first-child { padding-left: 0; }
 #xfggvycmyk .gt_column_spanner_outer:last-child { padding-right: 0; }
 #xfggvycmyk .gt_column_spanner { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; overflow-x: hidden; display: inline-block; width: 100%; }
 #xfggvycmyk .gt_spanner_row { border-bottom-style: hidden; }
 #xfggvycmyk .gt_group_heading { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; text-align: left; }
 #xfggvycmyk .gt_empty_group_heading { padding: 0.5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: middle; }
 #xfggvycmyk .gt_from_md> :first-child { margin-top: 0; }
 #xfggvycmyk .gt_from_md> :last-child { margin-bottom: 0; }
 #xfggvycmyk .gt_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; }
 #xfggvycmyk .gt_stub { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; }
 #xfggvycmyk .gt_stub_row_group { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; vertical-align: top; }
 #xfggvycmyk .gt_row_group_first td { border-top-width: 2px; }
 #xfggvycmyk .gt_row_group_first th { border-top-width: 2px; }
 #xfggvycmyk .gt_striped { background-color: rgba(128,128,128,0.05); }
 #xfggvycmyk .gt_table_body { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; }
 #xfggvycmyk .gt_sourcenotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; }
 #xfggvycmyk .gt_sourcenote { font-size: 90%; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; text-align: left; }
 #xfggvycmyk .gt_left { text-align: left; }
 #xfggvycmyk .gt_center { text-align: center; }
 #xfggvycmyk .gt_right { text-align: right; font-variant-numeric: tabular-nums; }
 #xfggvycmyk .gt_font_normal { font-weight: normal; }
 #xfggvycmyk .gt_font_bold { font-weight: bold; }
 #xfggvycmyk .gt_font_italic { font-style: italic; }
 #xfggvycmyk .gt_super { font-size: 65%; }
 #xfggvycmyk .gt_footnote_marks { font-size: 75%; vertical-align: 0.4em; position: initial; }
 #xfggvycmyk .gt_asterisk { font-size: 100%; vertical-align: 0; }
 
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>

<tr class="gt_col_headings">
  <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id=""></th>
  <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Observed -">Observed -</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Observed +">Observed +</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Metrics">Metrics</th>
</tr>
</thead>
<tbody class="gt_table_body">
  <tr>
    <td class="gt_row gt_left">Predicted -</td>
    <td class="gt_row gt_left">94</td>
    <td class="gt_row gt_left">4</td>
    <td class="gt_row gt_left">NPV: .96</td>
  </tr>
  <tr>
    <td class="gt_row gt_left">Predicted +</td>
    <td class="gt_row gt_left">1</td>
    <td class="gt_row gt_left">1</td>
    <td class="gt_row gt_left">PPV: .50</td>
  </tr>
  <tr>
    <td class="gt_row gt_left">Metrics</td>
    <td class="gt_row gt_left">TNR: .99</td>
    <td class="gt_row gt_left">TPR: .20</td>
    <td class="gt_row gt_left">ACC: .95</td>
  </tr>
</tbody>


</table>

</div>
        
</div>
</div>
</figure>
</div>
</div>
<p><span style="font-size: 0.9em">Abbreviations:</span></p>
<ul>
<li><span style="font-size: 0.8em"><em>ACC</em>: Accuracy</span></li>
<li><span style="font-size: 0.8em"><em>TPR</em>: True Positive Rate/Sensitivity/Recall</span></li>
<li><span style="font-size: 0.8em"><em>TNR</em>: True Negative Rate/Specificity</span></li>
<li><span style="font-size: 0.8em"><em>PPV</em>: Positive Predictive Value/Precision</span></li>
<li><span style="font-size: 0.8em"><em>NPV</em>: Negative Predictive Value</span></li>
</ul>
<p>Although classifying one observation out of five true positive cases is not something we’d probably be satisfied with, the accuracy score is 95% because almost all the negative observations were correctly classified (true negative rate = 99%). Without any additional context, someone might think 95% accuracy was a good result, but it’s actually no better than guessing, or just labeling all observations as the most common (negative) class, which would have also resulted in 95% accuracy. The other metrics in the confusion matrix like precision (PPV) and recall (TPR) provide the additional context that we need to understand the model’s performance - namely, that we are not doing so well with the positive class, which is typically not a desirable outcome.</p>
</section>
<section id="example-classification-with-a-lower-threshold" class="level3">
<h3 class="anchored" data-anchor-id="example-classification-with-a-lower-threshold">Example: Classification with a Lower Threshold</h3>
<p>The next plot shows different possible threshold values we could use for the predicted probabilities. With each threshold, we’d potentially create different classifications, resulting in a new confusion matrix and different metrics based on those predicted classes.</p>
<div id="fig-dens-thresholds" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-dens-thresholds-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="../../img/class-imbalance/density_threshold.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-dens-thresholds-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Predicted vs.&nbsp;true probabilities with different thresholds
</figcaption>
</figure>
</div>
<p>Now let’s see what happens to the performance metrics if we try using a lower classification threshold than 0.5, say something closer to ~.1. Here is what the resulting table might look like.</p>
<p>In this setting, the accuracy score has dropped from 95% to 84%, but we really shouldn’t too be concerned with this, as accuracy isn’t usually our focus in the imbalanced setting. Again, we could have guessed and gotten 95% correct. One new result is that the true positive rate (recall) has notably increased - from 20% to 80% - there are now four out of five possible correct positive classifications. This is much better! But looking further, it did come at the cost of a higher false positive rate - ~16% for this result vs.&nbsp;1% previously<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>. The positive predictive value (PPV) has also dropped from 50% to 21%, meaning that only about one in five of the positive classifications were correct. This is a common trade-off in imbalanced settings, where increasing recall often comes at the cost of precision, and vice versa. In general, this result suggests that the model is now doing a better job of capturing the positive class. But while we gain in some metrics, we’ve lost ground in others. Again, it’s a trade-off.</p>
<div class="cell" data-execution_count="6">
<div id="tbl-confusion-matrix-2" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="6">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-confusion-matrix-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: Confusion Matrix 2: Lower Threshold
</figcaption>
<div aria-describedby="tbl-confusion-matrix-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="6">
<div id="kjykvyjjrr" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>
#kjykvyjjrr table {
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
        }

#kjykvyjjrr thead, tbody, tfoot, tr, td, th { border-style: none; }
 tr { background-color: transparent; }
#kjykvyjjrr p { margin: 0; padding: 0; }
 #kjykvyjjrr .gt_table { display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 2px; border-top-color: #A8A8A8; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #A8A8A8; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; }
 #kjykvyjjrr .gt_caption { padding-top: 4px; padding-bottom: 4px; }
 #kjykvyjjrr .gt_title { color: #333333; font-size: 125%; font-weight: initial; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; border-bottom-color: #FFFFFF; border-bottom-width: 0; }
 #kjykvyjjrr .gt_subtitle { color: #333333; font-size: 85%; font-weight: initial; padding-top: 3px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; border-top-color: #FFFFFF; border-top-width: 0; }
 #kjykvyjjrr .gt_heading { background-color: #FFFFFF; text-align: center; border-bottom-color: #FFFFFF; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #kjykvyjjrr .gt_bottom_border { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; }
 #kjykvyjjrr .gt_col_headings { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #kjykvyjjrr .gt_col_heading { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; }
 #kjykvyjjrr .gt_column_spanner_outer { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 4px; }
 #kjykvyjjrr .gt_column_spanner_outer:first-child { padding-left: 0; }
 #kjykvyjjrr .gt_column_spanner_outer:last-child { padding-right: 0; }
 #kjykvyjjrr .gt_column_spanner { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; overflow-x: hidden; display: inline-block; width: 100%; }
 #kjykvyjjrr .gt_spanner_row { border-bottom-style: hidden; }
 #kjykvyjjrr .gt_group_heading { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; text-align: left; }
 #kjykvyjjrr .gt_empty_group_heading { padding: 0.5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: middle; }
 #kjykvyjjrr .gt_from_md> :first-child { margin-top: 0; }
 #kjykvyjjrr .gt_from_md> :last-child { margin-bottom: 0; }
 #kjykvyjjrr .gt_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; }
 #kjykvyjjrr .gt_stub { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; }
 #kjykvyjjrr .gt_stub_row_group { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; vertical-align: top; }
 #kjykvyjjrr .gt_row_group_first td { border-top-width: 2px; }
 #kjykvyjjrr .gt_row_group_first th { border-top-width: 2px; }
 #kjykvyjjrr .gt_striped { background-color: rgba(128,128,128,0.05); }
 #kjykvyjjrr .gt_table_body { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; }
 #kjykvyjjrr .gt_sourcenotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; }
 #kjykvyjjrr .gt_sourcenote { font-size: 90%; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; text-align: left; }
 #kjykvyjjrr .gt_left { text-align: left; }
 #kjykvyjjrr .gt_center { text-align: center; }
 #kjykvyjjrr .gt_right { text-align: right; font-variant-numeric: tabular-nums; }
 #kjykvyjjrr .gt_font_normal { font-weight: normal; }
 #kjykvyjjrr .gt_font_bold { font-weight: bold; }
 #kjykvyjjrr .gt_font_italic { font-style: italic; }
 #kjykvyjjrr .gt_super { font-size: 65%; }
 #kjykvyjjrr .gt_footnote_marks { font-size: 75%; vertical-align: 0.4em; position: initial; }
 #kjykvyjjrr .gt_asterisk { font-size: 100%; vertical-align: 0; }
 
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>

<tr class="gt_col_headings">
  <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id=""></th>
  <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Observed -">Observed -</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Observed +">Observed +</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Metrics">Metrics</th>
</tr>
</thead>
<tbody class="gt_table_body">
  <tr>
    <td class="gt_row gt_left">Predicted -</td>
    <td class="gt_row gt_left">80</td>
    <td class="gt_row gt_left">1</td>
    <td class="gt_row gt_left">NPV: .99</td>
  </tr>
  <tr>
    <td class="gt_row gt_left">Predicted +</td>
    <td class="gt_row gt_left">15</td>
    <td class="gt_row gt_left">4</td>
    <td class="gt_row gt_left">PPV: .21</td>
  </tr>
  <tr>
    <td class="gt_row gt_left">Metrics</td>
    <td class="gt_row gt_left">TNR: .84</td>
    <td class="gt_row gt_left">TPR: .80</td>
    <td class="gt_row gt_left">ACC: .84</td>
  </tr>
</tbody>


</table>

</div>
        
</div>
</div>
</figure>
</div>
</div>
<p>The following table provides some additional metrics to consider for the two confusion matrices. In particular, we see the <em>F1 score</em>, the <em>balanced accuracy</em> score, the area under a receiver operating curve (<em>AUROC</em>) score. These are common alternatives used in the imbalanced setting.</p>
<div class="cell" data-execution_count="7">
<div id="tbl-add-metrics" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="7">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-add-metrics-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3: Additional Metrics
</figcaption>
<div aria-describedby="tbl-add-metrics-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="7">
<div id="mldcnjegev" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>
#mldcnjegev table {
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
        }

#mldcnjegev thead, tbody, tfoot, tr, td, th { border-style: none; }
 tr { background-color: transparent; }
#mldcnjegev p { margin: 0; padding: 0; }
 #mldcnjegev .gt_table { display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 2px; border-top-color: #A8A8A8; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #A8A8A8; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; }
 #mldcnjegev .gt_caption { padding-top: 4px; padding-bottom: 4px; }
 #mldcnjegev .gt_title { color: #333333; font-size: 125%; font-weight: initial; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; border-bottom-color: #FFFFFF; border-bottom-width: 0; }
 #mldcnjegev .gt_subtitle { color: #333333; font-size: 85%; font-weight: initial; padding-top: 3px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; border-top-color: #FFFFFF; border-top-width: 0; }
 #mldcnjegev .gt_heading { background-color: #FFFFFF; text-align: center; border-bottom-color: #FFFFFF; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #mldcnjegev .gt_bottom_border { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; }
 #mldcnjegev .gt_col_headings { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #mldcnjegev .gt_col_heading { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; }
 #mldcnjegev .gt_column_spanner_outer { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 4px; }
 #mldcnjegev .gt_column_spanner_outer:first-child { padding-left: 0; }
 #mldcnjegev .gt_column_spanner_outer:last-child { padding-right: 0; }
 #mldcnjegev .gt_column_spanner { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; overflow-x: hidden; display: inline-block; width: 100%; }
 #mldcnjegev .gt_spanner_row { border-bottom-style: hidden; }
 #mldcnjegev .gt_group_heading { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; text-align: left; }
 #mldcnjegev .gt_empty_group_heading { padding: 0.5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: middle; }
 #mldcnjegev .gt_from_md> :first-child { margin-top: 0; }
 #mldcnjegev .gt_from_md> :last-child { margin-bottom: 0; }
 #mldcnjegev .gt_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; }
 #mldcnjegev .gt_stub { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; }
 #mldcnjegev .gt_stub_row_group { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; vertical-align: top; }
 #mldcnjegev .gt_row_group_first td { border-top-width: 2px; }
 #mldcnjegev .gt_row_group_first th { border-top-width: 2px; }
 #mldcnjegev .gt_striped { background-color: rgba(128,128,128,0.05); }
 #mldcnjegev .gt_table_body { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; }
 #mldcnjegev .gt_sourcenotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; }
 #mldcnjegev .gt_sourcenote { font-size: 90%; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; text-align: left; }
 #mldcnjegev .gt_left { text-align: left; }
 #mldcnjegev .gt_center { text-align: center; }
 #mldcnjegev .gt_right { text-align: right; font-variant-numeric: tabular-nums; }
 #mldcnjegev .gt_font_normal { font-weight: normal; }
 #mldcnjegev .gt_font_bold { font-weight: bold; }
 #mldcnjegev .gt_font_italic { font-style: italic; }
 #mldcnjegev .gt_super { font-size: 65%; }
 #mldcnjegev .gt_footnote_marks { font-size: 75%; vertical-align: 0.4em; position: initial; }
 #mldcnjegev .gt_asterisk { font-size: 100%; vertical-align: 0; }
 
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>

<tr class="gt_col_headings">
  <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Metric">Metric</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="Conf. Matrix 1">Conf. Matrix 1</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="Conf. Matrix 2">Conf. Matrix 2</th>
</tr>
</thead>
<tbody class="gt_table_body">
  <tr>
    <td class="gt_row gt_left">F1</td>
    <td class="gt_row gt_center">.29</td>
    <td class="gt_row gt_center">.33</td>
  </tr>
  <tr>
    <td class="gt_row gt_left">Bal. Acc.</td>
    <td class="gt_row gt_center">.59</td>
    <td class="gt_row gt_center">.82</td>
  </tr>
  <tr>
    <td class="gt_row gt_left">AUROC</td>
    <td class="gt_row gt_center">.70</td>
    <td class="gt_row gt_center">.70</td>
  </tr>
</tbody>
  <tfoot class="gt_sourcenotes">
  
  <tr>
    <td class="gt_sourcenote" colspan="3" style="color: gray25;font-size: 0.8em;">Confusion Matrix 1: Standard Threshold; Confusion Matrix 2: Lower Threshold</td>
  </tr>

</tfoot>

</table>

</div>
        
</div>
</div>
</figure>
</div>
</div>
<!-- Note to self, though we have the simulated data that produced the plots, the actual data that produced the confusion matrices has been lost. All metrics are accurate for these matrices, but the AUROC is based on the simulated probabilities and test set observed y that are much larger in number than the confusion matrix. -->
<p>The F1 score is the harmonic mean of precision (positive predictive value) and recall (true positive rate), and balanced accuracy is the average of the true positive rate and true negative rate, or the average recall for both positive and negative classes. These are less sensitive to the class imbalance than accuracy, but they are still sensitive to the threshold used to create the classifications. In this case, both improve with a lower threshold, though the F1 score only changes slightly.</p>
<p>In contrast, the AUROC score is based on the predicted probabilities, and so is independent of the threshold, which is why it is constant in <a href="#tbl-add-metrics" class="quarto-xref">Table&nbsp;3</a><a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>. It is a useful metric in this context to consider because it considers the relationship between the true positive rate and true negative rate at many different thresholds, not just the single threshold you happened to select (<span class="citation" data-cites="google_classification_2025">Google (<a href="#ref-google_classification_2025" role="doc-biblioref">2025</a>)</span>). As such, this score is often a preferred metric, even in the balanced classification setting.</p>
<p>We’ve now seen a few performance metrics, but there are many available, and we’ll see even more later. Each provides a different facet with which to view your model’s performance. With this in mind, you should decide which aspects of your model’s performance are most important to your use case, and choose your metrics accordingly.</p>
</section>
</section>
<section id="sec-case-study" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="sec-case-study">Case Study: Wine Quality Data</h2>
<p>At this point, we have covered a lot of ground regarding imbalanced data. We have an idea of the concept generally, the different techniques we might use in the imbalanced setting, as well as the metrics we might use to evaluate our models. We’ve also seen how the choice of classification threshold can affect our model’s performance metrics. To illustrate the concepts discussed in practice, we will demonstrate the application of various techniques for approaching imbalanced data. For the full notebook that produced these, see <a href="https://github.com/m-clark/m-clark.github.io/blob/master/posts/2025-01-28-class-imbalance/wine_quality.ipynb">this repo link</a> and play around with it yourself.</p>
<section id="data-setup" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="data-setup">Data Setup</h3>
<p>We will be using the popular wine quality data. The raw data and more detail is available at the <a href="https://archive.ics.uci.edu/ml/datasets/wine+quality">UCI Repository</a>. Our data combines two datasets, one for red wine and one for white wine. There are 6497 total observations and 17 features that regard different aspects of the wine, like acidity, pH, and alcohol content. We also include a binary feature for whether the color of the wine is red.</p>
<p>The original target is numeric, but for our purposes we are attempting to classify wines with a rating of 8 or 9 as ‘high quality’. This represents 198 high quality wines, about 3.0% of the data. Data was randomly split into a 75% training set and a 25% test set. The test set has 50 high quality wines.</p>

<div class="no-row-height column-margin column-container"><div class="">
<p>This is a good example of how imbalanced data can really make your data feel even smaller. We start with a decent amount of data, but only a small fraction of it is high quality wine, and our test set used for evaluation will only have 50 high quality wines. This is not a lot to work with, and results in noisy metrics based on classification, where just a slight change in the predictions could lead to a noticeable change in the metric. For example, if we had an accuracy of say, 80%, the lower and upper bound estimate would be 66% and 90%, respectively, which is a wide range.</p>
</div></div></section>
<section id="models" class="level3">
<h3 class="anchored" data-anchor-id="models">Models</h3>
<p>We use two base models, a standard logistic regression model via <span class="pack">sklearn</span> and a boosting model via <span class="pack">LightGBM</span>. Both use all non-target columns as features. We will compare the performance of the following models:</p>
<ul>
<li>Basic approach that does nothing for imbalance and uses a threshold of 0.5</li>
<li>Basic approach that uses an ‘optimal’ threshold for classification</li>
<li>A weighted model (using <code>class_weight='balanced'</code> for the logistic and <code>is_unbalance=True</code> for the LGBM)<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a></li>
<li>A random oversampling approach (oversampling) <a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a></li>
</ul>
<p>The optimal threshold can be determined in a variety of ways, and one can look at the <a href="#sec-supplemental">supplemental section</a> for more details on choosing the optimal threshold. Here we used a threshold that maximizes the F-beta score on test, with beta = 2. This means we are giving more weight to recall than precision, which is often the case in imbalanced settings<a href="#fn8" class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a>.</p>
<p>In addition, LGBM models were compared both with and without tuning. The latter case makes a more straightforward comparison since the parameters are identical in each case. But realistically, we would tune this type of model, so we include models tuned for number of estimators/trees, learning rate, and max depth<a href="#fn9" class="footnote-ref" id="fnref9" role="doc-noteref"><sup>9</sup></a>.</p>
<p>Metrics and other exploration that follows focuses on the test set. We will also look at the calibration curves for some models, which can help us understand how well the predicted probabilities align with the observed class proportions.</p>
</section>
<section id="metrics" class="level3">
<h3 class="anchored" data-anchor-id="metrics">Metrics</h3>
<p>Now let’s get to some results. Along with several metrics we’ve already discussed, we’ve added a few others including:</p>
<ul>
<li><em>Brier Score</em>: A measure of the mean squared difference between predicted probabilities and the true outcome. This is equivalent to the MSE for a binary target. Lower is better <span class="citation" data-cites="harrell_damage_2017">(see <a href="#ref-harrell_damage_2017" role="doc-biblioref">Harrell 2017</a> for additional perspective)</span>.</li>
<li><em>Adaptive Calibration Error</em>: A measure of the calibration of the model. Lower is better <span class="citation" data-cites="nixon_measuring_2020">(see <a href="#ref-nixon_measuring_2020" role="doc-biblioref">Nixon et al. 2020</a>)</span>.</li>
<li><em>FPR</em>: False Positive Rate.</li>
<li><em>FNR</em>: False Negative Rate.</li>
</ul>
<p>These metrics help us shift focus to the calibration of the model and penalties for misclassification. For each of these we’d prefer lower values. In addition, we looked at the <em>F2 Score</em>, a variant of the F-score that gives more weight to recall than precision. This is useful when false negatives are more costly than false positives, such as in fraud detection or disease diagnosis. As with F1, higher is better.</p>
</section>
<section id="logistic-model-results" class="level3">
<h3 class="anchored" data-anchor-id="logistic-model-results">Logistic Model Results</h3>
<p>With these in mind, let’s look at the logistic model results. We’ll first focus on metrics that are based on the predicted classes. For metric definitions used in all the tables, see the <a href="#sec-supp-metrics">supplemental section</a>. Best values are bolded/blue.</p>
<div class="cell" data-execution_count="10">
<div id="tbl-class-metrics-logistic" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="10">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-class-metrics-logistic-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4: Test Set Model Classification Metrics for Logistic Regression
</figcaption>
<div aria-describedby="tbl-class-metrics-logistic-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="10">
<div id="qatnmwsoug" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>
#qatnmwsoug table {
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
        }

#qatnmwsoug thead, tbody, tfoot, tr, td, th { border-style: none; }
 tr { background-color: transparent; }
#qatnmwsoug p { margin: 0; padding: 0; }
 #qatnmwsoug .gt_table { display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 2px; border-top-color: #A8A8A8; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #A8A8A8; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; }
 #qatnmwsoug .gt_caption { padding-top: 4px; padding-bottom: 4px; }
 #qatnmwsoug .gt_title { color: #333333; font-size: 125%; font-weight: initial; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; border-bottom-color: #FFFFFF; border-bottom-width: 0; }
 #qatnmwsoug .gt_subtitle { color: #333333; font-size: 85%; font-weight: initial; padding-top: 3px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; border-top-color: #FFFFFF; border-top-width: 0; }
 #qatnmwsoug .gt_heading { background-color: #FFFFFF; text-align: center; border-bottom-color: #FFFFFF; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #qatnmwsoug .gt_bottom_border { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; }
 #qatnmwsoug .gt_col_headings { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #qatnmwsoug .gt_col_heading { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; }
 #qatnmwsoug .gt_column_spanner_outer { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 4px; }
 #qatnmwsoug .gt_column_spanner_outer:first-child { padding-left: 0; }
 #qatnmwsoug .gt_column_spanner_outer:last-child { padding-right: 0; }
 #qatnmwsoug .gt_column_spanner { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; overflow-x: hidden; display: inline-block; width: 100%; }
 #qatnmwsoug .gt_spanner_row { border-bottom-style: hidden; }
 #qatnmwsoug .gt_group_heading { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; text-align: left; }
 #qatnmwsoug .gt_empty_group_heading { padding: 0.5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: middle; }
 #qatnmwsoug .gt_from_md> :first-child { margin-top: 0; }
 #qatnmwsoug .gt_from_md> :last-child { margin-bottom: 0; }
 #qatnmwsoug .gt_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; }
 #qatnmwsoug .gt_stub { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; }
 #qatnmwsoug .gt_stub_row_group { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; vertical-align: top; }
 #qatnmwsoug .gt_row_group_first td { border-top-width: 2px; }
 #qatnmwsoug .gt_row_group_first th { border-top-width: 2px; }
 #qatnmwsoug .gt_striped { background-color: rgba(128,128,128,0.05); }
 #qatnmwsoug .gt_table_body { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; }
 #qatnmwsoug .gt_sourcenotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; }
 #qatnmwsoug .gt_sourcenote { font-size: 90%; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; text-align: left; }
 #qatnmwsoug .gt_left { text-align: left; }
 #qatnmwsoug .gt_center { text-align: center; }
 #qatnmwsoug .gt_right { text-align: right; font-variant-numeric: tabular-nums; }
 #qatnmwsoug .gt_font_normal { font-weight: normal; }
 #qatnmwsoug .gt_font_bold { font-weight: bold; }
 #qatnmwsoug .gt_font_italic { font-style: italic; }
 #qatnmwsoug .gt_super { font-size: 65%; }
 #qatnmwsoug .gt_footnote_marks { font-size: 75%; vertical-align: 0.4em; position: initial; }
 #qatnmwsoug .gt_asterisk { font-size: 100%; vertical-align: 0; }
 
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>

<tr class="gt_col_headings">
  <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Model">Model</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Threshold">Threshold</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Mean Pred">Mean Pred</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Precision">Precision</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Recall">Recall</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="F1 Score">F1 Score</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="F2 Score">F2 Score</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="FPR">FPR</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="FNR">FNR</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Total Pos Pred">Total Pos Pred</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Threshold Method">Threshold Method</th>
</tr>
</thead>
<tbody class="gt_table_body">
  <tr>
    <td class="gt_row gt_left">Logistic Basic</td>
    <td class="gt_row gt_right">0.500</td>
    <td class="gt_row gt_right">0.031</td>
    <td class="gt_row gt_right">0.000</td>
    <td class="gt_row gt_right">0.000</td>
    <td class="gt_row gt_right">0.000</td>
    <td class="gt_row gt_right">0.000</td>
    <td style="color: #0072B2;font-weight: 800;" class="gt_row gt_right">0.001</td>
    <td class="gt_row gt_right">1.000</td>
    <td class="gt_row gt_right">1</td>
    <td class="gt_row gt_left">Default</td>
  </tr>
  <tr>
    <td class="gt_row gt_left">Logistic Basic (T)</td>
    <td class="gt_row gt_right">0.063</td>
    <td class="gt_row gt_right">0.031</td>
    <td style="color: #0072B2;font-weight: 800;" class="gt_row gt_right">0.105</td>
    <td class="gt_row gt_right">0.500</td>
    <td style="color: #0072B2;font-weight: 800;" class="gt_row gt_right">0.174</td>
    <td style="color: #0072B2;font-weight: 800;" class="gt_row gt_right">0.286</td>
    <td class="gt_row gt_right">0.135</td>
    <td class="gt_row gt_right">0.500</td>
    <td class="gt_row gt_right">237</td>
    <td class="gt_row gt_left">F2</td>
  </tr>
  <tr>
    <td class="gt_row gt_left">Logistic Over</td>
    <td class="gt_row gt_right">0.500</td>
    <td class="gt_row gt_right">0.350</td>
    <td class="gt_row gt_right">0.062</td>
    <td class="gt_row gt_right">0.580</td>
    <td class="gt_row gt_right">0.112</td>
    <td class="gt_row gt_right">0.217</td>
    <td class="gt_row gt_right">0.279</td>
    <td class="gt_row gt_right">0.420</td>
    <td class="gt_row gt_right">468</td>
    <td class="gt_row gt_left">Default</td>
  </tr>
  <tr>
    <td class="gt_row gt_left">Logistic Weighted</td>
    <td class="gt_row gt_right">0.500</td>
    <td class="gt_row gt_right">0.350</td>
    <td class="gt_row gt_right">0.066</td>
    <td style="color: #0072B2;font-weight: 800;" class="gt_row gt_right">0.600</td>
    <td class="gt_row gt_right">0.119</td>
    <td class="gt_row gt_right">0.229</td>
    <td class="gt_row gt_right">0.270</td>
    <td style="color: #0072B2;font-weight: 800;" class="gt_row gt_right">0.400</td>
    <td class="gt_row gt_right">456</td>
    <td class="gt_row gt_left">Default</td>
  </tr>
</tbody>
  <tfoot class="gt_sourcenotes">
  
  <tr>
    <td class="gt_sourcenote" colspan="11">(T) means that classification is based on an optimal threshold, but the model is the same as the corresponding "Basic" model. See the supplemental section for details.</td>
  </tr>

</tfoot>

</table>

</div>
        
</div>
</div>
</figure>
</div>
</div>
<p>The basic logistic with default threshold of 0.5 does very poorly, predicting only 1 positive case, and it doesn’t even get that right! Shifting to a lower threshold for this model (~0.063) improves most metrics, and it’s better than the weighted and resampling approaches on several metrics. However, the threshold improvement is no free lunch - we now classify 237 cases as positive, which is probably too many. As a result, the FPR is increased.</p>
<p>The sampling and weighted approaches come to the same conclusions, which is expected for logistic regression. While both would be better than doing nothing at all, both predict far too many positive cases, ~9 times what’s observed in the data! The mean predicted probability is also high (~0.35), which is a sign that the model is overpredicting the minority class. However, this makes sense when considering the fact that the training data was resampled to a balanced state, or the model was estimated as if it were via weighting.</p>
<p>Now let’s look at the metrics that are based on the predicted probabilities. Again, consult the <a href="#sec-supp-metrics">supplemental section</a> for brief definitions of these metrics. Since thresholding doesn’t matter here, we exclude it from the table, as it’s identical to the basic model.</p>
<div class="cell" data-execution_count="11">
<div id="tbl-prob-metrics-logistic" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="11">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-prob-metrics-logistic-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;5: Test Set Model Probability Metrics for Logistic Regression
</figcaption>
<div aria-describedby="tbl-prob-metrics-logistic-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="11">
<div id="wbsfbfxyvd" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>
#wbsfbfxyvd table {
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
        }

#wbsfbfxyvd thead, tbody, tfoot, tr, td, th { border-style: none; }
 tr { background-color: transparent; }
#wbsfbfxyvd p { margin: 0; padding: 0; }
 #wbsfbfxyvd .gt_table { display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 2px; border-top-color: #A8A8A8; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #A8A8A8; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; }
 #wbsfbfxyvd .gt_caption { padding-top: 4px; padding-bottom: 4px; }
 #wbsfbfxyvd .gt_title { color: #333333; font-size: 125%; font-weight: initial; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; border-bottom-color: #FFFFFF; border-bottom-width: 0; }
 #wbsfbfxyvd .gt_subtitle { color: #333333; font-size: 85%; font-weight: initial; padding-top: 3px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; border-top-color: #FFFFFF; border-top-width: 0; }
 #wbsfbfxyvd .gt_heading { background-color: #FFFFFF; text-align: center; border-bottom-color: #FFFFFF; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #wbsfbfxyvd .gt_bottom_border { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; }
 #wbsfbfxyvd .gt_col_headings { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #wbsfbfxyvd .gt_col_heading { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; }
 #wbsfbfxyvd .gt_column_spanner_outer { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 4px; }
 #wbsfbfxyvd .gt_column_spanner_outer:first-child { padding-left: 0; }
 #wbsfbfxyvd .gt_column_spanner_outer:last-child { padding-right: 0; }
 #wbsfbfxyvd .gt_column_spanner { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; overflow-x: hidden; display: inline-block; width: 100%; }
 #wbsfbfxyvd .gt_spanner_row { border-bottom-style: hidden; }
 #wbsfbfxyvd .gt_group_heading { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; text-align: left; }
 #wbsfbfxyvd .gt_empty_group_heading { padding: 0.5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: middle; }
 #wbsfbfxyvd .gt_from_md> :first-child { margin-top: 0; }
 #wbsfbfxyvd .gt_from_md> :last-child { margin-bottom: 0; }
 #wbsfbfxyvd .gt_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; }
 #wbsfbfxyvd .gt_stub { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; }
 #wbsfbfxyvd .gt_stub_row_group { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; vertical-align: top; }
 #wbsfbfxyvd .gt_row_group_first td { border-top-width: 2px; }
 #wbsfbfxyvd .gt_row_group_first th { border-top-width: 2px; }
 #wbsfbfxyvd .gt_striped { background-color: rgba(128,128,128,0.05); }
 #wbsfbfxyvd .gt_table_body { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; }
 #wbsfbfxyvd .gt_sourcenotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; }
 #wbsfbfxyvd .gt_sourcenote { font-size: 90%; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; text-align: left; }
 #wbsfbfxyvd .gt_left { text-align: left; }
 #wbsfbfxyvd .gt_center { text-align: center; }
 #wbsfbfxyvd .gt_right { text-align: right; font-variant-numeric: tabular-nums; }
 #wbsfbfxyvd .gt_font_normal { font-weight: normal; }
 #wbsfbfxyvd .gt_font_bold { font-weight: bold; }
 #wbsfbfxyvd .gt_font_italic { font-style: italic; }
 #wbsfbfxyvd .gt_super { font-size: 65%; }
 #wbsfbfxyvd .gt_footnote_marks { font-size: 75%; vertical-align: 0.4em; position: initial; }
 #wbsfbfxyvd .gt_asterisk { font-size: 100%; vertical-align: 0; }
 
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>

<tr class="gt_col_headings">
  <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Model">Model</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Threshold">Threshold</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Mean Pred">Mean Pred</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="AUROC">AUROC</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Avg Prec">Avg Prec</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Brier Score">Brier Score</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="ACE">ACE</th>
</tr>
</thead>
<tbody class="gt_table_body">
  <tr>
    <td class="gt_row gt_left">Logistic Basic</td>
    <td class="gt_row gt_right">0.500</td>
    <td class="gt_row gt_right">0.031</td>
    <td style="color: #0072B2;font-weight: 800;" class="gt_row gt_right">0.752</td>
    <td style="color: #0072B2;font-weight: 800;" class="gt_row gt_right">0.093</td>
    <td style="color: #0072B2;font-weight: 800;" class="gt_row gt_right">0.030</td>
    <td style="color: #0072B2;font-weight: 800;" class="gt_row gt_right">0.015</td>
  </tr>
  <tr>
    <td class="gt_row gt_left">Logistic Over</td>
    <td class="gt_row gt_right">0.500</td>
    <td class="gt_row gt_right">0.350</td>
    <td class="gt_row gt_right">0.744</td>
    <td class="gt_row gt_right">0.084</td>
    <td class="gt_row gt_right">0.186</td>
    <td class="gt_row gt_right">0.319</td>
  </tr>
  <tr>
    <td class="gt_row gt_left">Logistic Weighted</td>
    <td class="gt_row gt_right">0.500</td>
    <td class="gt_row gt_right">0.350</td>
    <td class="gt_row gt_right">0.752</td>
    <td class="gt_row gt_right">0.084</td>
    <td class="gt_row gt_right">0.183</td>
    <td class="gt_row gt_right">0.318</td>
  </tr>
</tbody>
  <tfoot class="gt_sourcenotes">
  
  <tr>
    <td class="gt_sourcenote" colspan="7">(T) means that classification is based on an optimal threshold, but the model is the same as the corresponding "Basic" model. See the supplemental section for details.</td>
  </tr>

</tfoot>

</table>

</div>
        
</div>
</div>
</figure>
</div>
</div>
<p>While AUROC and average precision aren’t too different among the models, note how the Brier score and ACE are notably lower for the basic model. This suggests better calibration. Let’s see what this looks like in the <a href="https://scikit-learn.org/stable/auto_examples/calibration/plot_calibration_curve.html">calibration curves</a> and the predicted probabilities.</p>
<div id="cell-fig-calibration-logistic" class="cell" data-execution_count="12">
<div class="cell-output cell-output-display">
<div id="fig-calibration-logistic" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-calibration-logistic-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-calibration-logistic-output-1.png" width="768" height="576" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-calibration-logistic-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Calibration Curves for Logistic Regression
</figcaption>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>We can see in <a href="#fig-calibration-logistic" class="quarto-xref">Figure&nbsp;4</a> that the basic model predicted probabilities are well-calibrated, which is also reflected in the notably lower Brier and ACE scores. Weighting and resampling lead to over-prediction of the minority class. We can see this by also examining the predicted probabilities directly, as in <a href="#fig-predicted-probs-logistic" class="quarto-xref">Figure&nbsp;5</a>. Their mean prediction is well beyond the observed rate<a href="#fn10" class="footnote-ref" id="fnref10" role="doc-noteref"><sup>10</sup></a>.</p>
<div id="cell-fig-predicted-probs-logistic" class="cell" data-execution_count="13">
<div class="cell-output cell-output-display">
<div id="fig-predicted-probs-logistic" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-predicted-probs-logistic-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-predicted-probs-logistic-output-1.png" width="768" height="576" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-predicted-probs-logistic-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Predicted Probabilities for Logistic Regression
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="lgbm-model-results" class="level3">
<h3 class="anchored" data-anchor-id="lgbm-model-results">LGBM Model Results</h3>
<p>Now let’s look at the LGBM model results, starting with the classification metrics.</p>
<div class="cell" data-execution_count="15">
<div id="tbl-class-metrics-lgbm" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="15">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-class-metrics-lgbm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;6: Test Set Model Classification Metrics for LGBM MOdel
</figcaption>
<div aria-describedby="tbl-class-metrics-lgbm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="15">
<div id="nallcdadis" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>
#nallcdadis table {
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
        }

#nallcdadis thead, tbody, tfoot, tr, td, th { border-style: none; }
 tr { background-color: transparent; }
#nallcdadis p { margin: 0; padding: 0; }
 #nallcdadis .gt_table { display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 2px; border-top-color: #A8A8A8; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #A8A8A8; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; }
 #nallcdadis .gt_caption { padding-top: 4px; padding-bottom: 4px; }
 #nallcdadis .gt_title { color: #333333; font-size: 125%; font-weight: initial; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; border-bottom-color: #FFFFFF; border-bottom-width: 0; }
 #nallcdadis .gt_subtitle { color: #333333; font-size: 85%; font-weight: initial; padding-top: 3px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; border-top-color: #FFFFFF; border-top-width: 0; }
 #nallcdadis .gt_heading { background-color: #FFFFFF; text-align: center; border-bottom-color: #FFFFFF; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #nallcdadis .gt_bottom_border { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; }
 #nallcdadis .gt_col_headings { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #nallcdadis .gt_col_heading { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; }
 #nallcdadis .gt_column_spanner_outer { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 4px; }
 #nallcdadis .gt_column_spanner_outer:first-child { padding-left: 0; }
 #nallcdadis .gt_column_spanner_outer:last-child { padding-right: 0; }
 #nallcdadis .gt_column_spanner { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; overflow-x: hidden; display: inline-block; width: 100%; }
 #nallcdadis .gt_spanner_row { border-bottom-style: hidden; }
 #nallcdadis .gt_group_heading { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; text-align: left; }
 #nallcdadis .gt_empty_group_heading { padding: 0.5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: middle; }
 #nallcdadis .gt_from_md> :first-child { margin-top: 0; }
 #nallcdadis .gt_from_md> :last-child { margin-bottom: 0; }
 #nallcdadis .gt_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; }
 #nallcdadis .gt_stub { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; }
 #nallcdadis .gt_stub_row_group { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; vertical-align: top; }
 #nallcdadis .gt_row_group_first td { border-top-width: 2px; }
 #nallcdadis .gt_row_group_first th { border-top-width: 2px; }
 #nallcdadis .gt_striped { background-color: rgba(128,128,128,0.05); }
 #nallcdadis .gt_table_body { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; }
 #nallcdadis .gt_sourcenotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; }
 #nallcdadis .gt_sourcenote { font-size: 90%; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; text-align: left; }
 #nallcdadis .gt_left { text-align: left; }
 #nallcdadis .gt_center { text-align: center; }
 #nallcdadis .gt_right { text-align: right; font-variant-numeric: tabular-nums; }
 #nallcdadis .gt_font_normal { font-weight: normal; }
 #nallcdadis .gt_font_bold { font-weight: bold; }
 #nallcdadis .gt_font_italic { font-style: italic; }
 #nallcdadis .gt_super { font-size: 65%; }
 #nallcdadis .gt_footnote_marks { font-size: 75%; vertical-align: 0.4em; position: initial; }
 #nallcdadis .gt_asterisk { font-size: 100%; vertical-align: 0; }
 
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>

<tr class="gt_col_headings">
  <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Model">Model</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Tuned">Tuned</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Threshold">Threshold</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Mean Pred">Mean Pred</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Precision">Precision</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Recall">Recall</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="F1 Score">F1 Score</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="F2 Score">F2 Score</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="FPR">FPR</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="FNR">FNR</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Total Pos Pred">Total Pos Pred</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Threshold Method">Threshold Method</th>
</tr>
</thead>
<tbody class="gt_table_body">
  <tr>
    <td class="gt_row gt_left">LGBM Basic</td>
    <td class="gt_row gt_left">Not</td>
    <td class="gt_row gt_right">0.500</td>
    <td class="gt_row gt_right">0.022</td>
    <td class="gt_row gt_right">0.840</td>
    <td class="gt_row gt_right">0.420</td>
    <td style="color: #0072B2;font-weight: 800;" class="gt_row gt_right">0.560</td>
    <td class="gt_row gt_right">0.467</td>
    <td class="gt_row gt_right">0.003</td>
    <td class="gt_row gt_right">0.580</td>
    <td class="gt_row gt_right">25</td>
    <td class="gt_row gt_left">Default</td>
  </tr>
  <tr>
    <td class="gt_row gt_left">LGBM Basic</td>
    <td class="gt_row gt_left">Tuned</td>
    <td class="gt_row gt_right">0.500</td>
    <td class="gt_row gt_right">0.028</td>
    <td style="color: #0072B2;font-weight: 800;" class="gt_row gt_right">1.000</td>
    <td class="gt_row gt_right">0.320</td>
    <td class="gt_row gt_right">0.485</td>
    <td class="gt_row gt_right">0.370</td>
    <td style="color: #0072B2;font-weight: 800;" class="gt_row gt_right">0.000</td>
    <td class="gt_row gt_right">0.680</td>
    <td class="gt_row gt_right">16</td>
    <td class="gt_row gt_left">Default</td>
  </tr>
  <tr>
    <td class="gt_row gt_left">LGBM Basic (T)</td>
    <td class="gt_row gt_left">Not</td>
    <td class="gt_row gt_right">0.028</td>
    <td class="gt_row gt_right">0.022</td>
    <td class="gt_row gt_right">0.256</td>
    <td class="gt_row gt_right">0.620</td>
    <td class="gt_row gt_right">0.363</td>
    <td class="gt_row gt_right">0.483</td>
    <td class="gt_row gt_right">0.057</td>
    <td class="gt_row gt_right">0.380</td>
    <td class="gt_row gt_right">121</td>
    <td class="gt_row gt_left">F2</td>
  </tr>
  <tr>
    <td class="gt_row gt_left">LGBM Basic (T)</td>
    <td class="gt_row gt_left">Tuned</td>
    <td class="gt_row gt_right">0.061</td>
    <td class="gt_row gt_right">0.028</td>
    <td class="gt_row gt_right">0.228</td>
    <td style="color: #0072B2;font-weight: 800;" class="gt_row gt_right">0.660</td>
    <td class="gt_row gt_right">0.338</td>
    <td class="gt_row gt_right">0.478</td>
    <td class="gt_row gt_right">0.071</td>
    <td style="color: #0072B2;font-weight: 800;" class="gt_row gt_right">0.340</td>
    <td class="gt_row gt_right">145</td>
    <td class="gt_row gt_left">F2</td>
  </tr>
  <tr>
    <td class="gt_row gt_left">LGBM Over</td>
    <td class="gt_row gt_left">Not</td>
    <td class="gt_row gt_right">0.500</td>
    <td class="gt_row gt_right">0.041</td>
    <td class="gt_row gt_right">0.522</td>
    <td class="gt_row gt_right">0.480</td>
    <td class="gt_row gt_right">0.500</td>
    <td class="gt_row gt_right">0.488</td>
    <td class="gt_row gt_right">0.014</td>
    <td class="gt_row gt_right">0.520</td>
    <td class="gt_row gt_right">46</td>
    <td class="gt_row gt_left">Default</td>
  </tr>
  <tr>
    <td class="gt_row gt_left">LGBM Over</td>
    <td class="gt_row gt_left">Tuned</td>
    <td class="gt_row gt_right">0.500</td>
    <td class="gt_row gt_right">0.020</td>
    <td class="gt_row gt_right">0.759</td>
    <td class="gt_row gt_right">0.440</td>
    <td class="gt_row gt_right">0.557</td>
    <td class="gt_row gt_right">0.480</td>
    <td class="gt_row gt_right">0.004</td>
    <td class="gt_row gt_right">0.560</td>
    <td class="gt_row gt_right">29</td>
    <td class="gt_row gt_left">Default</td>
  </tr>
  <tr>
    <td class="gt_row gt_left">LGBM Weighted</td>
    <td class="gt_row gt_left">Not</td>
    <td class="gt_row gt_right">0.500</td>
    <td class="gt_row gt_right">0.045</td>
    <td class="gt_row gt_right">0.500</td>
    <td class="gt_row gt_right">0.500</td>
    <td class="gt_row gt_right">0.500</td>
    <td style="color: #0072B2;font-weight: 800;" class="gt_row gt_right">0.500</td>
    <td class="gt_row gt_right">0.016</td>
    <td class="gt_row gt_right">0.500</td>
    <td class="gt_row gt_right">50</td>
    <td class="gt_row gt_left">Default</td>
  </tr>
  <tr>
    <td class="gt_row gt_left">LGBM Weighted</td>
    <td class="gt_row gt_left">Tuned</td>
    <td class="gt_row gt_right">0.500</td>
    <td class="gt_row gt_right">0.051</td>
    <td class="gt_row gt_right">0.500</td>
    <td class="gt_row gt_right">0.460</td>
    <td class="gt_row gt_right">0.479</td>
    <td class="gt_row gt_right">0.467</td>
    <td class="gt_row gt_right">0.015</td>
    <td class="gt_row gt_right">0.540</td>
    <td class="gt_row gt_right">46</td>
    <td class="gt_row gt_left">Default</td>
  </tr>
</tbody>
  <tfoot class="gt_sourcenotes">
  
  <tr>
    <td class="gt_sourcenote" colspan="12">(T) means that classification is based on an optimal threshold, but the model is the same as the corresponding "Basic" model. See the supplemental section for details.</td>
  </tr>

</tfoot>

</table>

</div>
        
</div>
</div>
</figure>
</div>
</div>
<p>There’s more to digest here, but in general we see the following:</p>
<ul>
<li>Unsurprisingly, these models did better than the logistic model approaches.</li>
<li>The basic model with or without thresholding/tuning did better on several metrics than the weighted and resampling approaches.</li>
<li>The issues with weighting and resampling were far less pronounced in the LGBM models, but were still present. For example, the mean predictions are higher than the basic models, and higher than the base rate, except for the over-sampled with tuning model.</li>
<li>We also saw that the thresholding approach still led to far more predicted positives than would be expected, and with it, a higher false positive rate.</li>
</ul>
<p>A couple other things to note. One model has perfect precision! However it comes at the cost of the highest false negative rate/lowest recall. In addition, our optimal threshold was chosen based on the value that maximized F2, but that model did not have the highest F2 score of all models. They did have the highest recall however, which is what F2 puts more weight on.</p>
<p>Now let’s look at the probability-based metrics. Again the thresholding results are removed as they aren’t applicable and duplicate the basic models.</p>
<div class="cell" data-execution_count="16">
<div id="tbl-prob-metrics-lgbm" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="16">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-prob-metrics-lgbm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;7: Test Set Model Probability Metrics for LGBM Model
</figcaption>
<div aria-describedby="tbl-prob-metrics-lgbm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="16">
<div id="gtdzqasuoe" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>
#gtdzqasuoe table {
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
        }

#gtdzqasuoe thead, tbody, tfoot, tr, td, th { border-style: none; }
 tr { background-color: transparent; }
#gtdzqasuoe p { margin: 0; padding: 0; }
 #gtdzqasuoe .gt_table { display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 2px; border-top-color: #A8A8A8; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #A8A8A8; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; }
 #gtdzqasuoe .gt_caption { padding-top: 4px; padding-bottom: 4px; }
 #gtdzqasuoe .gt_title { color: #333333; font-size: 125%; font-weight: initial; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; border-bottom-color: #FFFFFF; border-bottom-width: 0; }
 #gtdzqasuoe .gt_subtitle { color: #333333; font-size: 85%; font-weight: initial; padding-top: 3px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; border-top-color: #FFFFFF; border-top-width: 0; }
 #gtdzqasuoe .gt_heading { background-color: #FFFFFF; text-align: center; border-bottom-color: #FFFFFF; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #gtdzqasuoe .gt_bottom_border { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; }
 #gtdzqasuoe .gt_col_headings { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #gtdzqasuoe .gt_col_heading { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; }
 #gtdzqasuoe .gt_column_spanner_outer { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 4px; }
 #gtdzqasuoe .gt_column_spanner_outer:first-child { padding-left: 0; }
 #gtdzqasuoe .gt_column_spanner_outer:last-child { padding-right: 0; }
 #gtdzqasuoe .gt_column_spanner { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; overflow-x: hidden; display: inline-block; width: 100%; }
 #gtdzqasuoe .gt_spanner_row { border-bottom-style: hidden; }
 #gtdzqasuoe .gt_group_heading { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; text-align: left; }
 #gtdzqasuoe .gt_empty_group_heading { padding: 0.5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: middle; }
 #gtdzqasuoe .gt_from_md> :first-child { margin-top: 0; }
 #gtdzqasuoe .gt_from_md> :last-child { margin-bottom: 0; }
 #gtdzqasuoe .gt_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; }
 #gtdzqasuoe .gt_stub { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; }
 #gtdzqasuoe .gt_stub_row_group { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; vertical-align: top; }
 #gtdzqasuoe .gt_row_group_first td { border-top-width: 2px; }
 #gtdzqasuoe .gt_row_group_first th { border-top-width: 2px; }
 #gtdzqasuoe .gt_striped { background-color: rgba(128,128,128,0.05); }
 #gtdzqasuoe .gt_table_body { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; }
 #gtdzqasuoe .gt_sourcenotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; }
 #gtdzqasuoe .gt_sourcenote { font-size: 90%; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; text-align: left; }
 #gtdzqasuoe .gt_left { text-align: left; }
 #gtdzqasuoe .gt_center { text-align: center; }
 #gtdzqasuoe .gt_right { text-align: right; font-variant-numeric: tabular-nums; }
 #gtdzqasuoe .gt_font_normal { font-weight: normal; }
 #gtdzqasuoe .gt_font_bold { font-weight: bold; }
 #gtdzqasuoe .gt_font_italic { font-style: italic; }
 #gtdzqasuoe .gt_super { font-size: 65%; }
 #gtdzqasuoe .gt_footnote_marks { font-size: 75%; vertical-align: 0.4em; position: initial; }
 #gtdzqasuoe .gt_asterisk { font-size: 100%; vertical-align: 0; }
 
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>

<tr class="gt_col_headings">
  <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Model">Model</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Tuned">Tuned</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Threshold">Threshold</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Mean Pred">Mean Pred</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="AUROC">AUROC</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Avg Prec">Avg Prec</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Brier Score">Brier Score</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="ACE">ACE</th>
</tr>
</thead>
<tbody class="gt_table_body">
  <tr>
    <td class="gt_row gt_left">LGBM Basic</td>
    <td class="gt_row gt_left">Not</td>
    <td class="gt_row gt_right">0.500</td>
    <td class="gt_row gt_right">0.022</td>
    <td style="color: #0072B2;font-weight: 800;" class="gt_row gt_right">0.878</td>
    <td class="gt_row gt_right">0.521</td>
    <td style="color: #0072B2;font-weight: 800;" class="gt_row gt_right">0.019</td>
    <td class="gt_row gt_right">0.011</td>
  </tr>
  <tr>
    <td class="gt_row gt_left">LGBM Basic</td>
    <td class="gt_row gt_left">Tuned</td>
    <td class="gt_row gt_right">0.500</td>
    <td class="gt_row gt_right">0.028</td>
    <td class="gt_row gt_right">0.876</td>
    <td class="gt_row gt_right">0.510</td>
    <td class="gt_row gt_right">0.020</td>
    <td style="color: #0072B2;font-weight: 800;" class="gt_row gt_right">0.008</td>
  </tr>
  <tr>
    <td class="gt_row gt_left">LGBM Over</td>
    <td class="gt_row gt_left">Not</td>
    <td class="gt_row gt_right">0.500</td>
    <td class="gt_row gt_right">0.041</td>
    <td class="gt_row gt_right">0.849</td>
    <td class="gt_row gt_right">0.515</td>
    <td class="gt_row gt_right">0.026</td>
    <td class="gt_row gt_right">0.031</td>
  </tr>
  <tr>
    <td class="gt_row gt_left">LGBM Over</td>
    <td class="gt_row gt_left">Tuned</td>
    <td class="gt_row gt_right">0.500</td>
    <td class="gt_row gt_right">0.020</td>
    <td class="gt_row gt_right">0.850</td>
    <td style="color: #0072B2;font-weight: 800;" class="gt_row gt_right">0.526</td>
    <td class="gt_row gt_right">0.020</td>
    <td class="gt_row gt_right">0.014</td>
  </tr>
  <tr>
    <td class="gt_row gt_left">LGBM Weighted</td>
    <td class="gt_row gt_left">Not</td>
    <td class="gt_row gt_right">0.500</td>
    <td class="gt_row gt_right">0.045</td>
    <td class="gt_row gt_right">0.852</td>
    <td class="gt_row gt_right">0.519</td>
    <td class="gt_row gt_right">0.027</td>
    <td class="gt_row gt_right">0.029</td>
  </tr>
  <tr>
    <td class="gt_row gt_left">LGBM Weighted</td>
    <td class="gt_row gt_left">Tuned</td>
    <td class="gt_row gt_right">0.500</td>
    <td class="gt_row gt_right">0.051</td>
    <td class="gt_row gt_right">0.850</td>
    <td class="gt_row gt_right">0.518</td>
    <td class="gt_row gt_right">0.027</td>
    <td class="gt_row gt_right">0.034</td>
  </tr>
</tbody>
  <tfoot class="gt_sourcenotes">
  
  <tr>
    <td class="gt_sourcenote" colspan="8">(T) means that classification is based on an optimal threshold, but the model is the same as the corresponding "Basic" model. See the supplemental section for details.</td>
  </tr>

</tfoot>

</table>

</div>
        
</div>
</div>
</figure>
</div>
</div>
<p>Much the same story - neither weighting nor over-sampling helped much here. In general, all models performed pretty similarly on these metrics, though we might think the basic models did a bit better on AUROC.</p>
</section>
</section>
<section id="discussion" class="level2">
<h2 class="anchored" data-anchor-id="discussion">Discussion</h2>
<p>In general, any of these model approaches might be viable, as the choice may depend mostly on your tolerance for certain types of classification errors. For example, if you are more concerned with false positives, i.e.&nbsp;you really don’t want to classify a wine as good if it’s not, you might *not* prefer the thresholding models, or maybe use a thresholding approach that emphasizes precision. On the other hand, if you are more concerned with correctly judging a good wine as good, you might prefer the thresholding LGBM models that did better on recall.</p>
<p>It’s worth pointing out that many metrics are very correlated with, or even directly dependent, upon one another. For example, if positive predictions are increased with a lower threshold, then the true positive rate will potentially increase, but the false positive rate might increase as well. Any metrics that are based on these rates will also necessarily change. This is why it’s important to consider the actual classifications and the trade-offs that come with them. Choosing a model based on one metric may be essentially equivalent to choosing one based on another metric.</p>
<p>Note again that several of the metrics are based on the predicted probabilities, not the classifications, so the reported value will not change with the classification threshold. For model selection, you might be better off using these, or the standard loss function for the model, rather than the classification metrics that can be easily manipulated. This would be more the case in smaller data settings or very rare positive rates, where metric values could swing wildly with only slightly different classifications.</p>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>In this post, we explored various techniques for handling imbalanced data, including sampling-based and algorithmic methods. We demonstrated the impact of different classification thresholds on performance metrics, and discussed the importance of selecting appropriate metrics for the situation. Our case study on wine quality data highlighted the practical application of these techniques and their effect on model performance. In general, we saw that simple approaches often work well.</p>
<p>Key takeaways:</p>
<ul>
<li>Imbalanced data is common in real-world settings, and can lead to issues with various model performance metrics.</li>
<li>There are a number of ways to approach imbalanced data, including sampling-based and algorithmic techniques.</li>
<li>Using the default classification threshold of 0.5 may not be appropriate for classification with imbalanced data, and selecting an optimal threshold may prove beneficial.</li>
<li>Depending on the setting, <em>you can do nothing and possibly be just fine</em>. But if you need to do something, simple approaches often do the job.</li>
<li>With metrics that depend on classification, you need to carefully consider the trade-offs that come with them.</li>
<li>Focusing on metrics that don’t rely on classification threshold can potentially help you avoid the pitfalls associated with class imbalance.</li>
</ul>
<p>In conclusion, while class imbalance may present challenges for model development and evaluation, the solutions need not be complex. The key is to understand your specific use case—what types of errors are most costly, what metrics align with your goals, and what trade-offs you’re willing to make. Hopefully this exploration has provided you with practical insights and a clear framework for tackling imbalanced data in your own work.</p>
</section>
<section id="sec-supplemental" class="level2">
<h2 class="anchored" data-anchor-id="sec-supplemental">Supplemental</h2>
<section id="sec-supp-metrics" class="level3">
<h3 class="anchored" data-anchor-id="sec-supp-metrics">Table Metrics</h3>
<p>The first table for logistic and LGBM models shows the following metrics. An arrow (↑ or ↓) indicates whether a higher or lower value is better for the metric.</p>
<ul>
<li><em>Threshold</em>: the threshold value used for classification.</li>
<li><em>Mean Pred</em>: the mean predicted probability for the positive class. Ideally this should be close to the observed proportion of positive cases.</li>
<li><em>Precision</em>: the proportion of correctly predicted positive cases among all predicted positive cases. ↑</li>
<li><em>Recall</em>: the proportion of correctly predicted positive cases among all actual positive cases. ↑</li>
<li><em>F1 Score</em>: the harmonic mean of precision and recall. ↑</li>
<li><em>F2 Score</em>: a variant of the F1 score that gives more weight to recall. ↑</li>
<li><em>FPR</em>: False Positive Rate, the proportion of incorrectly predicted positive cases among all actual negative cases. ↓</li>
<li><em>FNR</em>: False Negative Rate, the proportion of incorrectly predicted negative cases among all actual positive cases. ↓</li>
<li><em>Total Pos Pred</em>: the total number of positive predictions.</li>
<li><em>Threshold Method</em>: the method used to select the classification threshold.</li>
</ul>
<p>The second table shows the following metrics:</p>
<ul>
<li><em>Threshold</em>: the threshold/cutoff value used for classification.</li>
<li><em>Mean Pred</em>: the mean predicted probability for the positive class.</li>
<li><em>AUROC</em>: the area under the receiver operating characteristic curve. ↑</li>
<li><em>Avg Prec</em>: the average precision (area under the precision-recall curve). ↑</li>
<li><em>Brier Score</em>: a measure of the mean squared difference between predicted probabilities and the true outcome. ↓</li>
<li><em>ACE</em>: the adaptive calibration error (<span class="citation" data-cites="nixon_measuring_2020">Nixon et al. (<a href="#ref-nixon_measuring_2020" role="doc-biblioref">2020</a>)</span>). ↓</li>
</ul>
</section>
<section id="sec-supp-multiclass" class="level3">
<h3 class="anchored" data-anchor-id="sec-supp-multiclass">Brief Discussion of the Multiclass Setting</h3>
<p>While we’ve focused on binary classification, many real-world problems involve more than two classes. Multiclass settings can present additional challenges with imbalanced data, as the relationships between classes become more complex and the interpretation of performance metrics needs adjustment.</p>
<p>In multiclass settings, we often use the same core metrics as in binary classification (precision, recall, F1, etc.), but we need to consider how to aggregate these metrics across classes. Two common approaches are:</p>
<p><strong>Weighted Average</strong>: This approach takes into account the number of instances in each class. Each class’s metric is weighted by the proportion of instances in that class. It may be useful when you want to account for class imbalance to ensure that metrics from larger classes have a greater impact on the overall score.</p>
<p><strong>Macro Average</strong>: This approach calculates the metric independently for each class and then takes the average of these metrics. Each class is treated equally, regardless of its size. It is useful when you want to ensure that the model performance assessment is consistent across all classes, rather than being dominated by the performance on the more frequent classes.</p>
<p>As in the binary case, the choice between these approaches depends on your specific goals. Use weighted averaging when you want metrics to reflect the natural class distribution, and macro averaging when you want to ensure consistent performance across all classes.</p>
</section>
<section id="sec-supp-thresh" class="level3">
<h3 class="anchored" data-anchor-id="sec-supp-thresh">Choosing a Classification Threshold</h3>
<p>As we have noted, the default threshold of 0.5 is often used as a classification threshold, but it may not be optimal in many cases, particularly in the imbalanced setting. Each of these and other similar methods have their own advantages and may be suitable for different scenarios. Here are some common methods for selecting a classification threshold:</p>
<ol type="1">
<li><p><strong>Metric Optimization</strong>: Choose a threshold that maximizes or minimizes a specific metric:</p>
<ul>
<li><strong>F-Beta Scores</strong>: Adjust the β parameter to weight the relative importance of precision vs.&nbsp;recall. <span class="math inline">\(F_1\)</span> gives equal weight, <span class="math inline">\(F_2\)</span> favors recall, and <span class="math inline">\(F_{.5}\)</span> favors precision.</li>
<li><strong>Precision-Recall Trade-off</strong>: Select a threshold based on the precision-recall curve to achieve desired balance between these metrics.</li>
<li><strong>ROC-based</strong>: Choose the threshold that maximizes the geometric mean of sensitivity and specificity.</li>
</ul></li>
<li><p><strong>Cost-Sensitive Thresholding</strong>: This involves selecting a threshold that minimizes the overall cost of misclassification. This can be done by assigning different weights to false positives and false negatives and choosing the threshold that results in the lowest weighted error. This does not require an algorithmic approach though, as you can just select a threshold based on domain knowledge.</p></li>
<li><p><strong>Other Statistical Approaches</strong>:</p>
<ul>
<li><strong>Youden’s J Statistic</strong>: Youden’s J is defined as sensitivity + specificity - 1. This approach maximizes the sum of sensitivity and specificity, and is equivalent to maximizing vertical distance from ROC curve to diagonal.</li>
<li><strong>Equal Error Rate (EER)</strong>: Sets threshold where false positive rate equals false negative rate.</li>
</ul></li>
<li><p><strong>Data-driven</strong>: Use the observed class proportion (base rate) as the threshold, which may be appropriate when you want predictions to reflect the natural class distribution. This is simple and good for a quick baseline, but may not be optimal in all cases.</p></li>
</ol>
<p>For this post, we explored using different thresholds out of curiosity, and here are the results for the LGBM (Basic) models, and only those metrics that are actually affected by the threshold. The different methods explored included optimizing AUROC (<code>ROC</code>), AUPRC (<code>PRC</code>), F.5, F1, and F2 (<code>F*</code>), and simply using the base rate/observed proportion as a cutoff (<code>Obs. Prop.</code>). In the following, the untuned model parameters are identical, and the tuned models are also identical. Within each of those groups, the only difference is the threshold method used. All metrics regard the test set.</p>
<div class="cell" data-execution_count="18">
<div id="tbl-threshold-methods" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="18">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-threshold-methods-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;8: Comparison of Threshold Methods for the LGBM Models
</figcaption>
<div aria-describedby="tbl-threshold-methods-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="18">
<div id="zayyrdudda" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>
#zayyrdudda table {
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
        }

#zayyrdudda thead, tbody, tfoot, tr, td, th { border-style: none; }
 tr { background-color: transparent; }
#zayyrdudda p { margin: 0; padding: 0; }
 #zayyrdudda .gt_table { display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 2px; border-top-color: #A8A8A8; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #A8A8A8; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; }
 #zayyrdudda .gt_caption { padding-top: 4px; padding-bottom: 4px; }
 #zayyrdudda .gt_title { color: #333333; font-size: 125%; font-weight: initial; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; border-bottom-color: #FFFFFF; border-bottom-width: 0; }
 #zayyrdudda .gt_subtitle { color: #333333; font-size: 85%; font-weight: initial; padding-top: 3px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; border-top-color: #FFFFFF; border-top-width: 0; }
 #zayyrdudda .gt_heading { background-color: #FFFFFF; text-align: center; border-bottom-color: #FFFFFF; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #zayyrdudda .gt_bottom_border { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; }
 #zayyrdudda .gt_col_headings { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #zayyrdudda .gt_col_heading { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; }
 #zayyrdudda .gt_column_spanner_outer { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 4px; }
 #zayyrdudda .gt_column_spanner_outer:first-child { padding-left: 0; }
 #zayyrdudda .gt_column_spanner_outer:last-child { padding-right: 0; }
 #zayyrdudda .gt_column_spanner { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; overflow-x: hidden; display: inline-block; width: 100%; }
 #zayyrdudda .gt_spanner_row { border-bottom-style: hidden; }
 #zayyrdudda .gt_group_heading { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; text-align: left; }
 #zayyrdudda .gt_empty_group_heading { padding: 0.5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: middle; }
 #zayyrdudda .gt_from_md> :first-child { margin-top: 0; }
 #zayyrdudda .gt_from_md> :last-child { margin-bottom: 0; }
 #zayyrdudda .gt_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; }
 #zayyrdudda .gt_stub { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; }
 #zayyrdudda .gt_stub_row_group { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; vertical-align: top; }
 #zayyrdudda .gt_row_group_first td { border-top-width: 2px; }
 #zayyrdudda .gt_row_group_first th { border-top-width: 2px; }
 #zayyrdudda .gt_striped { background-color: rgba(128,128,128,0.05); }
 #zayyrdudda .gt_table_body { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; }
 #zayyrdudda .gt_sourcenotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; }
 #zayyrdudda .gt_sourcenote { font-size: 90%; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; text-align: left; }
 #zayyrdudda .gt_left { text-align: left; }
 #zayyrdudda .gt_center { text-align: center; }
 #zayyrdudda .gt_right { text-align: right; font-variant-numeric: tabular-nums; }
 #zayyrdudda .gt_font_normal { font-weight: normal; }
 #zayyrdudda .gt_font_bold { font-weight: bold; }
 #zayyrdudda .gt_font_italic { font-style: italic; }
 #zayyrdudda .gt_super { font-size: 65%; }
 #zayyrdudda .gt_footnote_marks { font-size: 75%; vertical-align: 0.4em; position: initial; }
 #zayyrdudda .gt_asterisk { font-size: 100%; vertical-align: 0; }
 
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>

<tr class="gt_col_headings">
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Threshold">Threshold</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Precision">Precision</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Recall">Recall</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="F.5 Score">F.5 Score</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="F1 Score">F1 Score</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="F2 Score">F2 Score</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="FPR">FPR</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="FNR">FNR</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Total Pos Pred">Total Pos Pred</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Tuned">Tuned</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Optimization Method">Optimization Method</th>
</tr>
</thead>
<tbody class="gt_table_body">
  <tr>
    <td class="gt_row gt_right">0.00</td>
    <td class="gt_row gt_right">0.09</td>
    <td class="gt_row gt_right">0.82</td>
    <td class="gt_row gt_right">0.12</td>
    <td class="gt_row gt_right">0.17</td>
    <td class="gt_row gt_right">0.32</td>
    <td class="gt_row gt_right">0.25</td>
    <td class="gt_row gt_right">0.18</td>
    <td class="gt_row gt_right">433</td>
    <td class="gt_row gt_left">Not</td>
    <td class="gt_row gt_left">ROC</td>
  </tr>
  <tr>
    <td class="gt_row gt_right">0.72</td>
    <td class="gt_row gt_right">1.00</td>
    <td class="gt_row gt_right">0.40</td>
    <td class="gt_row gt_right">0.77</td>
    <td class="gt_row gt_right">0.57</td>
    <td class="gt_row gt_right">0.45</td>
    <td class="gt_row gt_right">0.00</td>
    <td class="gt_row gt_right">0.60</td>
    <td class="gt_row gt_right">20</td>
    <td class="gt_row gt_left">Not</td>
    <td class="gt_row gt_left">F.5</td>
  </tr>
  <tr>
    <td class="gt_row gt_right">0.58</td>
    <td class="gt_row gt_right">0.91</td>
    <td class="gt_row gt_right">0.42</td>
    <td class="gt_row gt_right">0.74</td>
    <td class="gt_row gt_right">0.58</td>
    <td class="gt_row gt_right">0.47</td>
    <td class="gt_row gt_right">0.00</td>
    <td class="gt_row gt_right">0.58</td>
    <td class="gt_row gt_right">23</td>
    <td class="gt_row gt_left">Not</td>
    <td class="gt_row gt_left">F1</td>
  </tr>
  <tr>
    <td class="gt_row gt_right">0.03</td>
    <td class="gt_row gt_right">0.26</td>
    <td class="gt_row gt_right">0.62</td>
    <td class="gt_row gt_right">0.29</td>
    <td class="gt_row gt_right">0.36</td>
    <td class="gt_row gt_right">0.48</td>
    <td class="gt_row gt_right">0.06</td>
    <td class="gt_row gt_right">0.38</td>
    <td class="gt_row gt_right">121</td>
    <td class="gt_row gt_left">Not</td>
    <td class="gt_row gt_left">F2</td>
  </tr>
  <tr>
    <td class="gt_row gt_right">0.72</td>
    <td class="gt_row gt_right">1.00</td>
    <td class="gt_row gt_right">0.40</td>
    <td class="gt_row gt_right">0.77</td>
    <td class="gt_row gt_right">0.57</td>
    <td class="gt_row gt_right">0.45</td>
    <td class="gt_row gt_right">0.00</td>
    <td class="gt_row gt_right">0.60</td>
    <td class="gt_row gt_right">20</td>
    <td class="gt_row gt_left">Not</td>
    <td class="gt_row gt_left">PRC</td>
  </tr>
  <tr>
    <td class="gt_row gt_right">0.03</td>
    <td class="gt_row gt_right">0.26</td>
    <td class="gt_row gt_right">0.60</td>
    <td class="gt_row gt_right">0.29</td>
    <td class="gt_row gt_right">0.36</td>
    <td class="gt_row gt_right">0.48</td>
    <td class="gt_row gt_right">0.05</td>
    <td class="gt_row gt_right">0.40</td>
    <td class="gt_row gt_right">115</td>
    <td class="gt_row gt_left">Not</td>
    <td class="gt_row gt_left">Obs. Prop.</td>
  </tr>
  <tr>
    <td class="gt_row gt_right">0.06</td>
    <td class="gt_row gt_right">0.23</td>
    <td class="gt_row gt_right">0.66</td>
    <td class="gt_row gt_right">0.26</td>
    <td class="gt_row gt_right">0.34</td>
    <td class="gt_row gt_right">0.48</td>
    <td class="gt_row gt_right">0.07</td>
    <td class="gt_row gt_right">0.34</td>
    <td class="gt_row gt_right">145</td>
    <td class="gt_row gt_left">Tuned</td>
    <td class="gt_row gt_left">ROC</td>
  </tr>
  <tr>
    <td class="gt_row gt_right">0.45</td>
    <td class="gt_row gt_right">0.95</td>
    <td class="gt_row gt_right">0.36</td>
    <td class="gt_row gt_right">0.71</td>
    <td class="gt_row gt_right">0.52</td>
    <td class="gt_row gt_right">0.41</td>
    <td class="gt_row gt_right">0.00</td>
    <td class="gt_row gt_right">0.64</td>
    <td class="gt_row gt_right">19</td>
    <td class="gt_row gt_left">Tuned</td>
    <td class="gt_row gt_left">F.5</td>
  </tr>
  <tr>
    <td class="gt_row gt_right">0.34</td>
    <td class="gt_row gt_right">0.75</td>
    <td class="gt_row gt_right">0.42</td>
    <td class="gt_row gt_right">0.65</td>
    <td class="gt_row gt_right">0.54</td>
    <td class="gt_row gt_right">0.46</td>
    <td class="gt_row gt_right">0.00</td>
    <td class="gt_row gt_right">0.58</td>
    <td class="gt_row gt_right">28</td>
    <td class="gt_row gt_left">Tuned</td>
    <td class="gt_row gt_left">F1</td>
  </tr>
  <tr>
    <td class="gt_row gt_right">0.06</td>
    <td class="gt_row gt_right">0.23</td>
    <td class="gt_row gt_right">0.66</td>
    <td class="gt_row gt_right">0.26</td>
    <td class="gt_row gt_right">0.34</td>
    <td class="gt_row gt_right">0.48</td>
    <td class="gt_row gt_right">0.07</td>
    <td class="gt_row gt_right">0.34</td>
    <td class="gt_row gt_right">145</td>
    <td class="gt_row gt_left">Tuned</td>
    <td class="gt_row gt_left">F2</td>
  </tr>
  <tr>
    <td class="gt_row gt_right">0.40</td>
    <td class="gt_row gt_right">0.90</td>
    <td class="gt_row gt_right">0.38</td>
    <td class="gt_row gt_right">0.71</td>
    <td class="gt_row gt_right">0.54</td>
    <td class="gt_row gt_right">0.43</td>
    <td class="gt_row gt_right">0.00</td>
    <td class="gt_row gt_right">0.62</td>
    <td class="gt_row gt_right">21</td>
    <td class="gt_row gt_left">Tuned</td>
    <td class="gt_row gt_left">PRC</td>
  </tr>
  <tr>
    <td class="gt_row gt_right">0.03</td>
    <td class="gt_row gt_right">0.13</td>
    <td class="gt_row gt_right">0.68</td>
    <td class="gt_row gt_right">0.15</td>
    <td class="gt_row gt_right">0.21</td>
    <td class="gt_row gt_right">0.36</td>
    <td class="gt_row gt_right">0.15</td>
    <td class="gt_row gt_right">0.32</td>
    <td class="gt_row gt_right">270</td>
    <td class="gt_row gt_left">Tuned</td>
    <td class="gt_row gt_left">Obs. Prop.</td>
  </tr>
</tbody>


</table>

</div>
        
</div>
</div>
</figure>
</div>
</div>
<p>In our case study, thresholding that was relatively more focused on precision (F.5/AUPRC) led to a high threshold, few positive predictions, and a low false positive rate. Thresholding that was relatively more focused on recall (F2) led to a notably lower threshold than .5, more positive predictions, and a higher false positive rate. The geometric mean/ROC approach led to the most positive predictions, and thus a notably high false positive rate, but also a lower false negative rate. By coincidence, the ROC and F2 approaches led to the same classification for the tuned model.</p>
<p>We ultimately chose the F2 threshold approach for the reported tables because we were interested in recall, and the ROC approach led to too many positives for the untuned model. However, there’s no reason for this choice other than our personal preference, and the other approaches could be just as valid depending on your own goals for wine classification. Cheers! 🍷</p>



</section>
</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-brownlee_how_2018" class="csl-entry" role="listitem">
Brownlee, Jason. 2018. <span>“How to <span>Use</span> <span>ROC</span> <span>Curves</span> and <span>Precision</span>-<span>Recall</span> <span>Curves</span> for <span>Classification</span> in <span>Python</span>.”</span> <em>MachineLearningMastery.com</em>. <a href="https://www.machinelearningmastery.com/roc-curves-and-precision-recall-curves-for-classification-in-python/">https://www.machinelearningmastery.com/roc-curves-and-precision-recall-curves-for-classification-in-python/</a>.
</div>
<div id="ref-elor_smote_2022" class="csl-entry" role="listitem">
Elor, Yotam, and Hadar Averbuch-Elor. 2022. <span>“To <span>SMOTE</span>, or Not to <span>SMOTE</span>?”</span> arXiv. <a href="https://doi.org/10.48550/arXiv.2201.08528">https://doi.org/10.48550/arXiv.2201.08528</a>.
</div>
<div id="ref-foret_sharpness-aware_2021" class="csl-entry" role="listitem">
Foret, Pierre, Ariel Kleiner, Hossein Mobahi, and Behnam Neyshabur. 2021. <span>“Sharpness-<span>Aware</span> <span>Minimization</span> for <span>Efficiently</span> <span>Improving</span> <span>Generalization</span>.”</span> arXiv. <a href="https://doi.org/10.48550/arXiv.2010.01412">https://doi.org/10.48550/arXiv.2010.01412</a>.
</div>
<div id="ref-google_classification_2025" class="csl-entry" role="listitem">
Google. 2025. <span>“Classification: <span>ROC</span> and <span>AUC</span> <span></span> <span>Machine</span> <span>Learning</span>.”</span> <em>Google for Developers</em>. <a href="https://developers.google.com/machine-learning/crash-course/classification/roc-and-auc">https://developers.google.com/machine-learning/crash-course/classification/roc-and-auc</a>.
</div>
<div id="ref-van_den_goorbergh_harm_2022" class="csl-entry" role="listitem">
Goorbergh, Ruben van den, Maarten van Smeden, Dirk Timmerman, and Ben Van Calster. 2022. <span>“The Harm of Class Imbalance Corrections for Risk Prediction Models: Illustration and Simulation Using Logistic Regression.”</span> <em>Journal of the American Medical Informatics Association: JAMIA</em> 29 (9): 1525–34. <a href="https://doi.org/10.1093/jamia/ocac093">https://doi.org/10.1093/jamia/ocac093</a>.
</div>
<div id="ref-harrell_damage_2017" class="csl-entry" role="listitem">
Harrell, Frank. 2017. <span>“Damage <span>Caused</span> by <span>Classification</span> <span>Accuracy</span> and <span>Other</span> <span>Discontinuous</span> <span>Improper</span> <span>Accuracy</span> <span>Scoring</span> <span>Rules</span>.”</span> <em>Statistical Thinking</em>. <a href="https://www.fharrell.com/post/class-damage/">https://www.fharrell.com/post/class-damage/</a>.
</div>
<div id="ref-kuhn_optimizing_2014" class="csl-entry" role="listitem">
Kuhn, Max. 2014. <span>“Optimizing <span>Probability</span> <span>Thresholds</span> for <span>Class</span> <span>Imbalances</span>.”</span> <em>Applied Predictive Modeling</em>. <a href="http://appliedpredictivemodeling.com/blog/2014/2/1/lw6har9oewknvus176q4o41alqw2ow">http://appliedpredictivemodeling.com/blog/2014/2/1/lw6har9oewknvus176q4o41alqw2ow</a>.
</div>
<div id="ref-lin_focal_2018" class="csl-entry" role="listitem">
Lin, Tsung-Yi, Priya Goyal, Ross Girshick, Kaiming He, and Piotr Dollár. 2018. <span>“Focal <span>Loss</span> for <span>Dense</span> <span>Object</span> <span>Detection</span>.”</span> arXiv. <a href="https://doi.org/10.48550/arXiv.1708.02002">https://doi.org/10.48550/arXiv.1708.02002</a>.
</div>
<div id="ref-molnar_dont_2023" class="csl-entry" role="listitem">
Molnar, Christoph. 2023. <span>“Don’t "Fix" Your Imbalanced Data.”</span> Substack newsletter. <em>Mindful Modeler</em>. <a href="https://mindfulmodeler.substack.com/p/dont-fix-your-imbalanced-data">https://mindfulmodeler.substack.com/p/dont-fix-your-imbalanced-data</a>.
</div>
<div id="ref-nixon_measuring_2020" class="csl-entry" role="listitem">
Nixon, Jeremy, Michael W Dusenberry, Linchuan Zhang, Ghassen Jerfel, and Dustin Tran. 2020. <span>“Measuring <span>Calibration</span> in <span>Deep</span> <span>Learning</span>.”</span> <a href="https://arxiv.org/abs/1904.01685">https://arxiv.org/abs/1904.01685</a>.
</div>
<div id="ref-shwartz-ziv_simplifying_2022" class="csl-entry" role="listitem">
Shwartz-Ziv, Ravid, Micah Goldblum, Yucen Lily Li, C Bayan Bruss, and Andrew Gordon Wilson. 2022. <span>“Simplifying <span>Neural</span> <span>Network</span> <span>Training</span> <span>Under</span> <span>Class</span> <span>Imbalance</span>.”</span> <a href="https://arxiv.org/abs/2312.02517">https://arxiv.org/abs/2312.02517</a>.
</div>
<div id="ref-thomas_problem_2020" class="csl-entry" role="listitem">
Thomas, Rachel, and David Uminsky. 2020. <span>“The <span>Problem</span> with <span>Metrics</span> Is a <span>Fundamental</span> <span>Problem</span> for <span>AI</span>.”</span> arXiv. <a href="https://doi.org/10.48550/arXiv.2002.08512">https://doi.org/10.48550/arXiv.2002.08512</a>.
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p><span class="citation" data-cites="shwartz-ziv_simplifying_2022">Shwartz-Ziv et al. (<a href="#ref-shwartz-ziv_simplifying_2022" role="doc-biblioref">2022</a>)</span> provides a nice overview.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Homogenous data has features that are generally from the same source and/or are the same type. For example, a dataset of images would be homogenous, as would a dataset of text. In those settings we likely would only be considering deep learning models, and so the techniques mentioned would be more applicable. In contrast, tabular data is often heterogeneous, with different types of features, and so the techniques mentioned <a href="https://m-clark.github.io/posts/2022-04-01-more-dl-for-tabular/">may not be as performant</a>.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>It could also go the other way for disease detection, where the cost of a false positive would result in costly or invasive procedures, and so a higher threshold would be preferred. But typically it would likely just result in more testing to confirm the diagnosis, which is not ideal but not as costly.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>The false positive rate is the complement of the true negative rate, so it is 1 - TNR from the table.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>There is a way to approximate AUROC from the confusion matrix, but it is not exact, and would change with the threshold.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>For the weighted models, these default weights are inversely proportional to the class frequencies, meaning the minority class is weighted more heavily while the majority class is weighted less heavily. This is a common default, but it can be adjusted as needed.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7"><p>We don’t look at SMOTE and related techniques, both to keep things simple, and because they rarely outperform simple resampling, especially with models that are typically strong to begin with, like boosting approaches. See <span class="citation" data-cites="molnar_dont_2023">Molnar (<a href="#ref-molnar_dont_2023" role="doc-biblioref">2023</a>)</span> or <span class="citation" data-cites="elor_smote_2022">Elor and Averbuch-Elor (<a href="#ref-elor_smote_2022" role="doc-biblioref">2022</a>)</span> for example.<a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn8"><p>Ideally, if we didn’t just choose a metric to optimize for our threshold ahead of time based on the domain setting, the choice could be made via a separate validation process. For our data, this would have been a very noisy result anyway, so for simplicity we just went with using the test set as the thresholding validation.<a href="#fnref8" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn9"><p>In our exploratory phase we saw that increasing depth appeared to help oversample/weighting approaches (decreased mean prediction, lower brier, ACE, FPR), while less depth and fewer iterations appeared better for the thresholding approach (higher ROC, fewer total positive predictions for thresholding approach).<a href="#fnref9" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn10"><p>The oversampling and weighting approaches are overpredicting and producing nearly identical results, so are not easily distinguished in the visualization. Again this is expected for logistic regression, as weighting and oversampling are essentially equivalent in this case.<a href="#fnref10" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{clark2025,
  author = {Clark, Michael and Clark, Michael},
  title = {Imbalanced {Outcomes}},
  date = {2025-04-07},
  url = {https://m-clark.github.io/posts/2025-04-07-class-imbalance/},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-clark2025" class="csl-entry quarto-appendix-citeas" role="listitem">
Clark, Michael, and Michael Clark. 2025. <span>“Imbalanced
Outcomes.”</span> April 7, 2025. <a href="https://m-clark.github.io/posts/2025-04-07-class-imbalance/">https://m-clark.github.io/posts/2025-04-07-class-imbalance/</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/m-clark\.github\.io");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<div class="share-buttons"><div class="social-share"><a href="https://twitter.com/share?url=https://m-clark.github.io/posts/2025-01-28-class-imbalance/&amp;text=Imbalanced Outcomes: Challenges &amp; Solutions for This Common Situation" target="_blank" class="twitter"><i class="fab fa-twitter fa-fw fa-lg"></i></a><a href="https://www.linkedin.com/shareArticle?url=https://m-clark.github.io/posts/2025-01-28-class-imbalance/&amp;title=Imbalanced Outcomes: Challenges &amp; Solutions for This Common Situation" target="_blank" class="linkedin"><i class="fa-brands fa-linkedin-in fa-fw fa-lg"></i></a>  <a href="mailto:?subject=Imbalanced Outcomes: Challenges &amp; Solutions for This Common Situation&amp;body=Check out this link:https://m-clark.github.io/posts/2025-01-28-class-imbalance/" target="_blank" class="email"><i class="fa-solid fa-envelope fa-fw fa-lg"></i></a><a href="https://www.facebook.com/sharer.php?u=https://m-clark.github.io/posts/2025-01-28-class-imbalance/" target="_blank" class="facebook"><i class="fab fa-facebook-f fa-fw fa-lg"></i></a><a href="https://reddit.com/submit?url=https://m-clark.github.io/posts/2025-01-28-class-imbalance/&amp;title=Imbalanced Outcomes: Challenges &amp; Solutions for This Common Situation" target="_blank" class="reddit">   <i class="fa-brands fa-reddit-alien fa-fw fa-lg"></i></a><a href="https://bsky.app/intent/compose?text=https://m-clark.github.io/posts/2025-01-28-class-imbalance/ Imbalanced Outcomes: Challenges &amp; Solutions for This Common Situation" target="_blank" class="bsky"><i class="fa-brands fa-bluesky"></i></a></div></div>




</body></html>