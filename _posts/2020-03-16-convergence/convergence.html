<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #20794d; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007ba5; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #007ba5; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #007ba5; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #20794d; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

  <!--radix_placeholder_meta_tags-->
  <title>Convergence Problems</title>

  <meta property="description" itemprop="description" content="Lack of convergence got ya down? A plan of attack."/>


  <!--  https://schema.org/Article -->
  <meta property="article:published" itemprop="datePublished" content="2020-03-16"/>
  <meta property="article:created" itemprop="dateCreated" content="2020-03-16"/>
  <meta name="article:author" content="Michael Clark"/>

  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="Convergence Problems"/>
  <meta property="og:type" content="article"/>
  <meta property="og:description" content="Lack of convergence got ya down? A plan of attack."/>
  <meta property="og:locale" content="en_US"/>

  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="Convergence Problems"/>
  <meta property="twitter:description" content="Lack of convergence got ya down? A plan of attack."/>

  <!--/radix_placeholder_meta_tags-->
  
  <meta name="citation_reference" content="citation_title=Parsimonious mixed models;citation_publication_date=2015;citation_author=Douglas Bates;citation_author=Reinhold Kliegl;citation_author=Shravan Vasishth;citation_author=Harald Baayen"/>
  <meta name="citation_reference" content="citation_title=Warning messages when trying to run glmer in r;citation_publication_date=2014;citation_author= StackOverflow"/>
  <meta name="citation_reference" content="citation_title=lme4 convergence warnings: troubleshooting;citation_publication_date=2014;citation_author=Ben Bolker"/>
  <meta name="citation_reference" content="citation_title=lme4 help file for convergence;citation_publication_date=2020;citation_author=Ben Bolker"/>
  <!--radix_placeholder_rmarkdown_metadata-->

  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","date","preview","output","draft","bibliography","nocite","tags","categories"]}},"value":[{"type":"character","attributes":{},"value":["Convergence Problems"]},{"type":"character","attributes":{},"value":["Lack of convergence got ya down? A plan of attack.\n"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","url"]}},"value":[{"type":"character","attributes":{},"value":["Michael Clark"]},{"type":"character","attributes":{},"value":["https://m-clark.github.io"]}]}]},{"type":"character","attributes":{},"value":["2020-03-16"]},{"type":"character","attributes":{},"value":["../../img/convergence/warning.png"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","toc","css"]}},"value":[{"type":"logical","attributes":{},"value":[false]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["../../styles.css"]}]}]},{"type":"logical","attributes":{},"value":[false]},{"type":"character","attributes":{},"value":["conv_references.bib"]},{"type":"character","attributes":{},"value":["@bates2015parsimonious, @stackoverflow2014, @bolker2014, @lme4convergence2020\n"]},{"type":"character","attributes":{},"value":["mixed models","convergence","generalized linear mixed models","random effects","lme4","glmmTMB","lmer","glmer","regression","glm"]},{"type":"character","attributes":{},"value":["regression","mixed models"]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["conv_references.bib","convergence_files/anchor-4.2.2/anchor.min.js","convergence_files/bowser-1.9.3/bowser.min.js","convergence_files/crosstalk-1.0.0/css/crosstalk.css","convergence_files/crosstalk-1.0.0/js/crosstalk.js","convergence_files/crosstalk-1.0.0/js/crosstalk.js.map","convergence_files/crosstalk-1.0.0/js/crosstalk.min.js","convergence_files/crosstalk-1.0.0/js/crosstalk.min.js.map","convergence_files/crosstalk-1.1.0.1/css/crosstalk.css","convergence_files/crosstalk-1.1.0.1/js/crosstalk.js","convergence_files/crosstalk-1.1.0.1/js/crosstalk.js.map","convergence_files/crosstalk-1.1.0.1/js/crosstalk.min.js","convergence_files/crosstalk-1.1.0.1/js/crosstalk.min.js.map","convergence_files/crosstalk-1.1.1/css/crosstalk.css","convergence_files/crosstalk-1.1.1/js/crosstalk.js","convergence_files/crosstalk-1.1.1/js/crosstalk.js.map","convergence_files/crosstalk-1.1.1/js/crosstalk.min.js","convergence_files/crosstalk-1.1.1/js/crosstalk.min.js.map","convergence_files/distill-2.2.21/template.v2.js","convergence_files/figure-html5/glm-issues-1.svg","convergence_files/header-attrs-2.6/header-attrs.js","convergence_files/htmlwidgets-1.5.1/htmlwidgets.js","convergence_files/htmlwidgets-1.5.3/htmlwidgets.js","convergence_files/jquery-1.11.3/jquery-AUTHORS.txt","convergence_files/jquery-1.11.3/jquery.js","convergence_files/jquery-1.11.3/jquery.min.js","convergence_files/jquery-1.11.3/jquery.min.map","convergence_files/jquery-3.5.1/jquery-AUTHORS.txt","convergence_files/jquery-3.5.1/jquery.js","convergence_files/jquery-3.5.1/jquery.min.js","convergence_files/jquery-3.5.1/jquery.min.map","convergence_files/kePrint-0.0.1/kePrint.js","convergence_files/lightable-0.0.1/lightable.css","convergence_files/plotly-binding-4.9.2/plotly.js","convergence_files/plotly-binding-4.9.3/plotly.js","convergence_files/plotly-htmlwidgets-css-1.52.2/plotly-htmlwidgets.css","convergence_files/plotly-htmlwidgets-css-1.57.1/plotly-htmlwidgets.css","convergence_files/plotly-main-1.52.2/plotly-latest.min.js","convergence_files/plotly-main-1.57.1/plotly-latest.min.js","convergence_files/popper-2.6.0/popper.min.js","convergence_files/tippy-6.2.7/tippy-bundle.umd.min.js","convergence_files/tippy-6.2.7/tippy-light-border.css","convergence_files/tippy-6.2.7/tippy.css","convergence_files/tippy-6.2.7/tippy.umd.min.js","convergence_files/typedarray-0.1/typedarray.min.js","convergence_files/webcomponents-2.0.0/webcomponents.js"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

  <style type="text/css">

  body {
    background-color: white;
  }

  .pandoc-table {
    width: 100%;
  }

  .pandoc-table>caption {
    margin-bottom: 10px;
  }

  .pandoc-table th:not([align]) {
    text-align: left;
  }

  .pagedtable-footer {
    font-size: 15px;
  }

  d-byline .byline {
    grid-template-columns: 2fr 2fr;
  }

  d-byline .byline h3 {
    margin-block-start: 1.5em;
  }

  d-byline .byline .authors-affiliations h3 {
    margin-block-start: 0.5em;
  }

  .authors-affiliations .orcid-id {
    width: 16px;
    height:16px;
    margin-left: 4px;
    margin-right: 4px;
    vertical-align: middle;
    padding-bottom: 2px;
  }

  d-title .dt-tags {
    margin-top: 1em;
    grid-column: text;
  }

  .dt-tags .dt-tag {
    text-decoration: none;
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0em 0.4em;
    margin-right: 0.5em;
    margin-bottom: 0.4em;
    font-size: 70%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  d-article table.gt_table td,
  d-article table.gt_table th {
    border-bottom: none;
  }

  .html-widget {
    margin-bottom: 2.0em;
  }

  .l-screen-inset {
    padding-right: 16px;
  }

  .l-screen .caption {
    margin-left: 10px;
  }

  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .shaded-content {
    background: white;
  }

  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }

  .hidden {
    display: none !important;
  }

  d-article {
    padding-top: 2.5rem;
    padding-bottom: 30px;
  }

  d-appendix {
    padding-top: 30px;
  }

  d-article>p>img {
    width: 100%;
  }

  d-article h2 {
    margin: 1rem 0 1.5rem 0;
  }

  d-article h3 {
    margin-top: 1.5rem;
  }

  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }

  /* Tweak code blocks */

  d-article div.sourceCode code,
  d-article pre code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: auto;
  }

  d-article div.sourceCode {
    background-color: white;
  }

  d-article div.sourceCode pre {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }

  d-article pre {
    font-size: 12px;
    color: black;
    background: none;
    margin-top: 0;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  d-article pre a {
    border-bottom: none;
  }

  d-article pre a:hover {
    border-bottom: none;
    text-decoration: underline;
  }

  d-article details {
    grid-column: text;
    margin-bottom: 0.8em;
  }

  @media(min-width: 768px) {

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: visible !important;
  }

  d-article div.sourceCode pre {
    padding-left: 18px;
    font-size: 14px;
  }

  d-article pre {
    font-size: 14px;
  }

  }

  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  /* CSS for d-contents */

  .d-contents {
    grid-column: text;
    color: rgba(0,0,0,0.8);
    font-size: 0.9em;
    padding-bottom: 1em;
    margin-bottom: 1em;
    padding-bottom: 0.5em;
    margin-bottom: 1em;
    padding-left: 0.25em;
    justify-self: start;
  }

  @media(min-width: 1000px) {
    .d-contents.d-contents-float {
      height: 0;
      grid-column-start: 1;
      grid-column-end: 4;
      justify-self: center;
      padding-right: 3em;
      padding-left: 2em;
    }
  }

  .d-contents nav h3 {
    font-size: 18px;
    margin-top: 0;
    margin-bottom: 1em;
  }

  .d-contents li {
    list-style-type: none
  }

  .d-contents nav > ul {
    padding-left: 0;
  }

  .d-contents ul {
    padding-left: 1em
  }

  .d-contents nav ul li {
    margin-top: 0.6em;
    margin-bottom: 0.2em;
  }

  .d-contents nav a {
    font-size: 13px;
    border-bottom: none;
    text-decoration: none
    color: rgba(0, 0, 0, 0.8);
  }

  .d-contents nav a:hover {
    text-decoration: underline solid rgba(0, 0, 0, 0.6)
  }

  .d-contents nav > ul > li > a {
    font-weight: 600;
  }

  .d-contents nav > ul > li > ul {
    font-weight: inherit;
  }

  .d-contents nav > ul > li > ul > li {
    margin-top: 0.2em;
  }


  .d-contents nav ul {
    margin-top: 0;
    margin-bottom: 0.25em;
  }

  .d-article-with-toc h2:nth-child(2) {
    margin-top: 0;
  }


  /* Figure */

  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }

  .figure img {
    width: 100%;
  }

  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }

  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }

  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }

  /* Citations */

  d-article .citation {
    color: inherit;
    cursor: inherit;
  }

  div.hanging-indent{
    margin-left: 1em; text-indent: -1em;
  }

  /* Citation hover box */

  .tippy-box[data-theme~=light-border] {
    background-color: rgba(250, 250, 250, 0.95);
  }

  .tippy-content > p {
    margin-bottom: 0;
    padding: 2px;
  }


  /* Tweak 1000px media break to show more text */

  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }

    .grid {
      grid-column-gap: 16px;
    }

    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }

  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }

    .grid {
      grid-column-gap: 32px;
    }
  }


  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */

  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  /* Include appendix styles here so they can be overridden */

  d-appendix {
    contain: layout style;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-top: 60px;
    margin-bottom: 0;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    color: rgba(0,0,0,0.5);
    padding-top: 60px;
    padding-bottom: 48px;
  }

  d-appendix h3 {
    grid-column: page-start / text-start;
    font-size: 15px;
    font-weight: 500;
    margin-top: 1em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.65);
  }

  d-appendix h3 + * {
    margin-top: 1em;
  }

  d-appendix ol {
    padding: 0 0 0 15px;
  }

  @media (min-width: 768px) {
    d-appendix ol {
      padding: 0 0 0 30px;
      margin-left: -30px;
    }
  }

  d-appendix li {
    margin-bottom: 1em;
  }

  d-appendix a {
    color: rgba(0, 0, 0, 0.6);
  }

  d-appendix > * {
    grid-column: text;
  }

  d-appendix > d-footnote-list,
  d-appendix > d-citation-list,
  d-appendix > distill-appendix {
    grid-column: screen;
  }

  /* Include footnote styles here so they can be overridden */

  d-footnote-list {
    contain: layout style;
  }

  d-footnote-list > * {
    grid-column: text;
  }

  d-footnote-list a.footnote-backlink {
    color: rgba(0,0,0,0.3);
    padding-left: 0.5em;
  }



  /* Anchor.js */

  .anchorjs-link {
    /*transition: all .25s linear; */
    text-decoration: none;
    border-bottom: none;
  }
  *:hover > .anchorjs-link {
    margin-left: -1.125em !important;
    text-decoration: none;
    border-bottom: none;
  }

  /* Social footer */

  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }

  .disqus-comments {
    margin-right: 30px;
  }

  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }

  #disqus_thread {
    margin-top: 30px;
  }

  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }

  .article-sharing a:hover {
    border-bottom: none;
  }

  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }

  .subscribe p {
    margin-bottom: 0.5em;
  }


  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }


  .sidebar-section.custom {
    font-size: 12px;
    line-height: 1.6em;
  }

  .custom p {
    margin-bottom: 0.5em;
  }

  /* Styles for listing layout (hide title) */
  .layout-listing d-title, .layout-listing .d-title {
    display: none;
  }

  /* Styles for posts lists (not auto-injected) */


  .posts-with-sidebar {
    padding-left: 45px;
    padding-right: 45px;
  }

  .posts-list .description h2,
  .posts-list .description p {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }

  .posts-list .description h2 {
    font-weight: 700;
    border-bottom: none;
    padding-bottom: 0;
  }

  .posts-list h2.post-tag {
    border-bottom: 1px solid rgba(0, 0, 0, 0.2);
    padding-bottom: 12px;
  }
  .posts-list {
    margin-top: 60px;
    margin-bottom: 24px;
  }

  .posts-list .post-preview {
    text-decoration: none;
    overflow: hidden;
    display: block;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    padding: 24px 0;
  }

  .post-preview-last {
    border-bottom: none !important;
  }

  .posts-list .posts-list-caption {
    grid-column: screen;
    font-weight: 400;
  }

  .posts-list .post-preview h2 {
    margin: 0 0 6px 0;
    line-height: 1.2em;
    font-style: normal;
    font-size: 24px;
  }

  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.4em;
    font-size: 16px;
  }

  .posts-list .post-preview .thumbnail {
    box-sizing: border-box;
    margin-bottom: 24px;
    position: relative;
    max-width: 500px;
  }
  .posts-list .post-preview img {
    width: 100%;
    display: block;
  }

  .posts-list .metadata {
    font-size: 12px;
    line-height: 1.4em;
    margin-bottom: 18px;
  }

  .posts-list .metadata > * {
    display: inline-block;
  }

  .posts-list .metadata .publishedDate {
    margin-right: 2em;
  }

  .posts-list .metadata .dt-authors {
    display: block;
    margin-top: 0.3em;
    margin-right: 2em;
  }

  .posts-list .dt-tags {
    display: block;
    line-height: 1em;
  }

  .posts-list .dt-tags .dt-tag {
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0.3em 0.4em;
    margin-right: 0.2em;
    margin-bottom: 0.4em;
    font-size: 60%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  .posts-list img {
    opacity: 1;
  }

  .posts-list img[data-src] {
    opacity: 0;
  }

  .posts-more {
    clear: both;
  }


  .posts-sidebar {
    font-size: 16px;
  }

  .posts-sidebar h3 {
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 0.5em;
    font-weight: 400;
    text-transform: uppercase;
  }

  .sidebar-section {
    margin-bottom: 30px;
  }

  .categories ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }

  .categories li {
    color: rgba(0, 0, 0, 0.8);
    margin-bottom: 0;
  }

  .categories li>a {
    border-bottom: none;
  }

  .categories li>a:hover {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  }

  .categories .active {
    font-weight: 600;
  }

  .categories .category-count {
    color: rgba(0, 0, 0, 0.4);
  }


  @media(min-width: 768px) {
    .posts-list .post-preview h2 {
      font-size: 26px;
    }
    .posts-list .post-preview .thumbnail {
      float: right;
      width: 30%;
      margin-bottom: 0;
    }
    .posts-list .post-preview .description {
      float: left;
      width: 45%;
    }
    .posts-list .post-preview .metadata {
      float: left;
      width: 20%;
      margin-top: 8px;
    }
    .posts-list .post-preview p {
      margin: 0 0 12px 0;
      line-height: 1.5em;
      font-size: 16px;
    }
    .posts-with-sidebar .posts-list {
      float: left;
      width: 75%;
    }
    .posts-with-sidebar .posts-sidebar {
      float: right;
      width: 20%;
      margin-top: 60px;
      padding-top: 24px;
      padding-bottom: 24px;
    }
  }


  /* Improve display for browsers without grid (IE/Edge <= 15) */

  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }

  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }

  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }

  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }

  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }

  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }

  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }


  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }

  .downlevel .footnotes ol {
    padding-left: 13px;
  }

  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }

  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }

  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }

  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  .downlevel .posts-list .post-preview {
    color: inherit;
  }



  </style>

  <script type="application/javascript">

  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }

  // show body when load is complete
  function on_load_complete() {

    // add anchors
    if (window.anchors) {
      window.anchors.options.placement = 'left';
      window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
    }


    // set body to visible
    document.body.style.visibility = 'visible';

    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }

    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }

  function init_distill() {

    init_common();

    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);

    // create d-title
    $('.d-title').changeElementType('d-title');

    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);

    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();

    // move posts container into article
    $('.posts-container').appendTo($('d-article'));

    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');

    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;

    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();

    // move refs into #references-listing
    $('#references-listing').replaceWith($('#refs'));

    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-contents a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });

    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');

    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {

      // capture layout
      var layout = $(this).attr('data-layout');

      // apply layout to markdown level block elements
      var elements = $(this).children().not('details, div.sourceCode, pre, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });


      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });

    // remove code block used to force  highlighting css
    $('.distill-force-highlighting-css').parent().remove();

    // remove empty line numbers inserted by pandoc when using a
    // custom syntax highlighting theme
    $('code.sourceCode a:empty').remove();

    // load distill framework
    load_distill_framework();

    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {

      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;

      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');

      // article with toc class
      $('.d-contents').parent().addClass('d-article-with-toc');

      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

      // add orcid ids
      $('.authors-affiliations').find('.author').each(function(i, el) {
        var orcid_id = front_matter.authors[i].orcidID;
        if (orcid_id) {
          var a = $('<a></a>');
          a.attr('href', 'https://orcid.org/' + orcid_id);
          var img = $('<img></img>');
          img.addClass('orcid-id');
          img.attr('alt', 'ORCID ID');
          img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
          a.append(img);
          $(this).append(a);
        }
      });

      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }

      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");

      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }

       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }

      // remove d-appendix and d-footnote-list local styles
      $('d-appendix > style:first-child').remove();
      $('d-footnote-list > style:first-child').remove();

      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();

      // hoverable references
      $('span.citation[data-cites]').each(function() {
        var refHtml = $('#ref-' + $(this).attr('data-cites')).html();
        window.tippy(this, {
          allowHTML: true,
          content: refHtml,
          maxWidth: 500,
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        });
      });

      // clear polling timer
      clearInterval(tid);

      // show body now that everything is ready
      on_load_complete();
    }

    var tid = setInterval(distill_post_process, 50);
    distill_post_process();

  }

  function init_downlevel() {

    init_common();

     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));

    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;

    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();

    // remove toc
    $('.d-contents').remove();

    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });


    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);

    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();

    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });

    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));

    $('body').addClass('downlevel');

    on_load_complete();
  }


  function init_common() {

    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};

        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });

        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);

    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});

    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });

      }
    });

    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });

    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
      });
    }

    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');

    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");

    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();

    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });

  </script>

  <!--/radix_placeholder_distill-->
  <script src="convergence_files/header-attrs-2.6/header-attrs.js"></script>
  <script src="convergence_files/htmlwidgets-1.5.3/htmlwidgets.js"></script>
  <script src="convergence_files/plotly-binding-4.9.3/plotly.js"></script>
  <script src="convergence_files/typedarray-0.1/typedarray.min.js"></script>
  <script src="convergence_files/jquery-3.5.1/jquery.min.js"></script>
  <link href="convergence_files/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
  <script src="convergence_files/crosstalk-1.1.1/js/crosstalk.min.js"></script>
  <link href="convergence_files/plotly-htmlwidgets-css-1.57.1/plotly-htmlwidgets.css" rel="stylesheet" />
  <script src="convergence_files/plotly-main-1.57.1/plotly-latest.min.js"></script>
  <script src="convergence_files/kePrint-0.0.1/kePrint.js"></script>
  <link href="convergence_files/lightable-0.0.1/lightable.css" rel="stylesheet" />
  <script src="convergence_files/popper-2.6.0/popper.min.js"></script>
  <link href="convergence_files/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="convergence_files/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="convergence_files/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="convergence_files/anchor-4.2.2/anchor.min.js"></script>
  <script src="convergence_files/bowser-1.9.3/bowser.min.js"></script>
  <script src="convergence_files/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="convergence_files/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <!--/radix_placeholder_site_in_header-->

  <link rel="stylesheet" href="../../styles.css" type="text/css"/>

</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Convergence Problems","description":"Lack of convergence got ya down? A plan of attack.","authors":[{"author":"Michael Clark","authorURL":"https://m-clark.github.io","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}],"publishedDate":"2020-03-16T00:00:00.000+00:00","citationText":"Clark, 2020"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Convergence Problems</h1>
<!--radix_placeholder_categories-->
<div class="dt-tags">
<div class="dt=tag">regression</div>
<div class="dt=tag">mixed models</div>
</div>
<!--/radix_placeholder_categories-->
<p><p>Lack of convergence got ya down? A plan of attack.</p></p>
</div>

<div class="d-byline">
  Michael Clark <a href="https://m-clark.github.io" class="uri">https://m-clark.github.io</a> 
  
<br/>2020-03-16
</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#intro">Intro</a></li>
<li><a href="#data-setup">Data Setup</a></li>
<li><a href="#initial-model">Initial model</a></li>
<li><a href="#step-back">Step back</a></li>
<li><a href="#start-simply">Start simply</a></li>
<li><a href="#rescale-variables">Rescale variables</a></li>
<li><a href="#remove-zero-random-effects">Remove zero random effects</a></li>
<li><a href="#technical-options">Technical options</a>
<ul>
<li><a href="#check-singularity">Check singularity</a></li>
<li><a href="#double-checking-gradient-calculations">Double-checking gradient calculations</a></li>
<li><a href="#restart-the-fit">Restart the fit</a></li>
<li><a href="#change-the-optimizer">Change the optimizer</a></li>
</ul></li>
<li><a href="#final-step">Final Step</a></li>
<li><a href="#summary">Summary</a></li>
<li><a href="#references">References</a></li>
</ul>
</nav>
</div>
<aside>
Last updated March 12, 2021.
</aside>
<p>Prerequisite: Knowledge of regression modeling. Helpful would be to know something about mixed models and optimization.</p>
<p>Primary packages used:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://tidyverse.tidyverse.org'>tidyverse</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/lme4/lme4/'>lme4</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://m-clark.github.io/mixedup'>mixedup</a></span><span class='op'>)</span>  <span class='co'># http://m-clark.github.io/mixedup</span>
</code></pre>
</div>
</div>
<h2 id="intro">Intro</h2>
<p>It is not uncommon that complex models lead to difficulties with convergence. Though the following example is a demo with the R package <span class="pack" style="">lme4</span>, most of it would potentially apply to any complex modeling situation where convergence problems arise. The goal is provide some steps one can take to get their models back on track. The running example is taken from the data posted at this <a href="https://stackoverflow.com/questions/23478792/warning-messages-when-trying-to-run-glmer-in-r">stackoverflow question</a>. Ben Bolker’s<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> response there can be seen as the basis for this post, along with some extensions, updates and other organization.</p>
<h2 id="data-setup">Data Setup</h2>
<p>You can download the data from <a href="https://github.com/m-clark/m-clark.github.io/raw/master/data/convergence.RDS">here</a> (RDS file), or go to the <a href="https://stackoverflow.com/questions/23478792/warning-messages-when-trying-to-run-glmer-in-r">stackoverflow discussion</a> and paste the code there. There isn’t any real explanation of the variables unfortunately, though you can get a sense of some of them (e.g. Day, replicate, temperature, etc.).</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># df = readRDS(</span>
<span class='co'>#   gzcon(</span>
<span class='co'>#     url('https://github.com/m-clark/m-clark.github.io/raw/master/data/convergence.RDS')</span>
<span class='co'>#   )</span>
<span class='co'># )</span>

<span class='va'>df</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>readRDS</a></span><span class='op'>(</span><span class='st'>'data/convergence.RDS'</span><span class='op'>)</span>

<span class='va'>df</span> <span class='op'>=</span> <span class='va'>df</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>
    SUR.ID <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>SUR.ID</span><span class='op'>)</span>,
    replicate <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>replicate</span><span class='op'>)</span>,
    Unit <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fu'>n</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>
  <span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<h2 id="initial-model">Initial model</h2>
<p>The following is the model that led to the stackoverflow post. It’s fairly complicated with multiple interactions and random effects, modeling the proportion of valid detections via a binomial model. The <code>Unit</code> effect is used to account for overdispersion, a common issue in count modeling.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>model_mixed_0</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/lme4/man/glmer.html'>glmer</a></span><span class='op'>(</span>
  <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='va'>ValidDetections</span>, <span class='va'>FalseDetections</span><span class='op'>)</span> <span class='op'>~</span> 
    <span class='va'>tm</span><span class='op'>:</span><span class='va'>Area</span> <span class='op'>+</span> <span class='va'>tm</span><span class='op'>:</span><span class='va'>c.distance</span> <span class='op'>+</span> <span class='va'>c.distance</span><span class='op'>:</span><span class='va'>Area</span> <span class='op'>+</span> <span class='va'>c.tm.depth</span><span class='op'>:</span><span class='va'>Area</span> <span class='op'>+</span> 
    <span class='va'>c.receiver.depth</span><span class='op'>:</span><span class='va'>Area</span> <span class='op'>+</span> <span class='va'>c.temp</span><span class='op'>:</span><span class='va'>Area</span> <span class='op'>+</span> <span class='va'>c.wind</span><span class='op'>:</span><span class='va'>Area</span> <span class='op'>+</span> <span class='va'>c.tm.depth</span> <span class='op'>+</span> 
    <span class='va'>c.receiver.depth</span> <span class='op'>+</span> <span class='va'>c.temp</span> <span class='op'>+</span> <span class='va'>c.wind</span> <span class='op'>+</span> <span class='va'>tm</span> <span class='op'>+</span> <span class='va'>c.distance</span> <span class='op'>+</span> <span class='va'>Area</span> <span class='op'>+</span> <span class='va'>replicate</span> <span class='op'>+</span> 
    <span class='op'>(</span><span class='fl'>1</span><span class='op'>|</span><span class='va'>SUR.ID</span><span class='op'>)</span> <span class='op'>+</span> <span class='op'>(</span><span class='fl'>1</span><span class='op'>|</span><span class='va'>Day</span><span class='op'>)</span> <span class='op'>+</span> <span class='op'>(</span><span class='fl'>1</span><span class='op'>|</span><span class='va'>Unit</span><span class='op'>)</span>, 
  data <span class='op'>=</span> <span class='va'>df</span>, 
  family <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/family.html'>binomial</a></span><span class='op'>(</span>link <span class='op'>=</span> <span class='va'>logit</span><span class='op'>)</span>
<span class='op'>)</span>
</code></pre>
</div>
<pre><code>Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl = control$checkConv, : Model failed to converge with max|grad| =
0.131568 (tol = 0.002, component 1)</code></pre>
<pre><code>Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl = control$checkConv, : Model is nearly unidentifiable: very large eigenvalue
 - Rescale variables?;Model is nearly unidentifiable: large eigenvalue ratio
 - Rescale variables?</code></pre>
</div>
<p>This gives several warnings, the more egregious of which is that the model has not converged, meaning the estimates may not be trustworthy. So what do we do?</p>
<h2 id="step-back">Step back</h2>
<p>The first step is to step back and look at the data. Are there issues that can be spotted? Are some essentially collinear with others? In the following, we can see that some variables are only a few levels, and some, like <code>Day</code>, <code>c.tm.depth</code> and <code>c.receiver.depth</code>, are both notably correlated with each other and with other predictor variables.</p>
<div class="layout-chunk" data-layout="l-body">
<pre><code>$`Numeric Variables`
# A tibble: 9 x 10
  Variable             N  Mean     SD     Min      Q1 Median    Q3    Max `% Missing`
  &lt;chr&gt;            &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;       &lt;dbl&gt;
1 ValidDetections    220  6.49  10.1     0       0      1     7     45              0
2 CountDetections    220  6.85  10.1     0       0      2     7     45              0
3 FalseDetections    220  0.36   0.73    0       0      0     0      4              0
4 R.det              220  0.52   0.47    0       0      0.68  1      1              0
5 c.receiver.depth   220 -0.06   0.31   -0.4    -0.34  -0.18  0.21   0.54           0
6 c.tm.depth         220 -0.01   0.48   -0.62   -0.55   0.03  0.4    0.78           0
7 c.temp             220 -0.46   2.38   -4.22   -3.62   0.54  1.55   2.84           0
8 c.wind             220 -0.26   3.29   -2.97   -2.97  -2.94  1.28   5.88           0
9 c.distance         220 -6.36 129.   -160    -110    -10    90    190              0

$`Categorical Variables`
# A tibble: 14 x 4
   Variable  Group        Frequency   `%`
   &lt;chr&gt;     &lt;fct&gt;            &lt;int&gt; &lt;dbl&gt;
 1 SUR.ID    10185               74   34 
 2 SUR.ID    10186               74   34 
 3 SUR.ID    10250               72   33 
 4 tm        CT                 110   50 
 5 tm        PT-04              110   50 
 6 replicate 1                  120   55.
 7 replicate 2                  100   45 
 8 Area      Drug Channel       120   55.
 9 Area      Finger             100   45 
10 Day       03/06/13            60   27 
11 Day       2/22/13             60   27 
12 Day       2/27/13             60   27 
13 Day       3/14/13             28   13 
14 Day       2/26/13             12    5 </code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<div id="htmlwidget-80237856627abaa20cf0" style="width:624px;height:436.8px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-80237856627abaa20cf0">{"x":{"visdat":{"865a4b81ddcc":["function () ","plotlyVisDat"]},"cur_data":"865a4b81ddcc","attrs":{"865a4b81ddcc":{"z":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"heatmap","colors":["#601200","#611300","#621401","#621501","#631600","#631700","#641801","#641901","#651A00","#661B00","#671C00","#671D00","#681E00","#681F00","#692000","#692100","#6A2200","#6A2200","#6B2300","#6B2400","#6C2500","#6D2600","#6E2700","#6E2800","#6F2900","#6F2900","#702A01","#702B00","#712C00","#712D00","#722E01","#722F00","#733000","#743000","#753101","#753200","#763300","#763400","#773501","#773600","#783700","#783700","#793801","#793900","#7A3A00","#7A3B00","#7C3D00","#7D3E00","#7D3E00","#7E3F00","#7E4000","#7F4100","#7F4200","#804300","#804400","#814500","#814600","#824700","#834701","#844800","#844900","#854A01","#854B01","#864C00","#864D00","#874E01","#874F01","#885002","#895002","#8A5101","#8A5201","#8B5302","#8B5402","#8C5503","#8C5603","#8D5704","#8D5804","#8E5905","#8F5A05","#905B06","#905C06","#915D07","#915E07","#925F08","#936009","#94610A","#94620B","#95630C","#95640D","#96650E","#97660F","#986810","#996912","#996A13","#9A6B15","#9B6C16","#9C6D17","#9C6E17","#9D6F19","#9E701A","#9F711C","#9F721D","#A0731E","#A0741F","#A17521","#A27622","#A37723","#A37824","#A47926","#A47A28","#A57B29","#A67C2A","#A77D2B","#A77E2D","#A87F2E","#A88030","#A98131","#AA8232","#AB8333","#AB8435","#AC8536","#AC8638","#AD873A","#AD873B","#AE883C","#AF893D","#B08A3F","#B08B40","#B18C42","#B18D43","#B28E44","#B28E45","#B38F47","#B39048","#B4914A","#B5924B","#B6944D","#B7954F","#B79550","#B89651","#B89652","#B99854","#B99955","#BA9A57","#BA9A58","#BB9B5A","#BC9C5B","#BD9D5C","#BD9E5D","#BE9F5F","#BE9F60","#BFA062","#BFA164","#C0A265","#C0A366","#C1A467","#C1A469","#C2A56A","#C2A66C","#C3A76D","#C4A86F","#C5A970","#C5AA71","#C6AB72","#C6AB74","#C7AC75","#C7AD77","#C8AE78","#C8AF7A","#C9B07C","#C9B07D","#CAB17E","#CBB27F","#CCB381","#CCB482","#CDB584","#CDB585","#CEB687","#CEB788","#CFB98A","#CFB98B","#D0BA8C","#D1BB8E","#D1BB8F","#D2BD91","#D3BE92","#D4BF94","#D4C095","#D5C197","#D5C198","#D6C29A","#D6C39B","#D7C49D","#D7C59E","#D8C6A0","#D8C6A1","#D9C7A2","#DAC8A3","#DBC9A5","#DBCAA7","#DCCBA8","#DCCCAA","#DDCDAB","#DDCDAD","#DECEAE","#DECFB0","#DFD0B1","#E0D1B3","#E1D2B4","#E1D3B6","#E2D4B7","#E2D4B9","#E3D5BB","#E3D6BC","#E4D7BD","#E4D8BE","#E5D9C0","#E5D9C1","#E6DAC3","#E6DBC4","#E7DCC6","#E7DDC7","#E8DEC9","#E8DECA","#E9DFCC","#E9E0CD","#EAE2CF","#EBE3D1","#EBE3D2","#ECE4D3","#ECE5D4","#EDE6D6","#ECE6D7","#EDE7D9","#EDE7DA","#EEE8DB","#EEE8DC","#EDE9DE","#EDE9DF","#EDEAE0","#EDEAE1","#EEEBE2","#EEEBE3","#EDECE4","#EDECE5","#ECEDE6","#ECEDE7","#EBECE8","#EBECE8","#EAEDE9","#EAEDE9","#E9ECEA","#E9ECEA","#E8EDEB","#E7EDEB","#E6ECEC","#E6ECEC","#E5EBED","#E4EBED","#E2EAEC","#E1EBEC","#E0EAED","#DFEAED","#DEE9EC","#DDE9EC","#DBE8ED","#DAE7ED","#D8E6EC","#D7E6EC","#D6E5EB","#D5E4EB","#D3E3EB","#D2E3EB","#D0E1EA","#CEE0E9","#CDE0E9","#CBDFE8","#CADEE8","#C8DDE7","#C7DCE7","#C5DBE6","#C3DAE6","#C1D9E5","#C0D8E4","#BED7E3","#BDD6E3","#BBD5E2","#BAD5E2","#B8D4E1","#B6D3E1","#B5D2E0","#B3D1DF","#B2D0DE","#B0CFDE","#AFCEDD","#ACCDDD","#ABCCDC","#A9CBDC","#A8CADB","#A6C9DA","#A5C8D9","#A3C7D9","#A1C6D8","#A0C5D8","#9FC4D7","#9DC3D6","#9BC2D5","#99C1D5","#97C0D4","#96BFD4","#94BED3","#93BED2","#91BDD1","#90BCD1","#8EBBD0","#8DBAD0","#8BB9CF","#89B8CE","#87B6CD","#85B5CC","#84B4CC","#82B3CB","#81B2CA","#7FB1C9","#7EB0C9","#7CAFC8","#7AAEC8","#78ADC7","#77ACC6","#75ABC5","#74AAC5","#72A9C4","#70A8C3","#6FA7C2","#6EA6C2","#6CA5C1","#6AA4C1","#68A3C0","#66A2BF","#65A1BE","#63A0BE","#629FBD","#609EBD","#5F9DBC","#5D9CBB","#5B9BBA","#599ABA","#5799B9","#5698B8","#5496B7","#5395B7","#5194B6","#5093B6","#4E92B5","#4D91B4","#4B90B3","#4A8FB3","#488EB2","#478DB1","#458CB0","#448BB0","#428AAF","#4089AF","#3E87AD","#3C86AC","#3B85AC","#3984AB","#3883AA","#3782A9","#3681A9","#3480A8","#337FA8","#317EA7","#307DA6","#2E7CA5","#2D7BA5","#2B7AA4","#2979A4","#2878A3","#2777A2","#2676A1","#2475A1","#2374A0","#2273A0","#21729F","#1F719E","#1E709D","#1D6F9D","#1C6E9C","#1A6D9C","#196C9B","#186B9A","#176A99","#166999","#156898","#146898","#136797","#126697","#116596","#106496","#0F6395","#0E6294","#0D6193","#0C6093","#0B5F92","#0B5F92","#0A5E91","#095D91","#085C90","#075A8F","#07598F","#06588E","#06588D","#05578C","#05568C","#04558B","#05548B","#04538A","#04538A","#035289","#045189","#035088","#034F88","#024E87","#024E87","#034D86","#034C86","#024B85","#024A85","#034984","#034984","#024883","#024783","#014682","#014682","#024581","#024481","#014380","#014280","#01417F","#01417F","#02407E","#023F7E","#013E7D","#013E7D","#023D7C","#023C7C","#013B7B","#013B7B","#023A7A","#01397A","#023779","#013779","#013678","#013577","#023477","#013376","#013376","#023275","#023175","#013074","#013074","#022F73","#022E73","#012D72","#012D72","#022C71","#022B71","#012A70","#012A70","#02296F","#02286F","#01276E","#01276E","#02266D","#02256D","#01246C","#01246C","#02236B","#02226B","#01216A","#01206A","#021F69","#021F69","#011E68","#011D68","#021C67","#021C67","#011B66","#011A66","#001965","#001865","#011764","#011764","#001663","#001563","#011362","#001362","#001261","#001260"],"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"zaxis":{"title":"cormat"}},"xaxis":{"domain":[0,1],"automargin":true,"tickmode":"array","tickvals":[0,1,2,3,4,5,6,7,8,9,10,11],"ticktext":["ValidDetections","Area","c.tm.depth","R.det","c.distance","tm","Day","c.receiver.depth","FalseDetections","c.wind","c.temp","replicate"],"gridcolor":"transparent","zerolinecolor":"transparent","title":"","zeroline":false,"showgrid":false},"yaxis":{"domain":[0,1],"automargin":true,"tickmode":"array","tickvals":[0,1,2,3,4,5,6,7,8,9,10,11],"ticktext":["ValidDetections","Area","c.tm.depth","R.det","c.distance","tm","Day","c.receiver.depth","FalseDetections","c.wind","c.temp","replicate"],"gridcolor":"transparent","zerolinecolor":"transparent","title":"","autorange":"reversed","zeroline":false,"showgrid":false},"hovermode":"closest","showlegend":false,"legend":{"yanchor":"top","y":0.5},"plot_bgcolor":"transparent","paper_bgcolor":"transparent"},"source":"A","config":{"showSendToCloud":false,"displayModeBar":false},"data":[{"colorbar":{"title":"cormat","ticklen":2,"len":0.5,"lenmode":"fraction","y":1,"yanchor":"top"},"colorscale":[["0","rgba(96,18,0,1)"],["0.0416666666666666","rgba(109,38,0,1)"],["0.0833333333333333","rgba(121,56,1,1)"],["0.125","rgba(133,75,1,1)"],["0.166666666666667","rgba(146,95,8,1)"],["0.208333333333333","rgba(161,117,33,1)"],["0.25","rgba(175,137,61,1)"],["0.291666666666667","rgba(188,156,91,1)"],["0.333333333333333","rgba(199,173,119,1)"],["0.375","rgba(212,192,149,1)"],["0.416666666666667","rgba(225,210,180,1)"],["0.458333333333333","rgba(236,228,211,1)"],["0.5","rgba(234,237,233,1)"],["0.541666666666667","rgba(212,228,235,1)"],["0.583333333333333","rgba(179,209,223,1)"],["0.625","rgba(145,189,209,1)"],["0.666666666666667","rgba(111,167,194,1)"],["0.708333333333333","rgba(78,146,181,1)"],["0.75","rgba(46,124,165,1)"],["0.791666666666667","rgba(20,104,152,1)"],["0.833333333333333","rgba(5,84,139,1)"],["0.875","rgba(1,67,128,1)"],["0.916666666666667","rgba(1,51,118,1)"],["0.958333333333333","rgba(2,35,107,1)"],["1","rgba(0,18,96,1)"]],"showscale":true,"z":[[1,0.547774150912714,-0.586092479695613,0.611269154334396,-0.438709988450219,-0.102446472268654,-0.14111515615372,-0.410604014056096,0.0118191150229274,-0.138301711474222,0.282551198172891,-0.0386441150388181],[0.547774150912714,1,-0.589289111820496,0.372315094846742,-0.0542163454834101,0,0.15955303305206,-0.171097706736777,-0.0170763540093295,0.191789363492377,0.371525745109053,-0.1],[-0.586092479695613,-0.589289111820496,1,-0.490419077564185,0.224759681592676,0,0.619594895590976,0.782682870980345,0.0567732621399129,-0.029964602946145,0.0609726355667545,0.0042817995518779],[0.611269154334396,0.372315094846742,-0.490419077564185,1,-0.534314006793575,-0.146050797242485,-0.104493220707463,-0.281651803737025,0.0255834684768406,-0.0214340873082293,0.176279615818128,0.00649720015902378],[-0.438709988450219,-0.0542163454834101,0.224759681592676,-0.534314006793575,1,0,0.000805936244988486,0.0462606526416997,-0.0771514590472353,-0.072242053086807,-0.0449746864891288,-0.0542163454834101],[-0.102446472268654,0,0,-0.146050797242485,0,1,0,0,0.0872956400479665,0,0,0],[-0.14111515615372,0.15955303305206,0.619594895590976,-0.104493220707463,0.000805936244988486,0,1,0.848095619335053,0.0793683187257252,0.156015301685176,0.52095274380606,-0.0693708839356781],[-0.410604014056096,-0.171097706736777,0.782682870980345,-0.281651803737025,0.0462606526416997,0,0.848095619335053,1,0.12008348983148,0.388866502930339,0.0177696319824046,-0.0461539863427399],[0.0118191150229274,-0.0170763540093295,0.0567732621399129,0.0255834684768406,-0.0771514590472353,0.0872956400479665,0.0793683187257252,0.12008348983148,1,0.0277043340668402,-0.0433628716327528,0.0204916248111954],[-0.138301711474222,0.191789363492377,-0.029964602946145,-0.0214340873082293,-0.072242053086807,0,0.156015301685176,0.388866502930339,0.0277043340668402,1,-0.480345814111001,-0.15138961672583],[0.282551198172891,0.371525745109053,0.0609726355667545,0.176279615818128,-0.0449746864891288,0,0.52095274380606,0.0177696319824046,-0.0433628716327528,-0.480345814111001,1,0.0656602344480019],[-0.0386441150388181,-0.1,0.0042817995518779,0.00649720015902378,-0.0542163454834101,0,-0.0693708839356781,-0.0461539863427399,0.0204916248111954,-0.15138961672583,0.0656602344480019,1]],"type":"heatmap","xaxis":"x","yaxis":"y","frame":null,"zmin":-1,"zmax":1}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
<p>We can obtain a rough metric of total correlation of a variable with the others by looking at the <a href="https://en.wikipedia.org/wiki/Variance_inflation_factor">variance inflation factor</a> (VIF)<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>. For this, we’ll treat any binary or ordered data as numeric, and we can use the <span class="pack" style="">car</span> package to get the VIF. This requires running an arbitrary regression model that includes the covariates of interest, but the value is derived only from the predictor variables. If we just try it with a dummy model, we get an error, since the linear model has perfect collinearity. We find out that <code>Day</code> is probably causing issues, and we’ll see why later.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># the model used to acquire the vif doesn't matter- anything could be used for</span>
<span class='co'># the target variable</span>

<span class='co'># this produces errors about aliased coefficients</span>
<span class='co'># car::vif(lm(CountDetections ~ . - Unit - FalseDetections - ValidDetections, dat = df))</span>

<span class='fu'><a href='https://rdrr.io/r/base/attributes.html'>attributes</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/alias.html'>alias</a></span><span class='op'>(</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span><span class='op'>(</span>
    <span class='va'>CountDetections</span> <span class='op'>~</span> <span class='va'>.</span> <span class='op'>-</span> <span class='va'>Unit</span> <span class='op'>-</span> <span class='va'>FalseDetections</span> <span class='op'>-</span> <span class='va'>ValidDetections</span>,
    dat <span class='op'>=</span> <span class='va'>df</span>
  <span class='op'>)</span>
<span class='op'>)</span><span class='op'>$</span><span class='va'>Complete</span><span class='op'>)</span><span class='op'>$</span><span class='va'>dimnames</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span>
</code></pre>
</div>
<pre><code>[1] &quot;Day3/14/13&quot; &quot;c.wind&quot;    </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>car</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/car/man/vif.html'>vif</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span><span class='op'>(</span><span class='va'>CountDetections</span> <span class='op'>~</span> <span class='va'>.</span> <span class='op'>-</span><span class='va'>Unit</span> <span class='op'>-</span><span class='va'>Day</span> <span class='op'>-</span><span class='va'>FalseDetections</span>, dat <span class='op'>=</span> <span class='va'>df</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>                      GVIF Df GVIF^(1/(2*Df))
SUR.ID            1.200902  2        1.046832
tm                1.066227  1        1.032583
ValidDetections   2.708644  1        1.645796
replicate         1.057540  1        1.028368
Area              5.795510  1        2.407387
R.det             2.393891  1        1.547220
c.receiver.depth  8.674740  1        2.945291
c.tm.depth       13.438407  1        3.665843
c.temp            2.956315  1        1.719394
c.wind            3.041363  1        1.743950
c.distance        2.065335  1        1.437127</code></pre>
</div>
<p>It looks like, along with <code>Day</code>, <code>tm.depth</code> is probably going to cause a problem, as more than 90% of its variance is accounted for by the other covariates. So at this point we can consider both it and <code>Day</code> as potential predictors to remove. Wind is less an issue once <code>Day</code> is removed.</p>
<p>An alternative approach I tried (not shown) was just running a PCA on the predictor variables. Only six components were needed to account for nearly almost 90% of the total variance, so I think it’s safe to say there is a notable amount of redundancy in this data.</p>
<p>One final note is that the target variable is a potential problem as well. More than half of the data is a 1.0 proportion of <code>Valid Detections</code>, and it also turns out this doesn’t appear to be proportional data per se, as sometimes both Valid and False Detections can be zero, meaning such observations don’t contribute meaningfully to the model. This isn’t necessarily a problem as these observations are basically dropped dropped from the model, and you will note in the GLM results that follow that the residual degrees of freedom will be notably lower than the total number of observations (220). This is due to the dropout of those observations, which is about 37% of the data. Even so, the lack of variability may be an underlying issue in general. Especially in the case of interactions, it is likely that some cells have no variability in the outcome.</p>
<h2 id="start-simply">Start simply</h2>
<p>So we know there are some data issues, so let’s start with a model that’s relatively simple but still plausible. If we just look at a GLM without any random effects, can we spot any issues?</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>model_glm_1</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/glm.html'>glm</a></span><span class='op'>(</span>
  <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='va'>ValidDetections</span>, <span class='va'>FalseDetections</span><span class='op'>)</span> <span class='op'>~</span>
    <span class='va'>tm</span><span class='op'>:</span><span class='va'>Area</span> <span class='op'>+</span> <span class='va'>tm</span><span class='op'>:</span><span class='va'>c.distance</span> <span class='op'>+</span> <span class='va'>c.distance</span><span class='op'>:</span><span class='va'>Area</span> <span class='op'>+</span> <span class='va'>c.tm.depth</span><span class='op'>:</span><span class='va'>Area</span> <span class='op'>+</span>
    <span class='va'>c.receiver.depth</span><span class='op'>:</span><span class='va'>Area</span> <span class='op'>+</span> <span class='va'>c.temp</span><span class='op'>:</span><span class='va'>Area</span> <span class='op'>+</span> <span class='va'>c.wind</span><span class='op'>:</span><span class='va'>Area</span> <span class='op'>+</span> <span class='va'>c.tm.depth</span> <span class='op'>+</span>
    <span class='va'>c.receiver.depth</span> <span class='op'>+</span> <span class='va'>c.temp</span> <span class='op'>+</span> <span class='va'>c.wind</span> <span class='op'>+</span> <span class='va'>tm</span> <span class='op'>+</span> <span class='va'>c.distance</span> <span class='op'>+</span> <span class='va'>Area</span> <span class='op'>+</span> <span class='va'>replicate</span> <span class='op'>+</span>
    <span class='va'>SUR.ID</span> <span class='op'>+</span> <span class='va'>Day</span>,
  data <span class='op'>=</span> <span class='va'>df</span>,
  family <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/family.html'>binomial</a></span><span class='op'>(</span>link <span class='op'>=</span> <span class='va'>logit</span><span class='op'>)</span>
<span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>model_glm_1</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>
Call:
glm(formula = cbind(ValidDetections, FalseDetections) ~ tm:Area + 
    tm:c.distance + c.distance:Area + c.tm.depth:Area + c.receiver.depth:Area + 
    c.temp:Area + c.wind:Area + c.tm.depth + c.receiver.depth + 
    c.temp + c.wind + tm + c.distance + Area + replicate + SUR.ID + 
    Day, family = binomial(link = logit), data = df)

Deviance Residuals: 
   Min      1Q  Median      3Q     Max  
-2.739   0.000   0.000   0.539   2.161  

Coefficients: (3 not defined because of singularities)
                              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                 -1.125e+01  6.504e+00  -1.730  0.08372 .  
c.tm.depth                  -8.406e-01  1.228e+00  -0.684  0.49376    
c.receiver.depth             7.026e+00  7.852e+00   0.895  0.37095    
c.temp                      -5.514e+00  2.538e+00  -2.172  0.02983 *  
c.wind                      -6.256e+00  3.349e+00  -1.868  0.06179 .  
tmPT-04                     -2.053e+00  4.961e-01  -4.139  3.5e-05 ***
c.distance                  -3.685e-03  2.614e-03  -1.410  0.15864    
AreaFinger                   5.901e+01  2.775e+01   2.127  0.03346 *  
replicate2                   2.700e+00  1.161e+00   2.326  0.02000 *  
SUR.ID10186                 -2.227e-01  4.456e-01  -0.500  0.61721    
SUR.ID10250                 -2.995e-01  4.469e-01  -0.670  0.50281    
Day2/22/13                  -7.114e+01  3.463e+01  -2.054  0.03996 *  
Day2/26/13                   3.306e+00  1.134e+03   0.003  0.99767    
Day2/27/13                          NA         NA      NA       NA    
Day3/14/13                          NA         NA      NA       NA    
tmPT-04:AreaFinger           4.308e-01  6.066e-01   0.710  0.47759    
tmPT-04:c.distance          -5.332e-03  3.186e-03  -1.674  0.09419 .  
AreaFinger:c.distance        1.192e-02  3.855e-03   3.091  0.00199 ** 
AreaFinger:c.tm.depth       -2.815e+00  4.731e+00  -0.595  0.55189    
AreaFinger:c.receiver.depth -3.211e+01  2.545e+01  -1.262  0.20708    
AreaFinger:c.temp            2.377e+00  1.902e+00   1.250  0.21141    
AreaFinger:c.wind                   NA         NA      NA       NA    
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 334.57  on 137  degrees of freedom
Residual deviance: 135.23  on 119  degrees of freedom
AIC: 253.65

Number of Fisher Scoring iterations: 17</code></pre>
</div>
<p>Sure enough, there are problems. What’s going on with <code>Day</code> and <code>Area</code>? One issue is that <code>Area</code> only couples with certain days, so having one already tells you a lot about what the other could tell you.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/with.html'>with</a></span><span class='op'>(</span><span class='va'>df</span>, <span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='va'>Day</span>, <span class='va'>Area</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>          Area
Day        Drug Channel Finger
  03/06/13           60      0
  2/22/13             0     60
  2/26/13             0     12
  2/27/13            60      0
  3/14/13             0     28</code></pre>
</div>
<p>You could potentially create a combined type of variable to deal with this for example, but otherwise the problem will persist with both in the model. There are likely remaining collinearities besides, but let’s take Day out for example.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>model_glm_2</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/update.html'>update</a></span><span class='op'>(</span><span class='va'>model_glm_1</span>, <span class='va'>.</span> <span class='op'>~</span> <span class='va'>.</span> <span class='op'>-</span><span class='va'>Day</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>model_glm_2</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>
Call:
glm(formula = cbind(ValidDetections, FalseDetections) ~ c.tm.depth + 
    c.receiver.depth + c.temp + c.wind + tm + c.distance + Area + 
    replicate + SUR.ID + tm:Area + tm:c.distance + Area:c.distance + 
    Area:c.tm.depth + Area:c.receiver.depth + Area:c.temp + Area:c.wind, 
    family = binomial(link = logit), data = df)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.7693   0.0000   0.0000   0.5335   2.1586  

Coefficients:
                              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                 -10.980797   6.323591  -1.736  0.08248 .  
c.tm.depth                   -0.842695   1.227579  -0.686  0.49242    
c.receiver.depth              7.003401   7.846631   0.893  0.37211    
c.temp                       -5.407822   2.465579  -2.193  0.02828 *  
c.wind                       -6.125119   3.266203  -1.875  0.06075 .  
tmPT-04                      -2.049088   0.495012  -4.139 3.48e-05 ***
c.distance                   -0.003755   0.002586  -1.452  0.14644    
AreaFinger                   11.163412   6.537806   1.708  0.08773 .  
replicate2                    2.646675   1.120176   2.363  0.01814 *  
SUR.ID10186                  -0.223527   0.445491  -0.502  0.61584    
SUR.ID10250                  -0.300337   0.446936  -0.672  0.50159    
tmPT-04:AreaFinger            0.425446   0.605567   0.703  0.48233    
tmPT-04:c.distance           -0.005304   0.003175  -1.670  0.09483 .  
c.distance:AreaFinger         0.011937   0.003849   3.101  0.00193 ** 
c.tm.depth:AreaFinger        -3.137815   4.366782  -0.719  0.47241    
c.receiver.depth:AreaFinger -35.342161  17.332674  -2.039  0.04145 *  
c.temp:AreaFinger             2.222685   1.682491   1.321  0.18648    
c.wind:AreaFinger             8.259864   3.700848   2.232  0.02562 *  
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 334.57  on 137  degrees of freedom
Residual deviance: 135.27  on 120  degrees of freedom
AIC: 251.69

Number of Fisher Scoring iterations: 10</code></pre>
</div>
<p>Well, at least we got rid of the complete collinearity- no <code>NA</code> remains. However, those familiar with such models can still see that some of these coefficients and their associated standard errors are exceedingly large for this setting, so we shouldn’t really be surprised there would still be issues with the more complicated mixed models. With binary logistic models, large absolute coefficients and their standard errors are usually a sign of collinearity/separation, and we now know from our previous exploration that something similar is going on in this proportional binomial model. Here is a table of the more egregious offenders and a plot of all coefficients, their standard errors, and the VIF (size).</p>
<div class="layout-chunk" data-layout="l-body">
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
term
</th>
<th style="text-align:right;">
estimate
</th>
<th style="text-align:right;">
std.error
</th>
<th style="text-align:right;">
statistic
</th>
<th style="text-align:right;">
p.value
</th>
<th style="text-align:right;">
vif
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
c.receiver.depth
</td>
<td style="text-align:right;">
7.003
</td>
<td style="text-align:right;">
7.847
</td>
<td style="text-align:right;">
0.893
</td>
<td style="text-align:right;">
0.372
</td>
<td style="text-align:right;">
21.202
</td>
</tr>
<tr>
<td style="text-align:left;">
c.wind
</td>
<td style="text-align:right;">
-6.125
</td>
<td style="text-align:right;">
3.266
</td>
<td style="text-align:right;">
-1.875
</td>
<td style="text-align:right;">
0.061
</td>
<td style="text-align:right;">
88.124
</td>
</tr>
<tr>
<td style="text-align:left;">
AreaFinger
</td>
<td style="text-align:right;">
11.163
</td>
<td style="text-align:right;">
6.538
</td>
<td style="text-align:right;">
1.708
</td>
<td style="text-align:right;">
0.088
</td>
<td style="text-align:right;">
24.372
</td>
</tr>
<tr>
<td style="text-align:left;">
c.receiver.depth:AreaFinger
</td>
<td style="text-align:right;">
-35.342
</td>
<td style="text-align:right;">
17.333
</td>
<td style="text-align:right;">
-2.039
</td>
<td style="text-align:right;">
0.041
</td>
<td style="text-align:right;">
43.537
</td>
</tr>
<tr>
<td style="text-align:left;">
c.wind:AreaFinger
</td>
<td style="text-align:right;">
8.260
</td>
<td style="text-align:right;">
3.701
</td>
<td style="text-align:right;">
2.232
</td>
<td style="text-align:right;">
0.026
</td>
<td style="text-align:right;">
89.504
</td>
</tr>
</tbody>
</table>
<p><img src="convergence_files/figure-html5/glm-issues-1.svg" width="624" style="display: block; margin: auto;" /></p>
</div>
<p>At this point I would not assume anything about the mixed model itself being a problem, and be leaning toward this being primarily a data issue. Or, at the very least, data issues will need to be sorted out. So let’s begin the restart of our mixed model effort by pulling out some of those variables we thought had some collinearity issues. You might have noticed from the GLM that <code>SUR.ID</code> was only 3 levels, so let’s move that to a fixed effect also. In keeping things simple, I’m not including any interactions.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>model_mixed_1</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/lme4/man/glmer.html'>glmer</a></span><span class='op'>(</span>
  <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='va'>ValidDetections</span>, <span class='va'>FalseDetections</span><span class='op'>)</span> <span class='op'>~</span> 
    <span class='co'># tm:Area + tm:c.distance + c.distance:Area + #c.tm.depth:Area + </span>
    <span class='co'># c.receiver.depth:Area + c.temp:Area + c.wind:Area + #c.tm.depth + </span>
    <span class='va'>c.receiver.depth</span> <span class='op'>+</span> <span class='va'>c.temp</span> <span class='op'>+</span> <span class='va'>c.wind</span> <span class='op'>+</span> <span class='va'>tm</span> <span class='op'>+</span> <span class='va'>c.distance</span> <span class='op'>+</span> <span class='va'>Area</span> <span class='op'>+</span> <span class='va'>replicate</span> <span class='op'>+</span> 
    <span class='va'>SUR.ID</span> <span class='op'>+</span> 
    <span class='op'>(</span><span class='fl'>1</span><span class='op'>|</span><span class='va'>Unit</span><span class='op'>)</span>, <span class='co'>#  + (1|Day)</span>
  data <span class='op'>=</span> <span class='va'>df</span>,
  family <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/family.html'>binomial</a></span><span class='op'>(</span>link <span class='op'>=</span> <span class='va'>logit</span><span class='op'>)</span>
<span class='op'>)</span>
</code></pre>
</div>
<pre><code>Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl = control$checkConv, : Model failed to converge with max|grad| =
0.117672 (tol = 0.002, component 1)</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://m-clark.github.io/mixedup/reference/summarize_model.html'>summarize_model</a></span><span class='op'>(</span><span class='va'>model_mixed_1</span>, ci <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>
Variance Components:</code></pre>
<pre><code> Group    Effect Variance   SD Var_prop
  Unit Intercept     0.90 0.95     1.00</code></pre>
<pre><code>
Fixed Effects:</code></pre>
<pre><code>             Term Value   SE     Z P_value Lower_2.5 Upper_97.5
        Intercept  2.39 0.73  3.26    0.00      0.95       3.82
 c.receiver.depth -3.80 1.08 -3.53    0.00     -5.91      -1.69
           c.temp  0.25 0.19  1.28    0.20     -0.13       0.63
           c.wind  0.13 0.15  0.88    0.38     -0.16       0.43
          tmPT-04 -1.36 0.36 -3.77    0.00     -2.07      -0.65
       c.distance -0.01 0.00 -5.09    0.00     -0.01      -0.01
       AreaFinger  1.22 0.62  1.99    0.05      0.02       2.43
       replicate2 -0.39 0.37 -1.05    0.29     -1.11       0.33
      SUR.ID10186 -0.13 0.55 -0.23    0.82     -1.20       0.95
      SUR.ID10250 -0.20 0.54 -0.36    0.72     -1.26       0.87</code></pre>
</div>
<p>Well, we still have issues, so what else can we try?</p>
<h2 id="rescale-variables">Rescale variables</h2>
<p>Let’s go ahead with the easy part and rescale our variables, which might as well be done with any model. I will standardize the numeric variables.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>sc</span> <span class='op'>=</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/scale.html'>scale</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>[</span>, <span class='fl'>1</span><span class='op'>]</span>

<span class='va'>df</span> <span class='op'>=</span> <span class='va'>df</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>
    c.receiver.depth_sc <span class='op'>=</span> <span class='fu'>sc</span><span class='op'>(</span><span class='va'>c.receiver.depth</span><span class='op'>)</span>,
    c.tm.depth_sc <span class='op'>=</span> <span class='fu'>sc</span><span class='op'>(</span><span class='va'>c.tm.depth</span><span class='op'>)</span>,
    c.temp_sc     <span class='op'>=</span> <span class='fu'>sc</span><span class='op'>(</span><span class='va'>c.temp</span><span class='op'>)</span>,
    c.wind_sc     <span class='op'>=</span> <span class='fu'>sc</span><span class='op'>(</span><span class='va'>c.wind</span><span class='op'>)</span>,
    c.distance_sc <span class='op'>=</span> <span class='fu'>sc</span><span class='op'>(</span><span class='va'>c.distance</span><span class='op'>)</span>,
  <span class='op'>)</span>

<span class='va'>model_mixed_2</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/lme4/man/glmer.html'>glmer</a></span><span class='op'>(</span>
  <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='va'>ValidDetections</span>, <span class='va'>FalseDetections</span><span class='op'>)</span> <span class='op'>~</span> 
    <span class='co'># tm:Area + tm:c.distance_sc + c.distance_sc:Area + </span>
    <span class='co'># c.receiver.depth_sc:Area + c.temp_sc:Area + c.wind_sc:Area +</span>
    <span class='va'>c.receiver.depth_sc</span> <span class='op'>+</span> <span class='va'>c.temp_sc</span> <span class='op'>+</span> <span class='va'>c.wind_sc</span> <span class='op'>+</span> <span class='va'>tm</span> <span class='op'>+</span> <span class='va'>c.distance_sc</span> <span class='op'>+</span> <span class='va'>Area</span> <span class='op'>+</span> <span class='va'>replicate</span> <span class='op'>+</span> 
    <span class='va'>SUR.ID</span> <span class='op'>+</span>
    <span class='op'>(</span><span class='fl'>1</span><span class='op'>|</span><span class='va'>Unit</span><span class='op'>)</span>, 
  data <span class='op'>=</span> <span class='va'>df</span>,
  family <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/family.html'>binomial</a></span><span class='op'>(</span>link <span class='op'>=</span> <span class='va'>logit</span><span class='op'>)</span>
<span class='op'>)</span>
</code></pre>
</div>
<pre><code>Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl = control$checkConv, : Model failed to converge with max|grad| =
0.135829 (tol = 0.002, component 1)</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://m-clark.github.io/mixedup/reference/summarize_model.html'>summarize_model</a></span><span class='op'>(</span><span class='va'>model_mixed_2</span>, ci <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>
Variance Components:</code></pre>
<pre><code> Group    Effect Variance   SD Var_prop
  Unit Intercept     0.87 0.93     1.00</code></pre>
<pre><code>
Fixed Effects:</code></pre>
<pre><code>                Term Value   SE     Z P_value Lower_2.5 Upper_97.5
           Intercept  2.48 0.69  3.59    0.00      1.13       3.84
 c.receiver.depth_sc -1.18 0.33 -3.56    0.00     -1.83      -0.53
           c.temp_sc  0.58 0.45  1.27    0.20     -0.31       1.47
           c.wind_sc  0.42 0.49  0.86    0.39     -0.54       1.38
             tmPT-04 -1.36 0.36 -3.78    0.00     -2.07      -0.66
       c.distance_sc -1.19 0.23 -5.15    0.00     -1.64      -0.74
          AreaFinger  1.23 0.61  2.01    0.04      0.03       2.43
          replicate2 -0.39 0.37 -1.07    0.28     -1.11       0.33
         SUR.ID10186 -0.11 0.54 -0.20    0.84     -1.17       0.95
         SUR.ID10250 -0.19 0.54 -0.35    0.73     -1.25       0.87</code></pre>
</div>
<p>So at least we have the rescaling taken care of, and while that got rid of one warning, we still have the convergence problem. What can we check for next? I looked to see if there was any further imbalance of categorical variables, didn’t spot much issue, but then discovered something else. A couple covariates - <code>c.wind</code> and <code>c.distance</code> - have only five unique values, and for the former, some of those values only occur a few times. In addition, <code>c.wind</code> was unique per day, so was essentially confounded with it. So we can feel fine with having previously removed Day.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>df</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select</span><span class='op'>(</span><span class='op'>-</span><span class='fu'>ends_with</span><span class='op'>(</span><span class='st'>'sc'</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>map_int</span><span class='op'>(</span><span class='va'>n_distinct</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>          SUR.ID               tm  ValidDetections  CountDetections  FalseDetections        replicate             Area 
               3                2               35               35                5                2                2 
             Day            R.det c.receiver.depth       c.tm.depth           c.temp           c.wind       c.distance 
               5               21               30               31               37                5                5 
            Unit 
             220 </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='va'>df</span><span class='op'>$</span><span class='va'>c.wind</span>, <span class='va'>df</span><span class='op'>$</span><span class='va'>Day</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>              
               03/06/13 2/22/13 2/26/13 2/27/13 3/14/13
  -2.96855001         0      60       0       0       0
  -2.939182972        0       0       0      60       0
  1.27535159         60       0       0       0       0
  4.71144999          0       0      12       0       0
  5.88092439          0       0       0       0      28</code></pre>
</div>
<p><br></p>
<p>If we treat these as categorical what happens? I’ll do it just for the GLM again.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>model_glm_3</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/glm.html'>glm</a></span><span class='op'>(</span>
  <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='va'>ValidDetections</span>, <span class='va'>FalseDetections</span><span class='op'>)</span> <span class='op'>~</span>
    <span class='co'># tm:Area + tm:c.distance_sc + c.distance_sc:Area +</span>
    <span class='co'># c.receiver.depth_sc:Area + c.temp_sc:Area + c.wind_sc:Area +</span>
    <span class='va'>c.receiver.depth_sc</span> <span class='op'>+</span> <span class='va'>c.temp_sc</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>c.wind</span><span class='op'>)</span> <span class='op'>+</span> <span class='va'>tm</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>c.distance</span><span class='op'>)</span> <span class='op'>+</span> <span class='va'>Area</span> <span class='op'>+</span> <span class='va'>replicate</span> <span class='op'>+</span>
    <span class='va'>SUR.ID</span> ,
  data <span class='op'>=</span> <span class='va'>df</span>,
  family <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/family.html'>binomial</a></span><span class='op'>(</span>link <span class='op'>=</span> <span class='va'>logit</span><span class='op'>)</span>
<span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>model_glm_3</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>
Call:
glm(formula = cbind(ValidDetections, FalseDetections) ~ c.receiver.depth_sc + 
    c.temp_sc + factor(c.wind) + tm + factor(c.distance) + Area + 
    replicate + SUR.ID, family = binomial(link = logit), data = df)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-3.4641   0.0000   0.0000   0.5706   2.1259  

Coefficients: (1 not defined because of singularities)
                            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                   7.8190     2.2057   3.545 0.000393 ***
c.receiver.depth_sc           1.3883     2.1912   0.634 0.526349    
c.temp_sc                    -2.3820     1.4315  -1.664 0.096116 .  
factor(c.wind)-2.939182972   -5.0028     4.0691  -1.229 0.218901    
factor(c.wind)1.27535159     -7.8429     2.9788  -2.633 0.008466 ** 
factor(c.wind)4.71144999     17.9094  1180.6959   0.015 0.987898    
factor(c.wind)5.88092439     -9.1668     6.3781  -1.437 0.150654    
tmPT-04                      -1.2459     0.2823  -4.413 1.02e-05 ***
factor(c.distance)-110       -0.3953     0.3908  -1.011 0.311786    
factor(c.distance)-10        -0.9887     0.4110  -2.405 0.016162 *  
factor(c.distance)90         -0.8547     0.5253  -1.627 0.103694    
factor(c.distance)190        -3.2681     0.7664  -4.264 2.01e-05 ***
AreaFinger                        NA         NA      NA       NA    
replicate2                    0.7647     0.5249   1.457 0.145120    
SUR.ID10186                  -0.1224     0.4384  -0.279 0.780057    
SUR.ID10250                  -0.2700     0.4363  -0.619 0.536010    
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 334.57  on 137  degrees of freedom
Residual deviance: 146.17  on 123  degrees of freedom
AIC: 256.59

Number of Fisher Scoring iterations: 17</code></pre>
</div>
<p>Ah! So now we see that <code>Area</code> is also accounted for by other factors. In addition, wind is still problematic. Let’s take out <code>Area</code>, while still treating wind and distance as categorical for our diagnostic adventure.</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>model_glm_4</span> <span class='op'>=</span>  <span class='fu'><a href='https://rdrr.io/r/stats/update.html'>update</a></span><span class='op'>(</span><span class='va'>model_glm_3</span>, <span class='va'>.</span> <span class='op'>~</span> <span class='va'>.</span> <span class='op'>-</span> <span class='va'>Area</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>model_glm_4</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>
Call:
glm(formula = cbind(ValidDetections, FalseDetections) ~ c.receiver.depth_sc + 
    c.temp_sc + factor(c.wind) + tm + factor(c.distance) + replicate + 
    SUR.ID, family = binomial(link = logit), data = df)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-3.4641   0.0000   0.0000   0.5706   2.1259  

Coefficients:
                            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                   7.8190     2.2057   3.545 0.000393 ***
c.receiver.depth_sc           1.3883     2.1912   0.634 0.526349    
c.temp_sc                    -2.3820     1.4315  -1.664 0.096116 .  
factor(c.wind)-2.939182972   -5.0028     4.0691  -1.229 0.218901    
factor(c.wind)1.27535159     -7.8429     2.9788  -2.633 0.008466 ** 
factor(c.wind)4.71144999     17.9094  1180.6959   0.015 0.987898    
factor(c.wind)5.88092439     -9.1668     6.3781  -1.437 0.150654    
tmPT-04                      -1.2459     0.2823  -4.413 1.02e-05 ***
factor(c.distance)-110       -0.3953     0.3908  -1.011 0.311786    
factor(c.distance)-10        -0.9887     0.4110  -2.405 0.016162 *  
factor(c.distance)90         -0.8547     0.5253  -1.627 0.103694    
factor(c.distance)190        -3.2681     0.7664  -4.264 2.01e-05 ***
replicate2                    0.7647     0.5249   1.457 0.145120    
SUR.ID10186                  -0.1224     0.4384  -0.279 0.780057    
SUR.ID10250                  -0.2700     0.4363  -0.619 0.536010    
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 334.57  on 137  degrees of freedom
Residual deviance: 146.17  on 123  degrees of freedom
AIC: 256.59

Number of Fisher Scoring iterations: 17</code></pre>
</div>
<p>The remaining collinearity is due to the relatively few observations for that value of wind, but at least most of the other covariates effects have settled down. Let’s try collapsing wind values and officially making it categorical.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>df</span> <span class='op'>=</span> <span class='va'>df</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>wind <span class='op'>=</span> <span class='fu'>fct_lump</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>c.wind</span><span class='op'>)</span>, <span class='fl'>3</span>, other_level <span class='op'>=</span> <span class='st'>'Higher'</span><span class='op'>)</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='va'>df</span><span class='op'>$</span><span class='va'>wind</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>
 -2.96855001 -2.939182972   1.27535159       Higher 
          60           60           60           40 </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>model_mixed_3</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/lme4/man/glmer.html'>glmer</a></span><span class='op'>(</span>
  <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='va'>ValidDetections</span>, <span class='va'>FalseDetections</span><span class='op'>)</span> <span class='op'>~</span> 
    <span class='co'># tm:Area + tm:c.distance_sc + c.distance_sc:Area + </span>
    <span class='co'># c.receiver.depth_sc:Area + c.temp_sc:Area + c.wind_sc:Area +</span>
    <span class='va'>c.receiver.depth_sc</span> <span class='op'>+</span> <span class='va'>c.temp_sc</span> <span class='op'>+</span> <span class='va'>wind</span> <span class='op'>+</span> <span class='va'>tm</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>c.distance</span><span class='op'>)</span> <span class='op'>+</span> <span class='co'>#Area + </span>
    <span class='va'>replicate</span> <span class='op'>+</span> <span class='va'>SUR.ID</span> <span class='op'>+</span>
    <span class='op'>(</span><span class='fl'>1</span><span class='op'>|</span><span class='va'>Unit</span><span class='op'>)</span>, 
  data <span class='op'>=</span> <span class='va'>df</span>, 
  family <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/family.html'>binomial</a></span><span class='op'>(</span>link <span class='op'>=</span> <span class='va'>logit</span><span class='op'>)</span>
<span class='op'>)</span>

<span class='fu'><a href='https://m-clark.github.io/mixedup/reference/summarize_model.html'>summarize_model</a></span><span class='op'>(</span><span class='va'>model_mixed_3</span>, ci <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code> Group    Effect Variance   SD Var_prop
  Unit Intercept     0.78 0.88     1.00
                 Term Value   SE     Z P_value Lower_2.5 Upper_97.5
            Intercept  3.67 1.16  3.16    0.00      1.40       5.94
  c.receiver.depth_sc -3.02 1.40 -2.16    0.03     -5.76      -0.28
            c.temp_sc -1.72 1.70 -1.02    0.31     -5.05       1.60
     wind-2.939182972  2.73 2.87  0.95    0.34     -2.89       8.35
       wind1.27535159 -4.20 2.88 -1.46    0.14     -9.85       1.44
           windHigher  4.41 2.81  1.57    0.12     -1.10       9.92
              tmPT-04 -1.31 0.36 -3.65    0.00     -2.01      -0.60
 factorc.distance-110 -0.62 0.48 -1.31    0.19     -1.56       0.31
  factorc.distance-10 -1.44 0.50 -2.87    0.00     -2.42      -0.45
   factorc.distance90 -1.23 0.62 -1.97    0.05     -2.44      -0.01
  factorc.distance190 -4.21 0.96 -4.39    0.00     -6.09      -2.33
           replicate2  0.20 0.58  0.34    0.73     -0.93       1.33
          SUR.ID10186 -0.06 0.54 -0.12    0.90     -1.12       0.99
          SUR.ID10250 -0.16 0.54 -0.30    0.76     -1.21       0.89</code></pre>
</div>
<p>Checking VIF adjusted for the degrees of freedom associated with the covariate (which is greater for categorical variables), we still have some issues. Below I show VIF both with and without wind as an example.</p>
<div class="layout-chunk" data-layout="l-body">
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
covariate
</th>
<th style="text-align:right;">
VIF_adj_orig
</th>
<th style="text-align:right;">
VIF_adj
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
c.receiver.depth_sc
</td>
<td style="text-align:right;">
10.017
</td>
<td style="text-align:right;">
1.277
</td>
</tr>
<tr>
<td style="text-align:left;">
c.temp_sc
</td>
<td style="text-align:right;">
9.437
</td>
<td style="text-align:right;">
1.065
</td>
</tr>
<tr>
<td style="text-align:left;">
wind
</td>
<td style="text-align:right;">
3.914
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
tm
</td>
<td style="text-align:right;">
1.059
</td>
<td style="text-align:right;">
1.047
</td>
</tr>
<tr>
<td style="text-align:left;">
factor(c.distance)
</td>
<td style="text-align:right;">
1.080
</td>
<td style="text-align:right;">
1.062
</td>
</tr>
<tr>
<td style="text-align:left;">
replicate
</td>
<td style="text-align:right;">
1.769
</td>
<td style="text-align:right;">
1.101
</td>
</tr>
<tr>
<td style="text-align:left;">
SUR.ID
</td>
<td style="text-align:right;">
1.075
</td>
<td style="text-align:right;">
1.029
</td>
</tr>
</tbody>
</table>
</div>
<p>Let’s see what happens if we remove wind from the model.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>model_mixed_4</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/lme4/man/glmer.html'>glmer</a></span><span class='op'>(</span>
  <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='va'>ValidDetections</span>, <span class='va'>FalseDetections</span><span class='op'>)</span> <span class='op'>~</span> 
    <span class='co'># tm:Area + tm:c.distance_sc + c.distance_sc:Area + </span>
    <span class='co'># c.receiver.depth_sc:Area + c.temp_sc:Area + c.wind_sc:Area +</span>
    <span class='va'>c.receiver.depth_sc</span> <span class='op'>+</span>  <span class='va'>c.temp_sc</span>  <span class='op'>+</span> <span class='va'>tm</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>c.distance</span><span class='op'>)</span> <span class='op'>+</span> <span class='co'>#Area + </span>
    <span class='va'>replicate</span> <span class='op'>+</span> <span class='va'>SUR.ID</span> <span class='op'>+</span>
    <span class='op'>(</span><span class='fl'>1</span><span class='op'>|</span><span class='va'>Unit</span><span class='op'>)</span>, 
  data <span class='op'>=</span> <span class='va'>df</span>,
  family <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/family.html'>binomial</a></span><span class='op'>(</span>link <span class='op'>=</span> <span class='va'>logit</span><span class='op'>)</span>
<span class='op'>)</span>
</code></pre>
</div>
<pre><code>Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl = control$checkConv, : Model failed to converge with max|grad| =
0.0547464 (tol = 0.002, component 1)</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://m-clark.github.io/mixedup/reference/summarize_model.html'>summarize_model</a></span><span class='op'>(</span><span class='va'>model_mixed_4</span>, ci <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code> Group    Effect Variance   SD Var_prop
  Unit Intercept     1.45 1.20     1.00
                 Term Value   SE     Z P_value Lower_2.5 Upper_97.5
            Intercept  5.62 0.74  7.63    0.00      4.18       7.06
  c.receiver.depth_sc -1.08 0.19 -5.57    0.00     -1.46      -0.70
            c.temp_sc  0.50 0.21  2.34    0.02      0.08       0.92
              tmPT-04 -1.28 0.40 -3.19    0.00     -2.08      -0.49
 factorc.distance-110 -0.99 0.53 -1.86    0.06     -2.04       0.05
  factorc.distance-10 -1.87 0.55 -3.41    0.00     -2.95      -0.80
   factorc.distance90 -1.87 0.66 -2.83    0.00     -3.17      -0.58
  factorc.distance190 -5.60 1.04 -5.38    0.00     -7.65      -3.56
           replicate2 -0.37 0.40 -0.94    0.35     -1.15       0.40
          SUR.ID10186 -0.90 0.56 -1.60    0.11     -1.99       0.20
          SUR.ID10250 -0.98 0.56 -1.74    0.08     -2.07       0.12</code></pre>
</div>
<p>We’re doing better, as our <code>max|grad|</code> value is closer to the tolerance value, but we’re still not where we want to be. What else can we do?</p>
<h2 id="remove-zero-random-effects">Remove zero random effects</h2>
<p>If any variance components estimates are zero we could remove them. However, at this point we already have. <code>Day</code> was zero because it was already accounted for by other covariates. <code>SUR.ID</code> moved to a fixed effect, where it still appears to be a small effect, but at least won’t cause computational problems. The remaining <code>Unit</code> effect does appear to capture some overdispersion, so we can leave it for now.</p>
<h2 id="technical-options">Technical options</h2>
<p>At this point, we have explored some of the more problematic aspects of the data. Some might feel that they are missing out on some of their theoretical priorities by removing some covariates, but if they are confounded with other covariates, their story can’t be easily disentangled anyway. As noted, we could still play around with creation of different categorical effects through further collapsing or combining, but a lot of that would be arbitrary, so must be done with caution.</p>
<p>In general, the problems with the model appear to actually be entirely with the data, but we can move on for demonstration. At some point in your own modeling adventure, you may exhaust what you can do data-wise, and still have convergence issues. This leaves exploration of the more technical side of things to see what tweaks can be made to help further. In order to best check these more technical aspects, it helps to know something about the underlying optimization algorithms, or at least optimization in general. And in general, I suggest refraining from this unless the previous steps have failed. It is very common that once the data has been sorted, convergence gets solved as well, so the data must be ruled out. In any case, let’s see what else we can do!</p>
<h3 id="check-singularity">Check singularity</h3>
<p>This is a mixed model-specific check<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>, and in general, checking singularity<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a> goes along with removing zero random effects. These days, you’ll usually get a singularity warning when it is likely the case. In the past, Bolker suggested checking this problem as follows, but for this example concluded the result wasn’t close enough to zero to be a real concern. The <code>theta</code> below are just our random effect standard deviations, and I would say that the ones besides <code>Unit</code> probably weren’t meaningfully different from zero.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>thetas</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/lme4/man/getME.html'>getME</a></span><span class='op'>(</span><span class='va'>model_mixed_0</span>, <span class='st'>"theta"</span><span class='op'>)</span>

<span class='va'>thetas</span>
</code></pre>
</div>
<pre><code>  Unit.(Intercept)    Day.(Intercept) SUR.ID.(Intercept) 
       0.680682401        0.009520505        0.007124172 </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>ll</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/lme4/man/getME.html'>getME</a></span><span class='op'>(</span><span class='va'>model_mixed_0</span>, <span class='st'>"lower"</span><span class='op'>)</span> <span class='co'># lower bounds on model parameters (random effects parameters only)</span>

<span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>thetas</span><span class='op'>[</span><span class='va'>ll</span> <span class='op'>==</span> <span class='fl'>0</span><span class='op'>]</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 0.007124172</code></pre>
</div>
<p>Nowadays <span class="pack" style="">lme4</span> provides the function <span class="func" style="">isSingular</span> which uses the steps above to check the minimum value against some specified tolerance.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/pkg/lme4/man/isSingular.html'>isSingular</a></span><span class='op'>(</span><span class='va'>model_mixed_0</span>, tol <span class='op'>=</span> <span class='fl'>1e-5</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] FALSE</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># rePCA(model_mixed_0)  # via PCA of the random-effects variance-covariance estimates</span>
</code></pre>
</div>
</div>
<h3 id="double-checking-gradient-calculations">Double-checking gradient calculations</h3>
<p>For the mixed model setting, Bolker notes the following:</p>
<blockquote>
<p>One general problem is that large scaled gradients are often associated with small absolute gradients: we might decide that we’re more interested in testing the (parallel) minimum of these two quantities.</p>
</blockquote>
<p>We can do this as follows for the initial mixed model.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>derivs_init</span>  <span class='op'>=</span> <span class='va'>model_mixed_0</span><span class='op'>@</span><span class='va'>optinfo</span><span class='op'>$</span><span class='va'>derivs</span>

<span class='va'>sc_grad_init</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/with.html'>with</a></span><span class='op'>(</span><span class='va'>derivs_init</span>, <span class='fu'><a href='https://rdrr.io/r/base/solve.html'>solve</a></span><span class='op'>(</span><span class='va'>Hessian</span>, <span class='va'>gradient</span><span class='op'>)</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>abs</a></span><span class='op'>(</span><span class='va'>sc_grad_init</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 1.518823</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>pmin</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>abs</a></span><span class='op'>(</span><span class='va'>sc_grad_init</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>abs</a></span><span class='op'>(</span><span class='va'>derivs_init</span><span class='op'>$</span><span class='va'>gradient</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 0.1315685</code></pre>
</div>
<p>We see that the unscaled gradient results in a lower maximum value, but is still large relative to the tolerance. That value is what is reported in the warning message.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>model_mixed_0</span><span class='op'>@</span><span class='va'>optinfo</span><span class='op'>$</span><span class='va'>conv</span><span class='op'>$</span><span class='va'>lme4</span><span class='op'>$</span><span class='va'>messages</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span>
</code></pre>
</div>
<pre><code>[1] &quot;Model failed to converge with max|grad| = 0.131568 (tol = 0.002, component 1)&quot;</code></pre>
</div>
<p>It may be instructive to compare the result to the model where we scaled the inputs. In this case the scaled gradient results in the lower max value.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>derivs_model_mixed_2</span> <span class='op'>=</span> <span class='va'>model_mixed_2</span><span class='op'>@</span><span class='va'>optinfo</span><span class='op'>$</span><span class='va'>derivs</span>

<span class='va'>sc_grad_model_mixed_2</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/with.html'>with</a></span><span class='op'>(</span><span class='va'>derivs_model_mixed_2</span>, <span class='fu'><a href='https://rdrr.io/r/base/solve.html'>solve</a></span><span class='op'>(</span><span class='va'>Hessian</span>, <span class='va'>gradient</span><span class='op'>)</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>abs</a></span><span class='op'>(</span><span class='va'>sc_grad_model_mixed_2</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 0.01645039</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>pmin</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>abs</a></span><span class='op'>(</span><span class='va'>sc_grad_model_mixed_2</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>abs</a></span><span class='op'>(</span><span class='va'>derivs_model_mixed_2</span><span class='op'>$</span><span class='va'>gradient</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 0.01645039</code></pre>
</div>
<p>Bolker also suggests checking if the result varies from using a different calculation, but it’s not clear what we’d do if this was the case. In any event, the results would be similar.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>devfun_init</span>  <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/update.html'>update</a></span><span class='op'>(</span><span class='va'>model_mixed_0</span>, devFunOnly <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='va'>pars_init</span>    <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/unlist.html'>unlist</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/lme4/man/getME.html'>getME</a></span><span class='op'>(</span><span class='va'>model_mixed_0</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"theta"</span>, <span class='st'>"fixef"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>grad_init</span>    <span class='op'>=</span> <span class='fu'>numDeriv</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/numDeriv/man/grad.html'>grad</a></span><span class='op'>(</span><span class='va'>devfun_init</span>, <span class='va'>pars_init</span><span class='op'>)</span>
<span class='va'>hess_init</span>    <span class='op'>=</span> <span class='fu'>numDeriv</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/numDeriv/man/hessian.html'>hessian</a></span><span class='op'>(</span><span class='va'>devfun_init</span>, <span class='va'>pars_init</span><span class='op'>)</span>
<span class='va'>sc_grad_init</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/solve.html'>solve</a></span><span class='op'>(</span><span class='va'>hess_init</span>, <span class='va'>grad_init</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>pmin</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>abs</a></span><span class='op'>(</span><span class='va'>sc_grad_init</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>abs</a></span><span class='op'>(</span><span class='va'>grad_init</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 0.1315678</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>pmin</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>abs</a></span><span class='op'>(</span><span class='va'>sc_grad_init</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>abs</a></span><span class='op'>(</span><span class='va'>derivs_init</span><span class='op'>$</span><span class='va'>gradient</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 0.1315685</code></pre>
</div>
<h3 id="restart-the-fit">Restart the fit</h3>
<p>As another step along our technical travails, we can just let the optimizer keep going until it does converge. Many R modeling packages allow for you to access the optimizer and change various settings. Most optimizers have a <code>maxit</code> type of argument to let you set the number of iterations, and we can use <span class="func" style="">update</span> to continue where we left off. Unfortunately there is no standard argument name for the total number of iterations, or even if you do happen to remember, guessing is required as to what we should set it at. So instead, we can just call <span class="func" style="">update</span> iteratively until there is no convergence warning. I check this by seeing if there is any output to <code>@optinfo$conv$lme4</code>, as it will only be there if it doesn’t converge<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>model_mixed_5</span> <span class='op'>=</span> <span class='va'>model_mixed_4</span>

<span class='kw'>while</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>model_mixed_5</span><span class='op'>@</span><span class='va'>optinfo</span><span class='op'>$</span><span class='va'>conv</span><span class='op'>$</span><span class='va'>lme4</span><span class='op'>)</span> <span class='op'>&gt;</span> <span class='fl'>0</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>pars</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/lme4/man/getME.html'>getME</a></span><span class='op'>(</span><span class='va'>model_mixed_5</span>,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"theta"</span>,<span class='st'>"fixef"</span><span class='op'>)</span><span class='op'>)</span>
  <span class='va'>model_mixed_5</span> <span class='op'>&lt;-</span>
    <span class='fu'><a href='https://rdrr.io/r/stats/update.html'>update</a></span><span class='op'>(</span><span class='va'>model_mixed_5</span>,
           start <span class='op'>=</span> <span class='va'>pars</span>,
           control <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/lme4/man/lmerControl.html'>glmerControl</a></span><span class='op'>(</span>optCtrl <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>maxfun <span class='op'>=</span> <span class='fl'>2e5</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span>
  <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>abs</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://rdrr.io/r/base/with.html'>with</a></span><span class='op'>(</span>
      <span class='va'>model_mixed_5</span><span class='op'>@</span><span class='va'>optinfo</span><span class='op'>$</span><span class='va'>derivs</span>, <span class='fu'><a href='https://rdrr.io/r/base/solve.html'>solve</a></span><span class='op'>(</span><span class='va'>Hessian</span>, <span class='va'>gradient</span><span class='op'>)</span>
    <span class='op'>)</span>
  <span class='op'>)</span>
<span class='op'>)</span>  
</code></pre>
</div>
<pre><code>[1] 0.0008423291</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># we win!</span>
</code></pre>
</div>
</div>
<p>So at this point we have converged with no warnings. Hooray for us! However, the following shows us that we were pretty close anyway. The estimates from the last model with warnings and the converged model are nearly identical.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://m-clark.github.io/mixedup/reference/summarize_model.html'>summarize_model</a></span><span class='op'>(</span><span class='va'>model_mixed_4</span>, ci <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>
Variance Components:</code></pre>
<pre><code> Group    Effect Variance   SD Var_prop
  Unit Intercept     1.45 1.20     1.00</code></pre>
<pre><code>
Fixed Effects:</code></pre>
<pre><code>                 Term Value   SE     Z P_value Lower_2.5 Upper_97.5
            Intercept  5.62 0.74  7.63    0.00      4.18       7.06
  c.receiver.depth_sc -1.08 0.19 -5.57    0.00     -1.46      -0.70
            c.temp_sc  0.50 0.21  2.34    0.02      0.08       0.92
              tmPT-04 -1.28 0.40 -3.19    0.00     -2.08      -0.49
 factorc.distance-110 -0.99 0.53 -1.86    0.06     -2.04       0.05
  factorc.distance-10 -1.87 0.55 -3.41    0.00     -2.95      -0.80
   factorc.distance90 -1.87 0.66 -2.83    0.00     -3.17      -0.58
  factorc.distance190 -5.60 1.04 -5.38    0.00     -7.65      -3.56
           replicate2 -0.37 0.40 -0.94    0.35     -1.15       0.40
          SUR.ID10186 -0.90 0.56 -1.60    0.11     -1.99       0.20
          SUR.ID10250 -0.98 0.56 -1.74    0.08     -2.07       0.12</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://m-clark.github.io/mixedup/reference/summarize_model.html'>summarize_model</a></span><span class='op'>(</span><span class='va'>model_mixed_5</span>, ci <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>
Variance Components:</code></pre>
<pre><code> Group    Effect Variance   SD Var_prop
  Unit Intercept     1.46 1.21     1.00</code></pre>
<pre><code>
Fixed Effects:</code></pre>
<pre><code>                 Term Value   SE     Z P_value Lower_2.5 Upper_97.5
            Intercept  5.63 0.74  7.62    0.00      4.18       7.08
  c.receiver.depth_sc -1.07 0.19 -5.54    0.00     -1.45      -0.69
            c.temp_sc  0.50 0.22  2.34    0.02      0.08       0.92
              tmPT-04 -1.28 0.40 -3.18    0.00     -2.08      -0.49
 factorc.distance-110 -0.99 0.53 -1.85    0.06     -2.04       0.06
  factorc.distance-10 -1.87 0.55 -3.39    0.00     -2.95      -0.79
   factorc.distance90 -1.87 0.66 -2.82    0.00     -3.17      -0.57
  factorc.distance190 -5.59 1.04 -5.37    0.00     -7.63      -3.55
           replicate2 -0.38 0.40 -0.96    0.34     -1.15       0.40
          SUR.ID10186 -0.91 0.56 -1.61    0.11     -2.01       0.20
          SUR.ID10250 -0.99 0.56 -1.76    0.08     -2.09       0.11</code></pre>
</div>
<p>As an additional point, one may provide starting estimates from the outset. For example you could run a a simpler model, e.g. standard GLM, and feed the estimates there for the fixed effects coefficients of the mixed model, or even run a model to obtain starting values for the random effects (see this <a href="https://gist.githubusercontent.com/bbolker/ea8ed558d9fe0a4a1a6909039242eb87/raw/a493a6c5dc8231577b22de9fc29808ac02da29c7/lme4_GH858.R">example</a>).</p>
<h3 id="change-the-optimizer">Change the optimizer</h3>
<p>As a last effort among the more technical knobs to turn, we can start fiddling with the optimizer options. The <span class="pack" style="">lme4</span> package has a nice function <span class="func" style="">allFit</span> that will search across several different optimizers (some may require additional packages to be installed). However, in any particular modeling setting you could potentially do this, though often you may not be able to without quite a bit of effort relative to what <span class="pack" style="">lme4</span> allows. I’ll do this with our last non-converged model.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>optimx</span><span class='op'>)</span>  <span class='co'># required for some optimizers</span>

<span class='va'>glmm_all</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/lme4/man/allFit.html'>allFit</a></span><span class='op'>(</span><span class='va'>model_mixed_4</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>bobyqa : [OK]
Nelder_Mead : [OK]
nlminbwrap : [OK]
nmkbw : [OK]
optimx.L-BFGS-B : [OK]
nloptwrap.NLOPT_LN_NELDERMEAD : [OK]
nloptwrap.NLOPT_LN_BOBYQA : [OK]</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>glmm_all_summary</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>glmm_all</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>The ‘[OK]’ just means there wasn’t an error, however we can see that several have convergence problems, but even a couple of those are almost to the tolerance level. In the end though, the estimates and log likelihoods are not meaningfully different across the optimizers.</p>
<div class="layout-chunk" data-layout="l-body">
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
opt
</th>
<th style="text-align:left;">
OK
</th>
<th style="text-align:left;">
Message
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Nelder_Mead
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
Model failed to converge with max|grad| = 0.0062003 (tol = 0.002, component 1)
</td>
</tr>
</tbody>
</table>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:768px; ">
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
optimizer
</th>
<th style="text-align:right;">
(Intercept)
</th>
<th style="text-align:right;">
c.receiver.depth_sc
</th>
<th style="text-align:right;">
c.temp_sc
</th>
<th style="text-align:right;">
tmPT-04
</th>
<th style="text-align:right;">
factor(c.distance)-110
</th>
<th style="text-align:right;">
factor(c.distance)-10
</th>
<th style="text-align:right;">
factor(c.distance)90
</th>
<th style="text-align:right;">
factor(c.distance)190
</th>
<th style="text-align:right;">
replicate2
</th>
<th style="text-align:right;">
SUR.ID10186
</th>
<th style="text-align:right;">
SUR.ID10250
</th>
<th style="text-align:right;">
ll
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
bobyqa
</td>
<td style="text-align:right;">
5.633
</td>
<td style="text-align:right;">
-1.072
</td>
<td style="text-align:right;">
0.503
</td>
<td style="text-align:right;">
-1.284
</td>
<td style="text-align:right;">
-0.987
</td>
<td style="text-align:right;">
-1.867
</td>
<td style="text-align:right;">
-1.867
</td>
<td style="text-align:right;">
-5.591
</td>
<td style="text-align:right;">
-0.379
</td>
<td style="text-align:right;">
-0.905
</td>
<td style="text-align:right;">
-0.989
</td>
<td style="text-align:right;">
-121.842
</td>
</tr>
<tr>
<td style="text-align:left;">
Nelder_Mead
</td>
<td style="text-align:right;">
5.632
</td>
<td style="text-align:right;">
-1.073
</td>
<td style="text-align:right;">
0.503
</td>
<td style="text-align:right;">
-1.284
</td>
<td style="text-align:right;">
-0.986
</td>
<td style="text-align:right;">
-1.866
</td>
<td style="text-align:right;">
-1.867
</td>
<td style="text-align:right;">
-5.590
</td>
<td style="text-align:right;">
-0.378
</td>
<td style="text-align:right;">
-0.906
</td>
<td style="text-align:right;">
-0.989
</td>
<td style="text-align:right;">
-121.842
</td>
</tr>
<tr>
<td style="text-align:left;">
nlminbwrap
</td>
<td style="text-align:right;">
5.633
</td>
<td style="text-align:right;">
-1.072
</td>
<td style="text-align:right;">
0.503
</td>
<td style="text-align:right;">
-1.284
</td>
<td style="text-align:right;">
-0.987
</td>
<td style="text-align:right;">
-1.867
</td>
<td style="text-align:right;">
-1.867
</td>
<td style="text-align:right;">
-5.591
</td>
<td style="text-align:right;">
-0.379
</td>
<td style="text-align:right;">
-0.905
</td>
<td style="text-align:right;">
-0.989
</td>
<td style="text-align:right;">
-121.842
</td>
</tr>
<tr>
<td style="text-align:left;">
nmkbw
</td>
<td style="text-align:right;">
5.633
</td>
<td style="text-align:right;">
-1.072
</td>
<td style="text-align:right;">
0.503
</td>
<td style="text-align:right;">
-1.284
</td>
<td style="text-align:right;">
-0.987
</td>
<td style="text-align:right;">
-1.867
</td>
<td style="text-align:right;">
-1.867
</td>
<td style="text-align:right;">
-5.591
</td>
<td style="text-align:right;">
-0.379
</td>
<td style="text-align:right;">
-0.905
</td>
<td style="text-align:right;">
-0.989
</td>
<td style="text-align:right;">
-121.842
</td>
</tr>
<tr>
<td style="text-align:left;">
optimx.L-BFGS-B
</td>
<td style="text-align:right;">
5.632
</td>
<td style="text-align:right;">
-1.072
</td>
<td style="text-align:right;">
0.503
</td>
<td style="text-align:right;">
-1.284
</td>
<td style="text-align:right;">
-0.987
</td>
<td style="text-align:right;">
-1.867
</td>
<td style="text-align:right;">
-1.867
</td>
<td style="text-align:right;">
-5.591
</td>
<td style="text-align:right;">
-0.379
</td>
<td style="text-align:right;">
-0.905
</td>
<td style="text-align:right;">
-0.989
</td>
<td style="text-align:right;">
-121.842
</td>
</tr>
<tr>
<td style="text-align:left;">
nloptwrap.NLOPT_LN_NELDERMEAD
</td>
<td style="text-align:right;">
5.633
</td>
<td style="text-align:right;">
-1.072
</td>
<td style="text-align:right;">
0.503
</td>
<td style="text-align:right;">
-1.284
</td>
<td style="text-align:right;">
-0.987
</td>
<td style="text-align:right;">
-1.867
</td>
<td style="text-align:right;">
-1.867
</td>
<td style="text-align:right;">
-5.591
</td>
<td style="text-align:right;">
-0.379
</td>
<td style="text-align:right;">
-0.905
</td>
<td style="text-align:right;">
-0.989
</td>
<td style="text-align:right;">
-121.842
</td>
</tr>
<tr>
<td style="text-align:left;">
nloptwrap.NLOPT_LN_BOBYQA
</td>
<td style="text-align:right;">
5.633
</td>
<td style="text-align:right;">
-1.072
</td>
<td style="text-align:right;">
0.503
</td>
<td style="text-align:right;">
-1.284
</td>
<td style="text-align:right;">
-0.987
</td>
<td style="text-align:right;">
-1.867
</td>
<td style="text-align:right;">
-1.867
</td>
<td style="text-align:right;">
-5.591
</td>
<td style="text-align:right;">
-0.379
</td>
<td style="text-align:right;">
-0.906
</td>
<td style="text-align:right;">
-0.990
</td>
<td style="text-align:right;">
-121.842
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The conclusion would be that our estimates are probably okay regardless of chosen optimizer, but the data likely has issues that still need to be overcome.</p>
<p>Along with different optimizers comes trying different packages. Some packages, in this case like <span class="pack" style="">glmmTMB</span> or <span class="pack" style="">brms</span>, would be viable options. In my playing around with those, <span class="pack" style="">glmmTMB</span> converged, but obviously doesn’t magically overcome the collinearity problems. Likewise, <span class="pack" style="">brms</span> appeared to converge, but had other estimation issues specific to it. Unlike the others, <span class="pack" style="">brms</span> also noted that the zero count observations could not be used.</p>
<h2 id="final-step">Final Step</h2>
<p>The final step would be to make some hard decisions about the model. Which predictors are most meaningful? Is this the best target variable available? Is this the right way to think about the distribution of the target? Is the research question clear enough? Is it strongly related to the available data, enough to be answerable?<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a></p>
<p>However, these are more theoretical problems, not so much statistical ones, and there may be no right answer in the end. That is perfectly fine, and just what you’d report to others. The following model has no issues, but may leave more questions than answers.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>model_mixed_final</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/lme4/man/glmer.html'>glmer</a></span><span class='op'>(</span>
  <span class='va'>ValidDetections</span> <span class='op'>~</span> 
    <span class='va'>c.receiver.depth_sc</span> <span class='op'>+</span> <span class='va'>c.temp_sc</span> <span class='op'>+</span> <span class='va'>tm</span> <span class='op'>+</span> 
    <span class='va'>replicate</span> <span class='op'>+</span> <span class='va'>SUR.ID</span> <span class='op'>+</span> <span class='op'>(</span><span class='fl'>1</span><span class='op'>|</span><span class='va'>Unit</span><span class='op'>)</span>,
    data <span class='op'>=</span> <span class='va'>df</span>,
    family <span class='op'>=</span> <span class='va'>poisson</span>
    <span class='op'>)</span>

<span class='fu'><a href='https://m-clark.github.io/mixedup/reference/summarize_model.html'>summarize_model</a></span><span class='op'>(</span><span class='va'>model_mixed_final</span>, ci <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>
Variance Components:</code></pre>
<pre><code> Group    Effect Variance   SD Var_prop
  Unit Intercept     2.96 1.72     1.00</code></pre>
<pre><code>
Fixed Effects:</code></pre>
<pre><code>                Term Value   SE     Z P_value Lower_2.5 Upper_97.5
           Intercept -0.01 0.33 -0.02    0.98     -0.66       0.64
 c.receiver.depth_sc -0.86 0.14 -6.16    0.00     -1.13      -0.59
           c.temp_sc  0.60 0.14  4.27    0.00      0.33       0.88
             tmPT-04 -0.62 0.27 -2.27    0.02     -1.16      -0.08
          replicate2 -0.11 0.27 -0.41    0.68     -0.65       0.42
         SUR.ID10186  0.92 0.35  2.67    0.01      0.25       1.60
         SUR.ID10250  1.11 0.35  3.18    0.00      0.42       1.79</code></pre>
</div>
<h2 id="summary">Summary</h2>
<p>We can summarize our approach to convergence problems as follows:</p>
<ol start="0" type="1">
<li><p>Step back and look at your data. Are there issues? Are some variables essentially collinear with others or otherwise can be practically reduced?</p></li>
<li><p>Start with the simplest but still plausible model. Do you spot any additional issues? If there are, these probably need to be remedied before moving to more complex models.</p></li>
<li><p>Scale your continuous variables. You should be doing this anyway. If some categorical levels have very relatively few observations, consider collapsing.</p></li>
<li><p>For mixed models, if some of your random effects only have a few levels, treat them as fixed or see if they are even needed in the model.</p></li>
<li><p>For mixed models, are any random effect variance estimates zero or nearly zero? Remove.</p></li>
<li><p>After some initial technical checks, if possible, restart the model using previous starting values, and run until convergence. Many packages provide some functionality in this regard, but what exactly is provided may be limited.</p></li>
<li><p>Change the optimizer (if a small mixed model using <span class="pack" style="">lme4</span>, compare several with <span class="func" style="">allFit</span> function).</p>
<ul>
<li>If log-likelihood and parameter estimates are pretty much the same across optimizers (and they are rarely notably different in my experience), pick one and go with it.</li>
</ul></li>
<li><p>Use a different package. The different estimation approach may simply work better for the current problem or provide other opportunities for tweaks. For example, with mixed models one could use <span class="pack" style="">glmmTMB</span> or <span class="pack" style="">brms</span> (Bayesian) in lieu of <span class="pack" style="">lme4</span>.</p></li>
</ol>
<p>In my experience with many clients with many types of data coming across many fields of study, the usual problem with convergence and <span class="pack" style="">lme4</span> (and others) is typically a fixable data problem, or a problematically specified model. In this case, the <span class="pack" style="">lme4</span> developers have worked hard over a number of years to build this awesome tool, and it works very well, so if it is having problems, you should be inspecting your data closely and thinking hard about your model. If it is an <span class="pack" style="">lme4</span> problem, switching optimizers will likely get you to convergence, but going through technical solutions should be a last resort.</p>
<h2 id="references">References</h2>
<p>Bates et al.<span class="citation" data-cites="bates2015parsimonious">(<a href="#ref-bates2015parsimonious" role="doc-biblioref">Bates et al. 2015</a>)</span></p>
<p><br></p>
<p>Stackoverflow question<span class="citation" data-cites="stackoverflow2014">(<a href="#ref-stackoverflow2014" role="doc-biblioref">StackOverflow 2014</a>)</span></p>
<p><br></p>
<p>Bolker’s answer given a little more cleanly<span class="citation" data-cites="bolker2014">(<a href="#ref-bolker2014" role="doc-biblioref">Bolker 2014?</a>)</span></p>
<p><br></p>
<p>Help file for convergence<span class="citation" data-cites="lme4convergence2020">(<a href="#ref-lme4convergence2020" role="doc-biblioref">Bolker 2020</a>)</span></p>
<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-bates2015parsimonious" class="csl-entry" role="doc-biblioentry">
Bates, Douglas, Reinhold Kliegl, Shravan Vasishth, and Harald Baayen. 2015. <span>“Parsimonious Mixed Models.”</span> <em>arXiv Preprint arXiv:1506.04967</em>. <a href="https://arxiv.org/abs/1506.04967">https://arxiv.org/abs/1506.04967</a>.
</div>
<div id="ref-bolker2014" class="csl-entry" role="doc-biblioentry">
Bolker, Ben. 2014? <span>“Lme4 Convergence Warnings: Troubleshooting.”</span> <a href="https://rstudio-pubs-static.s3.amazonaws.com/33653_57fc7b8e5d484c909b615d8633c01d51.html">https://rstudio-pubs-static.s3.amazonaws.com/33653_57fc7b8e5d484c909b615d8633c01d51.html</a>.
</div>
<div id="ref-lme4convergence2020" class="csl-entry" role="doc-biblioentry">
———. 2020. <span>“Lme4 Help File for Convergence.”</span> <a href="https://rdrr.io/cran/lme4/man/convergence.html">https://rdrr.io/cran/lme4/man/convergence.html</a>.
</div>
<div id="ref-stackoverflow2014" class="csl-entry" role="doc-biblioentry">
StackOverflow. 2014. <span>“Warning Messages When Trying to Run Glmer in r.”</span> <a href="https://stackoverflow.com/questions/23478792/warning-messages-when-trying-to-run-glmer-in-r">https://stackoverflow.com/questions/23478792/warning-messages-when-trying-to-run-glmer-in-r</a>.
</div>
</div>
<section class="footnotes" role="doc-endnotes">
<hr />
<ol>
<li id="fn1" role="doc-endnote"><p>Ben Bolker is one of the primary developers of the <span class="pack" style="">lme4</span> package.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2" role="doc-endnote"><p>For a basic linear model situation, <span class="math inline">\(1-1/VIF = R^2\)</span>, where <span class="math inline">\(R^2\)</span> is a regression model where a covariate is predicted by all the other covariates. We wouldn’t typically use a standard linear regression for binary outcomes or other scenarios, but this provides a quick and rough metric. The car package actually also provides a ‘generalized’ VIF though. In terms of interpretation, it tells us how much the standard error increases relative to the covariate if it was independent of the others. We would be concerned with redundancy of anything of VIF &gt; 10 / <span class="math inline">\(R^2\)</span> &gt; .90, but maybe even less. As a final note, collinearity is basically a sample size issue, as larger data would reduce the standard errors, and we’d likely get a fuller sense of true variability in the covariates.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3" role="doc-endnote"><p>This outline mostly follows the documentation in the help file for <code>?convergence</code> for lme4.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4" role="doc-endnote"><p>Think of doing a principal components analysis on the variance-covariance matrix for the random effects. If one of those components is essentially accounting for zero variance, it may suggest at least one of the estimated random effects is not needed.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5" role="doc-endnote"><p>Unfortunately there doesn’t appear to be much documentation on what should be listed in <code>optinfo</code>.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6" role="doc-endnote"><p>To paraphrase Barthelme slightly: “What is wonderful? Are these results wonderful? Are they significant? Are they what I need?”</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></li>
</ol>
</section>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
<h3 id="references">References</h3>
<div id="references-listing"></div>
</div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
